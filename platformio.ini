; PlatformIO Project Configuration File for ESP32-MCP2515 Library
;
; This configuration tests the library across ESP32 and Arduino AVR platforms
; Build all: pio run
; Build specific: pio run -e esp32-s3
; Upload: pio run -e esp32-s3 -t upload
; Monitor: pio run -e esp32-s3 -t monitor
; Upload+Monitor: pio run -e esp32-s3 -t upload -t monitor
; Clean: pio run -t clean

[platformio]
src_dir = src
; Library files are now in src/ directory alongside main.cpp

; Common settings for all platforms
[common]
framework = arduino
build_flags =
    -Wall
    -Wextra
    -Wno-unused-parameter
    -Wno-unused-variable
lib_deps =
lib_ldf_mode = deep+
monitor_speed = 115200
build_src_filter = +<*>

; ESP32-specific common settings
[env]
framework = ${common.framework}
platform = espressif32@6.5.0
build_flags =
    ${common.build_flags}
    -DESP32
    -DCORE_DEBUG_LEVEL=5           ; 0=None, 1=Error, 2=Warn, 3=Info, 4=Debug, 5=Verbose
    -DARDUINO_USB_MODE=1           ; Enable USB CDC on boot
    -DARDUINO_USB_CDC_ON_BOOT=1    ; USB CDC on boot for Serial
    -DBOARD_HAS_PSRAM              ; Enable PSRAM (8MB available)
    -mfix-esp32-psram-cache-issue  ; PSRAM cache fix
    -DCONFIG_SPIRAM_USE_CAPS_ALLOC ; Enable PSRAM malloc/free
    -DCONFIG_SPIRAM_IGNORE_NOTFOUND ; Don't panic if PSRAM not found
    -Os                            ; Optimize for size
    -ffunction-sections            ; Enable function-level linking
    -fdata-sections                ; Enable data-level linking
lib_deps = ${common.lib_deps}
lib_ldf_mode = ${common.lib_ldf_mode}
monitor_speed = ${common.monitor_speed}
monitor_filters = log2file, esp32_exception_decoder
build_src_filter = ${common.build_src_filter}

; =============================================
; ESP32 Classic (Dual-core Xtensa LX6)
; =============================================
[env:esp32dev]
board = esp32dev
build_flags =
    ${env.build_flags}
    -DMCP2515_CHIP_ESP32_CLASSIC=1

; =============================================
; ESP32-S2 (Single-core Xtensa LX7)
; =============================================
[env:esp32-s2]
board = esp32-s2-saola-1
build_flags =
    ${env.build_flags}
    -DMCP2515_CHIP_ESP32S2=1

; =============================================
; ESP32-S3 (Dual-core Xtensa LX7)
; =============================================
[env:esp32-s3]
board = esp32-s3-devkitc-1
build_flags =
    ${env.build_flags}
    -DMCP2515_CHIP_ESP32S3=1

; =============================================
; ESP32-C3 (Single-core RISC-V)
; =============================================
[env:esp32-c3]
board = esp32-c3-devkitm-1
build_flags =
    ${env.build_flags}
    -DMCP2515_CHIP_ESP32C3=1

; =============================================
; ESP32-C6 (Single-core RISC-V with Wi-Fi 6)
; NOTE: ESP32-C6 Arduino support requires platform version 7.0.0+
; This board is not included in default builds due to platform compatibility.
; To build for C6, upgrade platform and run: pio run -e esp32-c6
; =============================================
; [env:esp32-c6]
; board = esp32-c6-devkitc-1
; platform = espressif32@^7.0.0
; build_flags =
;     ${env.build_flags}
;     -DMCP2515_CHIP_ESP32C6=1

; =============================================
; Arduino Uno (ATmega328P @ 16MHz)
; =============================================
[env:uno]
platform = atmelavr
board = uno
framework = ${common.framework}
build_flags =
    ${common.build_flags}
    -DARDUINO_AVR_UNO=1
lib_deps = ${common.lib_deps}
lib_ldf_mode = ${common.lib_ldf_mode}
monitor_speed = ${common.monitor_speed}

; =============================================
; Arduino Mega2560 (ATmega2560 @ 16MHz)
; =============================================
[env:mega2560]
platform = atmelavr
board = megaatmega2560
framework = ${common.framework}
build_flags =
    ${common.build_flags}
    -DARDUINO_AVR_MEGA2560=1
lib_deps = ${common.lib_deps}
lib_ldf_mode = ${common.lib_ldf_mode}
monitor_speed = ${common.monitor_speed}
