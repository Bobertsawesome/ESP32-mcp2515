Stand-Alone CAN Controller with SPI InterfaceFeatures

- Implements CAN V2.0B at 1 Mb/s:
  - 0 to 8-byte length in the data field
  - Standard and extended data and remote frames
- Receive Buffers, Masks and Filters:
  - Two receive buffers with prioritized message storage
  - Six 29-bit filters
  - Two 29-bit masks
- Data Byte Filtering on the First Two Data Bytes (applies to standard data frames)
- Three Transmit Buffers with Prioritization and Abort Features
- High-Speed SPI Interface (10 MHz):
  - SPI Modes 0,0 and 1,1
- One-Shot mode Ensures Message Transmission is Attempted Only One Time
- Clock Out Pin with Programmable Prescaler:
  - Can be used as a clock source for other device(s)
- Start-of-Frame (SOF) Signal is Available for Monitoring the SOF Signal:
  - Can be used for time slot-based protocols and/or bus diagnostics to detect early bus degradation
- Interrupt Output Pin with Selectable Enables
- Buffer Full Output Pins Configurable as:
  - Interrupt output for each receive buffer
  - General purpose output
- Request-to-Send (RTS) Input Pins Individually Configurable as:
  - Control pins to request transmission for each transmit buffer
  - General purpose inputs
- Low-Power CMOS Technology:
  - Operates from 2.7V-5.5V
  - 5 mA active current (typical)
  - 1  $\mu$ A standby current (typical) (Sleep mode)
- Temperature Ranges Supported:
  - Industrial (I): -40°C to +85°C
  - Extended (E): -40°C to +125°C
- AEC-Q100 Qualified

DescriptionMicrochip Technology's MCP2515 is a stand-alone Controller Area Network (CAN) controller that implements the CAN specification, Version 2.0B. It is capable of transmitting and receiving both standard and extended data and remote frames. The MCP2515 has two acceptance masks and six acceptance filters that are used to filter out unwanted messages, thereby reducing the host MCU's overhead. The MCP2515 interfaces with microcontrollers (MCUs) via an industry standard Serial Peripheral Interface (SPI).

Package Types18-Lead PDIP/SOIC

| TXCAN                                                 | 1 | V <sub>DD</sub>                                      | 18 |
|-------------------------------------------------------|---|------------------------------------------------------|----|
| RXCAN                                                 | 2 | <span style="text-decoration: overline">RESET</span> | 17 |
| CLKOUT/SOF                                            | 3 | <span style="text-decoration: overline">CS</span>    | 16 |
| <span style="text-decoration: overline">TX0RTS</span> | 4 | SO                                                   | 15 |
| <span style="text-decoration: overline">TX1RTS</span> | 5 | SI                                                   | 14 |
| <span style="text-decoration: overline">TX2RTS</span> | 6 | SCK                                                  | 13 |
| OSC2                                                  | 7 | <span style="text-decoration: overline">INT</span>   | 12 |
| OSC1                                                  | 8 | <span style="text-decoration: overline">RX0BF</span> | 11 |
| V <sub>SS</sub>                                       | 9 | <span style="text-decoration: overline">RX1BF</span> | 10 |

![](_page_0_Figure_9.jpeg)

20-Lead TSSOP

| TXCAN                                                 | 1  | V <sub>DD</sub>                                      | 20 |
|-------------------------------------------------------|----|------------------------------------------------------|----|
| RXCAN                                                 | 2  | <span style="text-decoration: overline">RESET</span> | 19 |
| CLKOUT/SOF                                            | 3  | <span style="text-decoration: overline">CS</span>    | 18 |
| <span style="text-decoration: overline">TX0RTS</span> | 4  | SO                                                   | 17 |
| <span style="text-decoration: overline">TX1RTS</span> | 5  | SI                                                   | 16 |
| NC                                                    | 6  | NC                                                   | 15 |
| <span style="text-decoration: overline">TX2RTS</span> | 7  | SCK                                                  | 14 |
| OSC2                                                  | 8  | <span style="text-decoration: overline">INT</span>   | 13 |
| OSC1                                                  | 9  | <span style="text-decoration: overline">RX0BF</span> | 12 |
| V <sub>SS</sub>                                       | 10 | <span style="text-decoration: overline">RX1BF</span> | 11 |

![](_page_0_Figure_11.jpeg)

20-Lead QFN\*

| RXCAN                                                 | 20 | V <sub>DD</sub>                                      | 18 |
|-------------------------------------------------------|----|------------------------------------------------------|----|
| TXCAN                                                 | 19 | <span style="text-decoration: overline">RESET</span> | 17 |
| CLKOUT                                                | 1  | <span style="text-decoration: overline">CS</span>    | 16 |
| <span style="text-decoration: overline">TX0RTS</span> | 2  | SO                                                   | 15 |
| <span style="text-decoration: overline">TX1RTS</span> | 3  | SI                                                   | 14 |
| NC                                                    | 4  | NC                                                   | 13 |
| <span style="text-decoration: overline">TX2RTS</span> | 5  | SCK                                                  | 12 |
| OSC2                                                  | 6  | <span style="text-decoration: overline">INT</span>   | 11 |
| OSC1                                                  | 7  | <span style="text-decoration: overline">RX1BF</span> | 10 |
| GND                                                   | 8  | <span style="text-decoration: overline">RX0BF</span> | 9  |

![](_page_0_Figure_13.jpeg)

\* Includes Exposed Thermal Pad (EP); see Table 1-1.

# MCP2515

NOTES:

## 1.0 DEVICE OVERVIEW

The MCP2515 is a stand-alone CAN controller developed to simplify applications that require interfacing with a CAN bus. A simple block diagram of the MCP2515 is shown in Figure 1-1. The device consists of three main blocks:

1. The CAN module, which includes the CAN protocol engine, masks, filters, transmit and receive buffers.
2. The control logic and registers that are used to configure the device and its operation.
3. The SPI protocol block.

An example system implementation using the device is shown in Figure 1-2.

### 1.1 CAN Module

The CAN module handles all functions for receiving and transmitting messages on the CAN bus. Messages are transmitted by first loading the appropriate message buffer and control registers. Transmission is initiated by using control register bits via the SPI interface or by using the transmit enable pins. Status and errors can be checked by reading the appropriate registers. Any message detected on the CAN bus is checked for errors and then matched against the user-defined filters to see if it should be moved into one of the two receive buffers.

### 1.2 Control Logic

The control logic block controls the setup and operation of the MCP2515 by interfacing to the other blocks in order to pass information and control.

Interrupt pins are provided to allow greater system flexibility. There is one multipurpose interrupt pin (as well as specific interrupt pins) for each of the receive registers that can be used to indicate a valid message has been received and loaded into one of the receive buffers. Use of the specific interrupt pins is optional. The general purpose interrupt pin, as well as status registers (accessed via the SPI interface), can also be used to determine when a valid message has been received.

Additionally, there are three pins available to initiate immediate transmission of a message that has been loaded into one of the three transmit registers. Use of these pins is optional, as initiating message transmissions can also be accomplished by utilizing control registers accessed via the SPI interface.

### 1.3 SPI Protocol Block

The MCU interfaces to the device via the SPI interface. Writing to, and reading from, all registers is accomplished using standard SPI read and write commands, in addition to specialized SPI commands.

FIGURE 1-1: BLOCK DIAGRAM

![Block diagram of the MCP2515 device. The diagram shows the CAN Module, which includes the CAN Protocol Engine, TX and RX Buffers, Masks and Filters, and SPI Interface Logic. The CAN Protocol Engine connects to the TX and RX Buffers, Masks and Filters. The TX and RX Buffers, Masks and Filters connect to the SPI Interface Logic. The SPI Interface Logic connects to the SPI Bus (CS, SCK, SI, SO). The Control Logic block is central, connecting to the CAN Module, SPI Interface Logic, Timing Generation, and Control and Interrupt Registers. The Timing Generation block receives OSC1, OSC2, and CLKOUT inputs and connects to the Control Logic. The Control and Interrupt Registers block connects to the Control Logic and outputs INT, RX0BF, RX1BF, TX0RTS, TX1RTS, TX2RTS, and RESET signals.]()![](_page_2_Figure_14.jpeg)

# MCP2515

FIGURE 1-2: EXAMPLE SYSTEM IMPLEMENTATION

Diagram illustrating an example system implementation using three MCP2515 CAN controllers. Each MCP2515 is connected to a Node Controller via SPI. Each MCP2515 is connected to an XCVR (Transceiver) via TX and RX lines. The XCVRs are connected to the CAN bus (CANH and CANL).

![](_page_3_Figure_2.jpeg)

TABLE 1-1: PINOUT DESCRIPTION

| Name             | PDIP/<br>SOIC Pin # | TSSOP Pin # | QFN Pin # | I/O/P Type | Description                                                                         | Alternate Pin Function                                                       |
|------------------|---------------------|-------------|-----------|------------|-------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
| TXCAN            | 1                   | 1           | 19        | O          | Transmit output pin to CAN bus                                                      | —                                                                            |
| RXCAN            | 2                   | 2           | 20        | I          | Receive input pin from CAN bus                                                      | —                                                                            |
| CLKOUT           | 3                   | 3           | 1         | O          | Clock output pin with programmable prescaler                                        | Start-of-Frame signal                                                        |
| TX0RTS           | 4                   | 4           | 2         | I          | Transmit buffer TXB0 Request-to-Send;<br>100 kΩ internal pull-up to V <sub>DD</sub> | General purpose digital input,<br>100 kΩ internal pull-up to V <sub>DD</sub> |
| TX1RTS           | 5                   | 5           | 3         | I          | Transmit buffer TXB1 Request-to-Send;<br>100 kΩ internal pull-up to V <sub>DD</sub> | General purpose digital input,<br>100 kΩ internal pull-up to V <sub>DD</sub> |
| TX2RTS           | 6                   | 7           | 5         | I          | Transmit buffer TXB2 Request-to-Send;<br>100 kΩ internal pull-up to V <sub>DD</sub> | General purpose digital input,<br>100 kΩ internal pull-up to V <sub>DD</sub> |
| OSC2             | 7                   | 8           | 6         | O          | Oscillator output                                                                   | —                                                                            |
| OSC1             | 8                   | 9           | 7         | I          | Oscillator input                                                                    | External clock input                                                         |
| V <sub>ss</sub>  | 9                   | 10          | 8         | P          | Ground reference for logic and I/O pins                                             | —                                                                            |
| RX1BF            | 10                  | 11          | 9         | O          | Receive buffer RXB1 interrupt pin or general purpose digital output                 | General purpose digital output                                               |
| RX0BF            | 11                  | 12          | 10        | O          | Receive buffer RXB0 interrupt pin or general purpose digital output                 | General purpose digital output                                               |
| INT              | 12                  | 13          | 11        | O          | Interrupt output pin                                                                | —                                                                            |
| SCK              | 13                  | 14          | 12        | I          | Clock input pin for SPI interface                                                   | —                                                                            |
| SI               | 14                  | 16          | 14        | I          | Data input pin for SPI interface                                                    | —                                                                            |
| SO               | 15                  | 17          | 15        | O          | Data output pin for SPI interface                                                   | —                                                                            |
| CS               | 16                  | 18          | 16        | I          | Chip select input pin for SPI interface                                             | —                                                                            |
| <del>RESET</del> | 17                  | 19          | 17        | I          | Active-low device Reset input                                                       | —                                                                            |
| V <sub>DD</sub>  | 18                  | 20          | 18        | P          | Positive supply for logic and I/O pins                                              | —                                                                            |
| NC               | —                   | 6, 15       | 4, 13     | —          | No internal connection                                                              | —                                                                            |
| EP               | —                   | —           | 21        | —          | Exposed Thermal Pad, connect to V <sub>ss</sub>                                     | —                                                                            |

Legend: I = Input; O = Output; P = Power

#### 1.4 Transmit/Receive Buffers/Masks/Filters

The MCP2515 has three transmit and two receive buffers, two acceptance masks (one for each receive buffer) and a total of six acceptance filters. Figure 1-3 shows a block diagram of these buffers and their connection to the protocol engine.

FIGURE 1-3: CAN BUFFERS AND PROTOCOL ENGINE BLOCK DIAGRAM

Block diagram illustrating the CAN Buffers and Protocol Engine of the MCP2515.

#### BUFFERS

The buffer section contains three transmit buffers (TXB0, TXB1, TXB2) and two receive buffers (RXB0, RXB1). Each buffer has associated control/status signals (TXREQ, ABTF, MLOA, TXERR) and a MESSAGE output.

- TXB0, TXB1, TXB2 are connected to the Message Queue Control and the Transmit Byte Sequencer.
- RXB0 and RXB1 are connected to the Acceptance Mask (RXM0, RXM1) and Acceptance Filter (RXF0-RXF5) structures.
- RXB0 and RXB1 output Identifier and Data Field signals to the MAB.
- The MAB output is connected to the Protocol Engine.
- The Acceptance Mask and Acceptance Filter structures output an Accept signal.

#### PROTOCOL ENGINE

The Protocol Engine section includes the following components and signals:

- **Transmit Logic** outputs TX.
- The RX signal is input to the **Bit Timing Logic**.
- **Bit Timing Logic** connects to the **Transmit Logic** and **Protocol Finite State Machine**.
- **Protocol Finite State Machine** outputs SOF.
- **Transmit Error Counter** outputs ErrPas and BusOff signals.
- **Receive Error Counter** outputs REC and TEC signals.
- **CRC[14:0]** and **Comparator** are connected to the Transmit/Receive data paths.
- **Transmit[7:0]** and **Receive[7:0]** registers are connected to the **Comparator** and **CRC** logic.
- Data paths labeled **Shift[14:0]** and **{Transmit[5:0], Receive[8:0]}** feed into the **Comparator**.
- **Configuration Registers** feed into the **Clock Generator**.
- **Clock Generator** feeds into the **Bit Timing Logic**.

![](_page_4_Figure_4.jpeg)

## 1.5 CAN Protocol Engine

The CAN protocol engine combines several functional blocks, shown in Figure 1-4 and described below.

### 1.5.1 PROTOCOL FINITE STATE MACHINE

The heart of the engine is the Finite State Machine (FSM). The FSM is a sequencer that controls the sequential data stream between the TX/RX Shift register, the CRC register and the bus line. The FSM also controls the Error Management Logic (EML) and the parallel data stream between the TX/RX Shift registers and the buffers. The FSM ensures that the processes of reception, arbitration, transmission and error signaling are performed according to the CAN protocol. The automatic retransmission of messages on the bus line is also handled by the FSM.

### 1.5.2 CYCLIC REDUNDANCY CHECK

The Cyclic Redundancy Check register generates the Cyclic Redundancy Check (CRC) code, which is transmitted after either the Control Field (for messages with 0 data bytes) or the Data Field and is used to check the CRC field of incoming messages.

### 1.5.3 ERROR MANAGEMENT LOGIC

The Error Management Logic (EML) is responsible for the Fault confinement of the CAN device. Its two counters, the Receive Error Counter (REC) and the Transmit Error Counter (TEC), are incremented and decremented by commands from the bit stream processor. Based on the values of the error counters, the CAN controller is set into the states: error-active, error-passive or bus-off.

### 1.5.4 BIT TIMING LOGIC

The Bit Timing Logic (BTL) monitors the bus line input and handles the bus related bit timing according to the CAN protocol. The BTL synchronizes on a recessive-to-dominant bus transition at the Start-of-Frame (hard synchronization) and on any further recessive-to-dominant bus line transition if the CAN controller itself does not transmit a dominant bit (resynchronization). The BTL also provides programmable Time Segments to compensate for the propagation delay time, phase shifts and to define the position of the sample point within the bit time. The programming of the BTL depends on the baud rate and external physical delay times.

FIGURE 1-4: CAN PROTOCOL ENGINE BLOCK DIAGRAM

Block diagram illustrating the CAN Protocol Engine components and their interconnections.

- **Bit Timing Logic** receives input from **RX** and outputs **SAM**, providing input to **Sample[2:0]**.
- **Sample[2:0]** outputs to **Majority Decision**.
- **Majority Decision** outputs to **StuffReg[5:0]**.
- **BusMon** signal is derived from the sampled bus state and inputs to **Protocol FSM** and the lower **Comparator**.
- **StuffReg[5:0]** outputs to the upper **Comparator**, which outputs to **Protocol FSM**.
- **CRC[14:0]** outputs to the lower **Comparator**.
- **Receive[7:0]** and **Transmit[7:0]** are part of the **Interface to Standard Buffer**. **RecData[7:0]** inputs to **Receive[7:0]**, and **TrmData[7:0]** inputs to **Transmit[7:0]**.
- The lower **Comparator** receives input from **CRC[14:0]** and the shift register output **Shift[14:0] (Transmit[5:0], Receive[7:0])**, and outputs to **Protocol FSM**.
- **Protocol FSM** receives input from both Comparators and **BusMon**. It outputs **SOF** and **Rec/Trm Addr**, and controls the **Transmit Logic** and the Error Counter block.
- **Transmit Logic** receives control input from Protocol FSM and outputs **TX**.
- The Error Counter block (containing **Receive Error Counter** and **Transmit Error Counter**) receives control input from the FSM. Its outputs are **REC**, **TEC**, **ErrPas**, and **BusOff**.

![](_page_5_Figure_12.jpeg)

## 2.0 CAN MESSAGE FRAMES

The MCP2515 supports standard data frames, extended data frames and remote frames (standard and extended), as defined in the CAN 2.0B specification.

### 2.1 Standard Data Frame

The CAN standard data frame is shown in Figure 2-1. As with all other frames, the frame begins with a Start-of-Frame (SOF) bit, which is of the dominant state and allows hard synchronization of all nodes.

The SOF is followed by the arbitration field, consisting of 12 bits: the 11-bit identifier and the Remote Transmission Request (RTR) bit. The RTR bit is used to distinguish a data frame (RTR bit dominant) from a remote frame (RTR bit recessive).

Following the arbitration field is the control field, consisting of six bits. The first bit of this field is the Identifier Extension (IDE) bit, which must be dominant to specify a standard frame. The following bit, Reserved Bit Zero (RB0), is reserved and is defined as a dominant bit by the CAN protocol. The remaining four bits of the control field are the Data Length Code (DLC) bits, which specify the number of bytes of data (0-8 bytes) contained in the message.

After the control field, is the data field, which contains any data bytes that are being sent, and is of the length defined by the DLC (0-8 bytes).

The Cyclic Redundancy Check (CRC) field follows the data field and is used to detect transmission errors. The CRC field consists of a 15-bit CRC sequence, followed by the recessive CRC Delimiter bit.

The final field is the two-bit Acknowledge (ACK) field. During the ACK Slot bit, the transmitting node sends out a recessive bit. Any node that has received an error-free frame Acknowledges the correct reception of the frame by sending back a dominant bit (regardless of whether the node is configured to accept that specific message or not). The recessive Acknowledge delimiter completes the Acknowledge field and may not be overwritten by a dominant bit.

### 2.2 Extended Data Frame

In the extended CAN data frame, shown in Figure 2-2, the SOF bit is followed by the arbitration field, which consists of 32 bits. The first 11 bits are the Most Significant bits (MSbs) (Base-ID) of the 29-bit identifier. These 11 bits are followed by the Substitute Remote Request (SRR) bit, which is defined to be recessive. The SRR bit is followed by the IDE bit, which is recessive to denote an extended CAN frame.

It should be noted that if arbitration remains unresolved after transmission of the first 11 bits of the identifier, and one of the nodes involved in the arbitration is sending

a standard CAN frame (11-bit identifier), the standard CAN frame will win arbitration due to the assertion of a dominant IDE bit. Also, the SRR bit in an extended CAN frame must be recessive to allow the assertion of a dominant RTR bit by a node that is sending a standard CAN remote frame.

The SRR and IDE bits are followed by the remaining 18 bits of the identifier (Extended ID) and the Remote Transmission Request bit.

To enable standard and extended frames to be sent across a shared network, the 29-bit extended message identifier is split into 11-bit (Most Significant) and 18-bit (Least Significant) sections. This split ensures that the IDE bit can remain at the same bit position in both the standard and extended frames.

Following the arbitration field is the six-bit control field. The first two bits of this field are reserved and must be dominant. The remaining four bits of the control field are the DLC, which specifies the number of data bytes contained in the message.

The remaining portion of the frame (data field, CRC field, Acknowledge field, End-of-Frame and intermission) is constructed in the same way as a standard data frame (see Section 2.1 "Standard Data Frame").

### 2.3 Remote Frame

Normally, data transmission is performed on an autonomous basis by the data source node (e.g., a sensor sending out a data frame). It is possible, however, for a destination node to request data from the source. To accomplish this, the destination node sends a remote frame with an identifier that matches the identifier of the required data frame. The appropriate data source node will then send a data frame in response to the remote frame request.

There are two differences between a remote frame (shown in Figure 2-3) and a data frame. First, the RTR bit is at the recessive state, and second, there is no data field. In the event of a data frame and a remote frame with the same identifier being transmitted at the same time, the data frame wins arbitration due to the dominant RTR bit following the identifier. In this way, the node that transmitted the remote frame receives the desired data immediately.

### 2.4 Error Frame

An error frame is generated by any node that detects a bus error. An error frame, shown in Figure 2-4, consists of two fields: an error flag field followed by an error delimiter field. There are two types of error flag fields. The type of error flag field sent depends upon the error status of the node that detects and generates the error flag field.

## 2.4.1 ACTIVE ERRORS

If an error-active node detects a bus error, the node interrupts transmission of the current message by generating an active error flag. The active error flag is composed of six consecutive dominant bits. This bit sequence actively violates the bit-stuffing rule. All other stations recognize the resulting bit-stuffing error, and in turn, generate error frames themselves, called error echo flags.

The error flag field, therefore, consists of between six and twelve consecutive dominant bits (generated by one or more nodes). The error delimiter field (eight recessive bits) completes the error frame. Upon completion of the error frame, bus activity returns to normal and the interrupted node attempts to resend the aborted message.

**Note:** Error echo flags typically occur when a localized disturbance causes one or more (but not all) nodes to send an error flag. The remaining nodes generate error flags in response (echo) to the original error flag.

## 2.4.2 PASSIVE ERRORS

If an error-passive node detects a bus error, the node transmits an error-passive flag followed by the error delimiter field. The error-passive flag consists of six consecutive recessive bits. The error frame for an error-passive node consists of 14 recessive bits. From this, it follows that unless the bus error is detected by an error-active node or the transmitting node, the message will continue transmission because the error-passive flag does not interfere with the bus.

If the transmitting node generates an error-passive flag, it will cause other nodes to generate error frames due to the resulting bit-stuffing violation. After transmission of an error frame, an error-passive node must wait for six consecutive recessive bits on the bus before attempting to rejoin bus communications.

The error delimiter consists of eight recessive bits, and allows the bus nodes to restart bus communications cleanly after an error has occurred.

## 2.5 Overload Frame

An overload frame, shown in Figure 2-5, has the same format as an active-error frame. An overload frame, however, can only be generated during an interframe space. In this way, an overload frame can be differentiated from an error frame (an error frame is sent during the transmission of a message). The overload frame consists of two fields: an overload flag followed by an overload delimiter. The overload flag consists of six dominant bits followed by overload flags generated by other nodes (and, as for an active error flag, giving a maximum of twelve dominant bits). The overload delimiter consists of eight recessive bits. An overload frame can be generated by a node as a result of two conditions:

1. The node detects a dominant bit during the interframe space, an illegal condition. **Exception:** The dominant bit is detected during the third bit of IFS. In this case, the receivers will interpret this as a SOF.
2. Due to internal conditions, the node is not yet able to begin reception of the next message. A node may generate a maximum of two sequential overload frames to delay the start of the next message.

**Note:** Case 2 should never occur with the MCP2515 due to very short internal delays.

## 2.6 Interframe Space

The interframe space separates a preceding frame (of any type) from a subsequent data or remote frame. The interframe space is composed of at least three recessive bits, called the 'Intermission'. This allows nodes time for internal processing before the start of the next message frame. After the intermission, the bus line remains in the recessive state (Bus Idle) until the next transmission starts.

FIGURE 2-1: STANDARD DATA FRAMEDiagram illustrating the structure of a Standard Data Frame (CAN 2.0A/B format).

The frame is divided into several fields, with bit lengths shown by arrows:

- **Start-of-Frame (SOF):** 1 bit (dominant '0').
- **Arbitration Field:** 12 bits, consisting of the 11-bit Identifier (ID10 to ID0) used for Message Filtering, and the 1-bit RTR (Remote Transmission Request) bit.
- **Control Field:** 6 bits, consisting of the IDE (Identifier Extension) bit (dominant '0' for Standard Frame), the RB0 (Reserved Bit) bit (dominant '0'), and the 4-bit Data Length Code (DLC3 to DLC0).
- **Data Field:**  $8N$  bits, where  $0 \le N \le 8$ . The total Data Frame length (SOF through EOF) is  $44 + 8N$  bits.
- **CRC Field:** 16 bits, consisting of the 15-bit CRC sequence and the 1-bit CRC Delimiter (CRC Del).
- **ACK Field:** 2 bits, consisting of the ACK Slot Bit and the ACK Delimiter (ACK Del).
- **End-of-Frame (EOF):** 7 bits (recessive '1').
- **Interframe Space (IFS):** 3 bits (recessive '1').

The fields from Start-of-Frame through the Control Field are indicated as "Stored in Buffers". The Data Field, CRC Field, and ACK Field are indicated as "Stored in Transmit/Receive Buffers". The frame structure from the Data Field through the End-of-Frame is shown as undergoing Bit-Stuffing.

![](_page_8_Figure_2.jpeg)

FIGURE 2-2: EXTENDED DATA FRAMEDiagram illustrating the structure of an Extended Data Frame, showing bit positions and fields. The Data Frame (Start-of-Frame through End-of-Frame) consists of  $64 + 8N$  bits, where  $0 \le N \le 8$ .

The frame structure is divided into several sections:

- **Start-of-Frame** (1 bit)
- **Arbitration Field** (32 bits)
  - Identifier (11 bits: ID10 to ID0)
  - SRR (1 bit)
  - IDE (1 bit)
  - Extended Identifier (18 bits: EID17 to EID0)
- **Control Field** (6 bits)
  - RTR (1 bit)
  - Reserved Bits (RB1, RB0) (2 bits)
  - Data Length Code (DLC3 to DLC0) (4 bits)
- **Data Field** ( $8N$  bits, where  $0 \le N \le 8$ )
- **CRC Field** (16 bits)
  - CRC (15 bits)
  - CRC Delimiter (CRC Del) (1 bit)
- **ACK Field** (2 bits)
  - ACK Slot Bit (1 bit)
  - ACK Delimiter (ACK Del) (1 bit)
- **End-of-Frame** (7 bits)
- **Interframe Space (IFS)** (3 bits)

Notes regarding frame processing:

- **Message Filtering** applies to the Identifier, SRR, IDE, and Extended Identifier. This section is labeled **Stored in Buffers**.
- The Arbitration Field, Control Field, Data Field, CRC Field, and ACK Field are **Stored in Transmit/Receive Buffers**.
- **Bit-Stuffing** applies from the Start-of-Frame through the 15 bits of the CRC field.

![](_page_9_Figure_2.jpeg)

FIGURE 2-3: REMOTE FRAMEDiagram illustrating the structure of a Remote Frame with Extended Identifier (labeled "Remote Frame with Extended Identifier"). The frame contains "No Data Field".

The frame structure is detailed below:

- **Start-of-Frame:** 1 bit
- **Arbitration Field (32 bits):**
  - Identifier (11 bits: ID10 to ID0)
  - SRR (Substitute Remote Request) (1 bit)
  - IDE (Identifier Extension) (1 bit)
  - Extended Identifier (18 bits: EID17 to EID0)Note: The Identifier and Extended Identifier sections are used for Message Filtering.
- **Control Field (6 bits):**
  - RTR (Remote Transmission Request) (1 bit)
  - Reserved Bits (2 bits: RB1, RB0)
  - Data Length Code (4 bits: DLC3 to DLC0)
- **CRC Field (16 bits):**
  - CRC (15 bits)
  - CRC Delimiter (CRC Del) (1 bit)
- **ACK Field (2 bits):**
  - Ack Slot Bit (1 bit)
  - ACK Delimiter (ACK Del) (1 bit)
- **End-of-Frame (7 bits)**
- **Intermission Field (IFS) (3 bits)**

![](_page_10_Figure_2.jpeg)

FIGURE 2-4: ACTIVE ERROR FRAMEDiagram illustrating the structure of an Active Error Frame in the MCP2515 CAN protocol.

The frame structure is divided into two main sections: the Interrupted Data Frame and the Error Frame.

**Interrupted Data Frame (Left Side):**

- Start-of-Frame (1 bit, value '0').
- Arbitration Field (12 bits span): Includes Identifier bits (ID 10 to ID 0) used for Message Filtering.
- Control Field (6 bits span): Includes IDE, RTR, RBO (labeled '0'), and DLC3 to DLC0 (Data Length Code, 4 bits).
- Data Field ( $8N$  bits, where  $0 \le N \le 8$ ). The diagram shows 8 bits, followed by a break (wavy lines), then 8 bits.

The content of the Data Frame or Remote Frame is subject to **Bit-Stuffing**.

**Error Frame (Right Side):**

The Error Frame (20 bits total) consists of:

- Error Flag (6 bits, all dominant '0's).
- Echo Error Flag (6 bits, all dominant '0's).
- Error Delimiter (8 bits, shown as '11111110').
- Inter-Frame Space or Overload Frame follows the Error Delimiter.

![](_page_11_Figure_2.jpeg)

FIGURE 2-5: OVERLOAD FRAMEDiagram illustrating the structure of an Overload Frame (14 bits) in the CAN protocol, shown in context following the fields of a preceding frame (Remote Frame structure, 44 bits).

The preceding frame structure shown (Remote Frame, number of bits = 44) includes:

| Field              | Length (bits) | Bit Values/Content                                      | Notes                      |
|--------------------|---------------|---------------------------------------------------------|----------------------------|
| Start-of-Frame     | 1             | 0                                                       |                            |
| Arbitration Field  | 12            | ID0 to ID10 (11 bits) + RTR (1 bit, 1)                  |                            |
| Control Field      | 6             | IDE (1 bit, 0) + RB0 (1 bit, 0) + DLC3 to DLC0 (4 bits) |                            |
| CRC Field          | 16            | CRC (15 bits) + CRC Delimiter (1 bit, 1)                |                            |
| ACK Slot Bit       | 1             | 1                                                       |                            |
| ACK Delimiter      | 1             | 1                                                       |                            |
| End-of-Frame (EOF) | 7             | 1111111                                                 | Standard frame termination |

The Overload Frame is inserted at the position of the End-of-Frame or Error Delimiter or Overload Delimiter, immediately following the ACK Delimiter (ACK Del). The Overload Frame (14 bits) consists of:

| Field              | Length (bits) | Bit Values/Content   |
|--------------------|---------------|----------------------|
| Overload Flag      | 6             | 000000 (Dominant)    |
| Overload Delimiter | 8             | 11111111 (Recessive) |

The Overload Frame is followed by the Inter-Frame Space or an Error Frame.

![](_page_12_Figure_2.jpeg)

# MCP2515

NOTES:

## 3.0 MESSAGE TRANSMISSION

### 3.1 Transmit Buffers

The MCP2515 implements three transmit buffers. Each of these buffers occupies 14 bytes of SRAM and are mapped into the device memory map.

The first byte, TXBnCTRL, is a control register associated with the message buffer. The information in this register determines the conditions under which the message will be transmitted and indicates the status of the message transmission (see Register 3-1).

Five bytes are used to hold the Standard and Extended Identifiers, as well as other message arbitration information (see Register 3-3 through Register 3-6). The last eight bytes are for the eight possible data bytes of the message to be transmitted (see Register 3-8).

At a minimum, the TXBnSIDH, TXBnSIDL and TXBnDLC registers must be loaded. If data bytes are present in the message, the TXBnDm registers must also be loaded. If the message is to use Extended Identifiers, the TXBnEIDm registers must also be loaded and the EXIDE (TXBnSIDL[3]) bit set.

Prior to sending the message, the MCU must initialize the TXnIE bit in the CANINTE register to enable or disable the generation of an interrupt when the message is sent.

**Note:** The TXREQ bit (TXBnCTRL[3]) must be clear (indicating the transmit buffer is not pending transmission) before writing to the transmit buffer.

### 3.2 Transmit Priority

Transmit priority is a prioritization within the MCP2515 of the pending transmittable messages. This is independent from, and not necessarily related to, any prioritization implicit in the message arbitration scheme built into the CAN protocol.

Prior to sending the SOF, the priority of all buffers that are queued for transmission is compared. The transmit buffer with the highest priority will be sent first. For example, if Transmit Buffer 0 has a higher priority setting than Transmit Buffer 1, Transmit Buffer 0 will be sent first.

If two buffers have the same priority setting, the buffer with the highest buffer number will be sent first. For example, if Transmit Buffer 1 has the same priority setting as Transmit Buffer 0, Transmit Buffer 1 will be sent first.

There are four levels of transmit priority. If the TXP[1:0] bits (TXBnCTRL[1:0]) for a particular message buffer are set to '11', that buffer has the highest possible priority. If the TXP[1:0] bits for a particular message buffer are '00', that buffer has the lowest possible priority.

### 3.3 Initiating Transmission

In order to initiate message transmission, the TXREQ bit (TXBnCTRL[3]) must be set for each buffer to be transmitted. This can be accomplished by:

- Writing to the register via the SPI write command
- Sending the SPI RTS command
- Setting the TXnRTS pin low for the particular transmit buffer(s) that are to be transmitted

If transmission is initiated via the SPI interface, the TXREQ bit can be set at the same time as the TXPx priority bits.

When TXREQ is set, the ABTF, MLOA and TXERR bits (TXBnCTRL[5:4]) will be cleared automatically.

**Note:** Setting the TXREQ bit (TXBnCTRL[3]) does not initiate a message transmission. It merely flags a message buffer as being ready for transmission. Transmission will start when the device detects that the bus is available.

Once the transmission has completed successfully, the TXREQ bit will be cleared, the TXnIF bit (CANINTF) will be set and an interrupt will be generated if the TXnIE bit (CANINTE) is set.

If the message transmission fails, the TXREQ bit will remain set. This indicates that the message is still pending for transmission and one of the following condition flags will be set:

- If the message started to transmit but encountered an error condition, the TXERR (TXBnCTRL[4]) and MERRF bits (CANINTF[7]) will be set, and an interrupt will be generated on the INT pin if the MERRE bit (CANINTE[7]) is set
- If the message is lost, arbitration at the MLOA bit (TXBnCTRL[5]) will be set

**Note:** If One-Shot mode is enabled (OSM bit (CANCTRL[3])), the above conditions will still exist. However, the TXREQ bit will be cleared and the message will not attempt transmission a second time.

### 3.4 One-Shot Mode

One-Shot mode ensures that a message will only attempt to transmit one time. Normally, if a CAN message loses arbitration, or is destroyed by an error frame, the message is retransmitted. With One-Shot mode enabled, a message will only attempt to transmit one time, regardless of arbitration loss or error frame.

One-Shot mode is required to maintain time slots in deterministic systems, such as TTCAN.

## 3.5 TXnRTS Pins

The TXnRTS pins are input pins that can be configured as:

- Request-to-Send inputs, which provide an alternative means of initiating the transmission of a message from any of the transmit buffers
- Standard digital inputs

Configuration and control of these pins is accomplished using the TXRTSCTRL register (see [Register 3-2](#)). The TXRTSCTRL register can only be modified when the MCP2515 is in Configuration mode (see [Section 10.0 "Modes of Operation"](#)). If configured to operate as a Request-to-Send pin, the pin is mapped into the respective TXREQ bit (TXBnCTRL[3]) for the transmit buffer. The TXREQ bit is latched by the falling edge of the TXnRTS pin. The TXnRTS pins are designed to allow them to be tied directly to the RXnBF pins to automatically initiate a message transmission when the RXnBF pin goes low.

The TXnRTS pins have internal pull-up resistors of 100 k $\Omega$  (nominal).

## 3.6 Aborting Transmission

The MCU can request to abort a message in a specific message buffer by clearing the associated TXREQ bit.

In addition, all pending messages can be requested to be aborted by setting the ABAT bit (CANCTRL[4]). This bit MUST be reset (typically after the TXREQ bits have been verified to be cleared) to continue transmitting messages. The ABTF flag (TXBnCTRL[6]) will only be set if the abort was requested via the ABAT bit. Aborting a message by resetting the TXREQ bit does NOT cause the ABTF bit to be set.

**Note 1:** Messages that were transmitting when the abort was requested will continue to transmit. If the message does not successfully complete transmission (i.e., lost arbitration or was interrupted by an error frame), it will then be aborted.

**2:** When One-Shot mode is enabled, if the message is interrupted due to an error frame or loss of arbitration, the ABTF bit will set.

FIGURE 3-1: TRANSMIT MESSAGE FLOWCHARTFlowchart detailing the transmit message sequence:

1. **Start**
2. Decision: Are any TXREQ ( $TXBnCTRL[3]$ ) bits = 1?
3. *Annotation:* The message transmission sequence begins when the device determines that the TXREQ bit ( $TXBnCTRL[3]$ ) for any of the transmit registers has been set.
4. If No: Loop back to Step 2.
5. If Yes: Clear ABTF ( $TXBnCTRL[6]$ ), MLOA ( $TXBnCTRL[5]$ ), TXERR ( $TXBnCTRL[4]$ ).
6. Decision: Is CAN bus available to start transmission?
7. If No:
   - Decision: Is TXREQ = 0 or ABAT = 1?
   - *Annotation:* Clearing the TXREQ bit while it is set, or setting the ABAT bit (CANCTRL[4]) before the message has started transmission, will abort the message.
   - If Yes: Loop back to Step 5 (Clear ABTF...).
   - If No: Loop back to Step 2 (Are any TXREQ...).
8. If Yes (CAN bus available): Examine  $TXP[1:0]$  ( $TXBnCTRL[1:0]$ ) to Determine Highest Priority Message.
9. Transmit Message.
10. Decision: Was Message Transmitted Successfully?
11. If Yes:
    - Clear TXREQ bit.
    - Decision:  $TXnIE$  (CANINTE) = 1?
    - If Yes: Generate Interrupt.
    - If No: Set  $TXnIF$  (CANTINF).
12. If No (Transmission unsuccessful):
    - Decision: Message error or lost arbitration?
    - If Lost Arbitration: Set MLOA ( $TXBnCTRL[5]$ ).
    - If Message Error:
      - Set TXERR ( $TXBnCTRL[4]$ ).
      - Decision: MERRE (CANINTE)?
      - If Yes: Generate Interrupt.
      - If No: Set MERRF (CANTINF).

The  $TXnIE$  bit determines if an interrupt should be generated when a message is successfully transmitted.

All paths resulting in completion converge to GOTO START.

![](_page_16_Figure_2.jpeg)

# MCP2515

## REGISTER 3-1: TXBnCTRL: TRANSMIT BUFFER n CONTROL REGISTER (ADDRESS: 30h, 40h, 50h)

| U-0   | R-0  | R-0  | R-0   | R/W-0 | U-0 | R/W-0 | R/W-0 |
|-------|------|------|-------|-------|-----|-------|-------|
| —     | ABTF | MLOA | TXERR | TXREQ | —   | TXP1  | TXP0  |
| bit 7 |      |      |       |       |     |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **Unimplemented:** Read as '0'

bit 6 **ABTF:** Message Aborted Flag bit  
1 = Message was aborted  
0 = Message completed transmission successfully

bit 5 **MLOA:** Message Lost Arbitration bit  
1 = Message lost arbitration while being sent  
0 = Message did not lose arbitration while being sent

bit 4 **TXERR:** Transmission Error Detected bit  
1 = A bus error occurred while the message was being transmitted  
0 = No bus error occurred while the message was being transmitted

bit 3 **TXREQ:** Message Transmit Request bit  
1 = Buffer is currently pending transmission  
(MCU sets this bit to request message be transmitted – bit is automatically cleared when the message is sent)  
0 = Buffer is not currently pending transmission  
(MCU can clear this bit to request a message abort)

bit 2 **Unimplemented:** Read as '0'

bit 1-0 **TXP[1:0]:** Transmit Buffer Priority bits  
11 = Highest message priority  
10 = High intermediate message priority  
01 = Low intermediate message priority  
00 = Lowest message priority

REGISTER 3-2: TXRTSCTRL: TXnRTS PIN CONTROL AND STATUS REGISTER  
(ADDRESS: 0Dh)

| U-0   | U-0 | R-x   | R-x   | R-x   | R/W-0  | R/W-0  | R/W-0  |
|-------|-----|-------|-------|-------|--------|--------|--------|
| —     | —   | B2RTS | B1RTS | B0RTS | B2RTSM | B1RTSM | B0RTSM |
| bit 7 |     |       |       |       |        |        | bit 0  |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-6 **Unimplemented:** Read as '0'

bit 5 **B2RTS:** TX2RTS Pin State bit  
- Reads state of TX2RTS pin when in Digital Input mode  
- Reads as '0' when pin is in Request-to-Send mode

bit 4 **B1RTS:** TX1RTS Pin State bit  
- Reads state of TX1RTS pin when in Digital Input mode  
- Reads as '0' when pin is in Request-to-Send mode

bit 3 **B0RTS:** TX0RTS Pin State bit  
- Reads state of TX0RTS pin when in Digital Input mode  
- Reads as '0' when pin is in Request-to-Send mode

bit 2 **B2RTSM:** TX2RTS Pin mode bit  
1 = Pin is used to request message transmission of TXB2 buffer (on falling edge)  
0 = Digital input

bit 1 **B1RTSM:** TX1RTS Pin mode bit  
1 = Pin is used to request message transmission of TXB1 buffer (on falling edge)  
0 = Digital input

bit 0 **B0RTSM:** TX0RTS Pin mode bit  
1 = Pin is used to request message transmission of TXB0 buffer (on falling edge)  
0 = Digital input

# MCP2515

REGISTER 3-3: TXBnSIDH: TRANSMIT BUFFER n STANDARD IDENTIFIER REGISTER HIGH  
(ADDRESS: 31h, 41h, 51h)

| R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x |
|-------|-------|-------|-------|-------|-------|-------|-------|
| SID10 | SID9  | SID8  | SID7  | SID6  | SID5  | SID4  | SID3  |
| bit 7 |       |       |       |       |       |       | bit 0 |

**Legend:**

R = Readable bit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 SID[10:3]: Standard Identifier bits

REGISTER 3-4: TXBnSIDL: TRANSMIT BUFFER n STANDARD IDENTIFIER REGISTER LOW  
(ADDRESS: 32h, 42h, 52h)

| R/W-x | R/W-x | R/W-x | U-0 | R/W-x | U-0 | R/W-x | R/W-x |
|-------|-------|-------|-----|-------|-----|-------|-------|
| SID2  | SID1  | SID0  | —   | EXIDE | —   | EID17 | EID16 |
| bit 7 |       |       |     |       |     |       | bit 0 |

**Legend:**

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-5 SID[2:0]: Standard Identifier bits  
bit 4 Unimplemented: Read as '0'  
bit 3 EXIDE: Extended Identifier Enable bit  
        1 = Message will transmit Extended Identifier  
        0 = Message will transmit Standard Identifier  
bit 2 Unimplemented: Read as '0'  
bit 1-0 EID[17:16]: Extended Identifier bits

REGISTER 3-5: TXBnEID8: TRANSMIT BUFFER n EXTENDED IDENTIFIER 8 REGISTER HIGH (ADDRESS: 33h, 43h, 53h)

| R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x |
|-------|-------|-------|-------|-------|-------|-------|-------|
| EID15 | EID14 | EID13 | EID12 | EID11 | EID10 | EID9  | EID8  |
| bit 7 |       |       |       |       |       |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 EID[15:8]: Extended Identifier bits

REGISTER 3-6: TXBnEID0: TRANSMIT BUFFER n EXTENDED IDENTIFIER 0 REGISTER LOW (ADDRESS: 34h, 44h, 54h)

| R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x |
|-------|-------|-------|-------|-------|-------|-------|-------|
| EID7  | EID6  | EID5  | EID4  | EID3  | EID2  | EID1  | EID0  |
| bit 7 |       |       |       |       |       |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 EID[7:0]: Extended Identifier bits

# MCP2515

## REGISTER 3-7: TXBnDLC: TRANSMIT BUFFER n DATA LENGTH CODE REGISTER (ADDRESS: 35h, 45h, 55h)

| U-0   | R/W-x | U-0 | U-0 | R/W-x               | R/W-x               | R/W-x               | R/W-x               |
|-------|-------|-----|-----|---------------------|---------------------|---------------------|---------------------|
| —     | RTR   | —   | —   | DLC3 <sup>(1)</sup> | DLC2 <sup>(1)</sup> | DLC1 <sup>(1)</sup> | DLC0 <sup>(1)</sup> |
| bit 7 |       |     |     |                     |                     |                     | bit 0               |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **Unimplemented:** Read as '0'

bit 6 **RTR:** Remote Transmission Request bit  
1 = Transmitted message will be a remote transmit request  
0 = Transmitted message will be a data frame

bit 5-4 **Unimplemented:** Reads as '0'

bit 3-0 **DLC[3:0]:** Data Length Code bits<sup>(1)</sup>  
Sets the number of data bytes to be transmitted (0 to 8 bytes).

**Note 1:** It is possible to set the DLC[3:0] bits to a value greater than eight; however, only eight bytes are transmitted.

## REGISTER 3-8: TXBnDm: TRANSMIT BUFFER n DATA BYTE m REGISTER (ADDRESS: 36h-3Dh, 46h-4Dh, 56h-5Dh)

| R/W-x   | R/W-x   | R/W-x   | R/W-x   | R/W-x   | R/W-x   | R/W-x   | R/W-x   |
|---------|---------|---------|---------|---------|---------|---------|---------|
| TXBnDm7 | TXBnDm6 | TXBnDm5 | TXBnDm4 | TXBnDm3 | TXBnDm2 | TXBnDm1 | TXBnDm0 |
| bit 7   |         |         |         |         |         |         | bit 0   |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **TXBnDm[7:0]:** Transmit Buffer n Data Field Byte m bits

## 4.0 MESSAGE RECEPTION

### 4.1 Receive Message Buffering

The MCP2515 includes two full receive buffers with multiple acceptance filters for each. There is also a separate Message Assembly Buffer (MAB) that acts as a third receive buffer (see Figure 4-2).

#### 4.1.1 MESSAGE ASSEMBLY BUFFER

Of the three receive buffers, the MAB is always committed to receiving the next message from the bus. The MAB assembles all messages received. These messages will be transferred to the RXBn buffers (see Register 4-4 to Register 4-9) only if the acceptance filter criteria is met.

#### 4.1.2 RXB0 AND RXB1

The remaining two receive buffers, called RXB0 and RXB1, can receive a complete message from the protocol engine via the MAB. The MCU can access one buffer, while the other buffer is available for message reception, or for holding a previously received message.

**Note:** The entire content of the MAB is moved into the receive buffer once a message is accepted. This means, that regardless of the type of identifier (Standard or Extended) and the number of data bytes received, the entire receive buffer is overwritten with the MAB contents. Therefore, the contents of all registers in the buffer must be assumed to have been modified when any message is received.

#### 4.1.3 RECEIVE FLAGS/INTERRUPTS

When a message is moved into either of the receive buffers, the appropriate RXnIF bit (CANINTF) is set. This bit must be cleared by the MCU in order to allow a new message to be received into the buffer. This bit provides a positive lockout to ensure that the MCU has finished with the message before the MCP2515 attempts to load a new message into the receive buffer.

If the RXnIE bit (CANINTE) is set, an interrupt will be generated on the INT pin to indicate that a valid message has been received. In addition, the associated RXnBF pin will drive low if configured as a receive buffer full pin. See Section 4.4 "RX0BF and RX1BF Pins" for details.

### 4.2 Receive Priority

RXB0, the higher priority buffer, has one mask and two message acceptance filters associated with it. The received message is applied to the mask and filters for RXB0 first.

RXB1 is the lower priority buffer, with one mask and four acceptance filters associated with it.

In addition to the message being applied to the RXB0 mask and filters first, the lower number of acceptance filters makes the match on RXB0 more restrictive and implies a higher priority for that buffer.

When a message is received, the RXBnCTRL[3:0] register bits will indicate the acceptance filter number that enabled reception and whether the received message is a Remote Transfer Request.

#### 4.2.1 ROLLOVER

Additionally, the RXB0CTRL register can be configured such that, if RXB0 contains a valid message and another valid message is received, an overflow error will not occur and the new message will be moved into RXB1, regardless of the acceptance criteria of RXB1.

#### 4.2.2 RXM BITS

The RXM[1:0] bits (RXBnCTRL[6:5]) set special Receive modes. Normally, these bits are cleared to '00' to enable reception of all valid messages as determined by the appropriate acceptance filters. In this case, the determination of whether or not to receive standard or extended messages is determined by the EXIDE bit (RFXnSIDL[3]) in the Filter n Standard Identifier Low register.

If the RXM[1:0] bits are set to '11', the buffer will receive all messages, regardless of the values of the acceptance filters. Also, if a message has an error before the EOF, that portion of the message assembled in the MAB, before the error frame, will be loaded into the buffer. This mode has some value in debugging a CAN system and would not be used in an actual system environment.

Setting the RXM[1:0] bits to '01' or '10' is not recommended.

### 4.3 Start-of-Frame Signal

If enabled, the Start-of-Frame signal is generated on the SOF pin at the beginning of each CAN message detected on the RXCAN pin.

The RXCAN pin monitors an Idle bus for a recessive-to-dominant edge. If the dominant condition remains until the sample point, the MCP2515 interprets this as a SOF and a SOF pulse is generated. If the dominant condition does not remain until the sample point, the MCP2515 interprets this as a glitch on the bus and no SOF signal is generated. Figure 4-1 illustrates SOF signaling and glitch filtering.

As with One-Shot mode, one use for SOF signaling is for TTCAN-type systems. In addition, by monitoring both the RXCAN pin and the SOF pin, an MCU can detect early physical bus problems by detecting small glitches before they affect the CAN communications.

### 4.4 RX0BF and RX1BF Pins

In addition to the  $\overline{INT}$  pin, which provides an interrupt signal to the MCU for many different conditions, the Receive Buffer Full pins (RX0BF and RX1BF) can be used to indicate that a valid message has been loaded into RXB0 or RXB1, respectively. The pins have three different configurations (Table 4-1):

1. Disabled
2. Buffer Full Interrupt
3. Digital Output

FIGURE 4-1: START-OF-FRAME SIGNALING

Figure 4-1 illustrates two timing diagrams: Normal SOF Signaling and Glitch Filtering.

#### Normal SOF Signaling

The diagram shows the bus signal transitioning from recessive to dominant (START-OF-FRAME BIT), followed by the ID Bit. The RXCAN pin transitions high during the dominant state. The SOF signal is generated as a pulse at the beginning of the dominant state. The Sample Point is marked within the dominant state.

#### Glitch Filtering

The diagram shows the bus signal briefly transitioning to dominant (EXPECTED START-OF-FRAME BIT) and quickly returning to recessive (Bus Idle) before the Expected Sample Point. The RXCAN pin transitions high briefly corresponding to the glitch. The SOF signal remains low, indicating that no SOF pulse is generated.

![](_page_23_Figure_9.jpeg)

#### 4.4.1 DISABLED

The  $\overline{RXnBF}$  pins can be disabled to the high-impedance state by clearing the BnBFE bits (BFPCTRL[3:2]).

#### 4.4.2 CONFIGURED AS BUFFER FULL

The  $\overline{RXnBF}$  pins can be configured to act as either buffer full interrupt pins or as standard digital outputs. Configuration and status of these pins are available via the BFPCTRL register (Register 4-3). When set to operate in Interrupt mode by setting the BnBFE and BnBFM bits (BFPCTRL[3:0]), these pins are active-low and are mapped to the RXnIF bit (CANINTF) for each receive buffer. When this bit goes high for one of the receive buffers (indicating that a valid message has been loaded into the buffer), the corresponding  $\overline{RXnBF}$  pin will go low. When the RXnIF bit is cleared by the MCU, the corresponding interrupt pin will go to the logic high state until the next message is loaded into the receive buffer.

#### 4.4.3 CONFIGURED AS DIGITAL OUTPUT

When used as digital outputs, the BnBFM bits (BFPCTRL[1:0]) must be cleared and the BnBFE bits (BFPCTRL[3:2]) must be set for the associated buffer. In this mode, the state of the pin is controlled by the BnBFS bits (BFPCTRL[5:4]). Writing a '1' to a BnBFS bit will cause a high level to be driven on the associated buffer full pin, while a '0' will cause the pin to drive low. When using the pins in this mode, the state of the pin should be modified only by using the SPI **BIT MODIFY** command to prevent glitches from occurring on either of the buffer full pins.

TABLE 4-1: CONFIGURING  $\overline{RXnBF}$  PINS

| BnBFE | BnBFM | BnBFS | Pin Status               |
|-------|-------|-------|--------------------------|
| 0     | X     | X     | Disabled, high-impedance |
| 1     | 1     | X     | Receive buffer interrupt |
| 1     | 0     | 0     | Digital output = 0       |
| 1     | 0     | 1     | Digital output = 1       |

FIGURE 4-2: RECEIVE BUFFER BLOCK DIAGRAM

**Note:** Messages received in the MAB are initially applied to the mask and filters of RXB0. In addition, only one filter match occurs (e.g., if the message matches both RXF0 and RXF2, the match will be for RXF0 and the message will be moved into RXB0).

The diagram illustrates the Receive Buffer Block Diagram, showing how incoming messages from the Message Acceptance Buffer (MAB) are processed by acceptance masks and filters before being stored in Receive Buffers RXB0 or RXB1.

The MAB provides the Identifier and Data Field of the message.

**RXB0 Path (Left):**

- Acceptance Mask RXM0 is associated with Acceptance Filter RXF0.
- Acceptance Filters RXF0 and RXF1 receive Identifier and Data Field from the MAB.
- The acceptance outputs of RXF0 and RXF1 are combined into an "Accept" signal that directs the message into Receive Buffer RXB0.

**RXB1 Path (Right):**

- Acceptance Mask RXM1 is associated with Acceptance Filter RXF2.
- Acceptance Filters RXF2, RXF3, RXF4, and RXF5 are used for filtering. RXF5 receives Identifier and Data Field from the MAB.
- The acceptance outputs of RXF2, RXF3, RXF4, and RXF5 are combined into an "Accept" signal that directs the message into Receive Buffer RXB1.

The diagram visually represents the components: RXM0, RXF0, RXF1 feeding RXB0; and RXM1, RXF2, RXF3, RXF4, RXF5 feeding RXB1. The MAB is central, providing input to RXF1 and RXF5.

![](_page_24_Figure_6.jpeg)

FIGURE 4-3: RECEIVE FLOWCHARTFlowchart detailing the Receive Flowchart (MCP2515).

1. Start
2. Decision: Detect Start of Message?
   - If No: Generate Error Frame, then loop back to Start.
   - If Yes: Begin Loading Message into Message Assembly Buffer (MAB).
3. Decision: Valid Message Received?
   - If No: Generate Error Frame, then loop back to Start.
   - If Yes: Proceed to Filter checks.
4. Decision: Meets a Filter Criteria for RXB0?
   - If Yes: Proceed to RXB0 Handling.
   - If No: Proceed to Check RXB1 Filter Criteria.
5. Check RXB1 Filter Criteria: Meets a Filter Criteria for RXB1?
   - If Yes: Proceed to RXB1 Handling.
   - If No: Go to Start.
6. RXB0 Handling Path (If Filter Criteria Met):Determines if the Receive register is empty and able to accept a new message.

   Decision: Is  $RX0IF (CANINTF) = 0?$ 
   - If Yes (RXB0 Available):
     1. Move Message into RXB0.
     2. Set  $RX0IF (CANINTF[0]) = 1$ .
     3. Set  $FILHIT0 (RXB0CTRL[0])$  According to Which Filter Criteria.
     4. Proceed to RXB0 Interrupt Check.
   - If No (RXB0 Full):Determines if RXB0 can roll over into RXB1 if it is full.

     Decision: Is  $BUKT (RXB0CTRL[2]) = 1?$ 
     - If Yes (Roll Over Enabled): Proceed to RXB1 Availability Check (Is  $RX1IF (CANINTF[3]) = 0?$ ).
     - If No (Roll Over Disabled):
       1. Generate Overflow Error: Set  $RX0OVR (EFLG[6])$ .
       2. Proceed to ERRIE Check.
7. RXB1 Handling Path (If Filter Criteria Met OR RXB0 Roll Over Yes):Decision: Is  $RX1IF (CANINTF[3]) = 0?$ 
   - If Yes (RXB1 Available):
     1. Move Message into RXB1.
     2. Set  $RX1IF (CANINTF[3]) = 1$ .
     3. Set  $FILHIT[2:0] (RXB1CTRL[2:0])$  According to which Filter Criteria was Met.
     4. Proceed to RXB1 Interrupt Check.
   - If No (RXB1 Full):
     1. Generate Overflow Error: Set  $RX1OVR (EFLG[7])$ .
     2. Proceed to ERRIE Check.
8. Error Interrupt Check (ERRIE):Decision: Is  $ERRIE (CANINTE[5]) = 1?$ 
   - If Yes: Generate Interrupt on INT, then Go to Start.
   - If No: Go to Start.
9. RXB0 Post-Load Processing (After successful load into RXB0):
   1. Interrupt Check: Is  $RX0IE (CANINTE[0]) = 1?$ 
      - If Yes: Generate Interrupt on INT.
      - If No/After INT: Continue to Status Update.
   2. Status Update: Set  $CANSTAT[3:0]$  according to which receive buffer the message was loaded into.
   3. Pin Check: Are  $B0BFM (BFPCTRL[0]) = 1$  and  $B0BFE (BFPCTRL[2]) = 1?$ 
      - If Yes: Set  $RXBF0 Pin = 0$ .
      - If No/After Pin Set: Go to Start.
10. RXB1 Post-Load Processing (After successful load into RXB1):
    1. Interrupt Check: Is  $RX1IE (CANINTE[1]) = 1?$ 
       - If Yes: Generate Interrupt on INT.
       - If No/After INT: Continue to Status Update.
    2. Status Update: Set  $CANSTAT[3:0]$  according to which receive buffer the message was loaded into.
    3. Pin Check: Are  $B1BFM (BFPCTRL[1]) = 1$  and  $B1BFE (BF1CTRL[3]) = 1?$ 
       - If Yes: Set  $RXBF1 Pin = 0$ .
       - If No/After Pin Set: Go to Start.

![](_page_25_Figure_2.jpeg)

REGISTER 4-1: RXB0CTRL: RECEIVE BUFFER 0 CONTROL REGISTER (ADDRESS: 60h)

| U-0   | R/W-0 | R/W-0 | U-0 | R-0   | R/W-0 | R-0   | R-0                    |
|-------|-------|-------|-----|-------|-------|-------|------------------------|
| —     | RXM1  | RXM0  | —   | RXRTR | BUKT  | BUKT1 | FILHIT0 <sup>(1)</sup> |
| bit 7 |       |       |     |       |       |       | bit 0                  |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **Unimplemented:** Read as '0'

bit 6-5 **RXM[1:0]:** Receive Buffer Operating mode bits  
11 = Turns mask/filters off; receives any message  
10 = Reserved  
01 = Reserved  
00 = Receives all valid messages using either Standard or Extended Identifiers that meet filter criteria;  
Extended ID Filter registers, RXFnEID8:RXFnEID0, are applied to the first two bytes of data in  
the messages with standard IDs

bit 4 **Unimplemented:** Read as '0'

bit 3 **RXRTR:** Received Remote Transfer Request bit  
1 = Remote Transfer Request received  
0 = No Remote Transfer Request received

bit 2 **BUKT:** Rollover Enable bit  
1 = RXB0 message will roll over and be written to RXB1 if RXB0 is full  
0 = Rollover is disabled

bit 1 **BUKT1:** Read-Only Copy of BUKT bit (used internally by the MCP2515)

bit 0 **FILHIT0:** Filter Hit bit (indicates which acceptance filter enabled reception of message)<sup>(1)</sup>  
1 = Acceptance Filter 1 (RXF1)  
0 = Acceptance Filter 0 (RXF0)

**Note 1:** If a rollover from RXB0 to RXB1 occurs, the FILHIT0 bit will reflect the filter that accepted the message that rolled over.

# MCP2515

## REGISTER 4-2: RXB1CTRL: RECEIVE BUFFER 1 CONTROL REGISTER (ADDRESS: 70h)

| U-0   | R/W-0 | R/W-0 | U-0 | R-0   | R-0     | R-0     | R-0     |
|-------|-------|-------|-----|-------|---------|---------|---------|
| —     | RXM1  | RXM0  | —   | RXRTR | FILHIT2 | FILHIT1 | FILHIT0 |
| bit 7 |       |       |     |       |         |         | bit 0   |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **Unimplemented:** Read as '0'

bit 6-5 **RXM[1:0]:** Receive Buffer Operating mode bits  
11 = Turns mask/filters off; receives any message  
10 = Reserved  
01 = Reserved  
00 = Receives all valid messages using either Standard or Extended Identifiers that meet filter criteria

bit 4 **Unimplemented:** Read as '0'

bit 3 **RXRTR:** Received Remote Transfer Request bit  
1 = Remote Transfer Request received  
0 = No Remote Transfer Request received

bit 2-0 **FILHIT[2:0]:** Filter Hit bits (indicates which acceptance filter enabled reception of message)  
101 = Acceptance Filter 5 (RXF5)  
100 = Acceptance Filter 4 (RXF4)  
011 = Acceptance Filter 3 (RXF3)  
010 = Acceptance Filter 2 (RXF2)  
001 = Acceptance Filter 1 (RXF1) (only if the BUKT bit is set in RXB0CTRL)  
000 = Acceptance Filter 0 (RXF0) (only if the BUKT bit is set in RXB0CTRL)

REGISTER 4-3: BFPCTRL: RXnBF PIN CONTROL AND STATUS REGISTER (ADDRESS: 0Ch)

| U-0   | U-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-----|-------|-------|-------|-------|-------|-------|
| —     | —   | B1BFS | B0BFS | B1BFE | B0BFE | B1BFM | B0BFM |
| bit 7 |     |       |       |       |       |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-6 **Unimplemented:** Read as '0'

bit 5 **B1BFS:** RX1BF Pin State bit (Digital Output mode only)  
Reads as '0' when RX1BF is configured as an interrupt pin.

bit 4 **B0BFS:** RX0BF Pin State bit (Digital Output mode only)  
Reads as '0' when RX0BF is configured as an interrupt pin.

bit 3 **B1BFE:** RX1BF Pin Function Enable bit  
1 = Pin function is enabled, operation mode is determined by the B1BFM bit  
0 = Pin function is disabled, pin goes to a high-impedance state

bit 2 **B0BFE:** RX0BF Pin Function Enable bit  
1 = Pin function is enabled, operation mode is determined by the B0BFM bit  
0 = Pin function is disabled, pin goes to a high-impedance state

bit 1 **B1BFM:** RX1BF Pin Operation mode bit  
1 = Pin is used as an interrupt when a valid message is loaded into RXB1  
0 = Digital Output mode

bit 0 **B0BFM:** RX0BF Pin Operation mode bit  
1 = Pin is used as an interrupt when a valid message is loaded into RXB0  
0 = Digital Output mode

# MCP2515

## REGISTER 4-4: RXBnSIDH: RECEIVE BUFFER n STANDARD IDENTIFIER REGISTER HIGH (ADDRESS: 61h, 71h)

| R-x   | R-x  | R-x  | R-x  | R-x   | R-x  | R-x  | R-x  |
|-------|------|------|------|-------|------|------|------|
| SID10 | SID9 | SID8 | SID7 | SID6  | SID5 | SID4 | SID3 |
| bit 7 |      |      |      | bit 0 |      |      |      |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **SID[10:3]:** Standard Identifier bits

These bits contain the eight Most Significant bits of the Standard Identifier for the received message.

## REGISTER 4-5: RXBnSIDL: RECEIVE BUFFER n STANDARD IDENTIFIER REGISTER LOW (ADDRESS: 62h, 72h)

| R-x   | R-x  | R-x  | R-x | R-x   | U-0 | R-x   | R-x   |
|-------|------|------|-----|-------|-----|-------|-------|
| SID2  | SID1 | SID0 | SRR | IDE   | —   | EID17 | EID16 |
| bit 7 |      |      |     | bit 0 |     |       |       |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-5 **SID[2:0]:** Standard Identifier bits

These bits contain the three Least Significant bits of the Standard Identifier for the received message.

bit 4 **SRR:** Standard Frame Remote Transmit Request bit (valid only if IDE bit = 0)

1 = Standard frame Remote Transmit Request received  
0 = Standard data frame received

bit 3 **IDE:** Extended Identifier Flag bit

This bit indicates whether the received message was a standard or an extended frame.

1 = Received message was an extended frame  
0 = Received message was a standard frame

bit 2 **Unimplemented:** Read as '0'

bit 1-0 **EID[17:16]:** Extended Identifier bits

These bits contain the two Most Significant bits of the Extended Identifier for the received message.

REGISTER 4-6: RXBnEID8: RECEIVE BUFFER n EXTENDED IDENTIFIER REGISTER HIGH  
(ADDRESS: 63h, 73h)

| R-x   | R-x   | R-x   | R-x   | R-x   | R-x   | R-x  | R-x   |
|-------|-------|-------|-------|-------|-------|------|-------|
| EID15 | EID14 | EID13 | EID12 | EID11 | EID10 | EID9 | EID8  |
| bit 7 |       |       |       |       |       |      | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0EID[15:8]: Extended Identifier bitsThese bits hold bits 15 through 8 of the Extended Identifier for the received messageREGISTER 4-7: RXBnEID0: RECEIVE BUFFER n EXTENDED IDENTIFIER REGISTER LOW  
(ADDRESS: 64h, 74h)

| R-x   | R-x  | R-x  | R-x  | R-x  | R-x  | R-x  | R-x   |
|-------|------|------|------|------|------|------|-------|
| EID7  | EID6 | EID5 | EID4 | EID3 | EID2 | EID1 | EID0  |
| bit 7 |      |      |      |      |      |      | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0EID[7:0]: Extended Identifier bitsThese bits hold the Least Significant eight bits of the Extended Identifier for the received message.

# MCP2515

## REGISTER 4-8: RXBnDLC: RECEIVE BUFFER n DATA LENGTH CODE REGISTER (ADDRESS: 65h, 75h)

| U-0   | R-x | R-x | R-x | R-x  | R-x  | R-x  | R-x   |
|-------|-----|-----|-----|------|------|------|-------|
| —     | RTR | RB1 | RB0 | DLC3 | DLC2 | DLC1 | DLC0  |
| bit 7 |     |     |     |      |      |      | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **Unimplemented:** Read as '0'

bit 6 **RTR:** Extended Frame Remote Transmission Request bit (valid only when IDE (RXBnSIDL[3]) = 1)  
1 = Extended frame Remote Transmit Request received  
0 = Extended data frame received

bit 5 **RB1:** Reserved Bit 1

bit 4 **RB0:** Reserved Bit 0

bit 3-0 **DLC[3:0]:** Data Length Code bits  
Indicates the number of data bytes that were received.

## REGISTER 4-9: RXBnDm: RECEIVE BUFFER n DATA BYTE m REGISTER (ADDRESS: 66h-6Dh, 76h-7Dh)

| R-x   | R-x   | R-x   | R-x   | R-x   | R-x   | R-x   | R-x   |
|-------|-------|-------|-------|-------|-------|-------|-------|
| RBnD7 | RBnD6 | RBnD5 | RBnD4 | RBnD3 | RBnD2 | RBnD1 | RBnD0 |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **RBnD[7:0]:** Receive Buffer n Data Field Bytes m bits  
Eight bytes containing the data bytes for the received message.

## 4.5 Message Acceptance Filters and Masks

The message acceptance filters and masks are used to determine if a message in the Message Assembly Buffer should be loaded into either of the receive buffers (see Figure 4-5). Once a valid message has been received into the MAB, the identifier fields of the message are compared to the filter values. If there is a match, that message will be loaded into the appropriate receive buffer.

### 4.5.1 DATA BYTE FILTERING

When receiving standard data frames (11-bit identifier), the MCP2515 automatically applies 16 bits of masks and filters, normally associated with Extended Identifiers, to the first 16 bits of the data field (Data Bytes 0 and 1). Figure 4-4 illustrates how masks and filters apply to extended and standard data frames.

Data byte filtering reduces the load on the MCU when implementing Higher Layer Protocols (HLPs) that filter on the first data byte (e.g., DeviceNet™).

### 4.5.2 FILTER MATCHING

The filter masks (see Register 4-14 through Register 4-17) are used to determine which bits in the identifier are examined with the filters. A truth table is shown in Table 4-2 that indicates how each bit in the

identifier is compared to the masks and filters to determine if the message should be loaded into a receive buffer. The mask essentially determines which bits to apply the acceptance filters to. If any mask bit is set to a zero, that bit will automatically be accepted, regardless of the filter bit.

TABLE 4-2: FILTER/MASK TRUTH TABLE

| Mask Bit n | Filter Bit n | Message Identifier Bit | Accept or Reject Bit n |
|------------|--------------|------------------------|------------------------|
| 0          | x            | x                      | Accept                 |
| 1          | 0            | 0                      | Accept                 |
| 1          | 0            | 1                      | Reject                 |
| 1          | 1            | 0                      | Reject                 |
| 1          | 1            | 1                      | Accept                 |

Note: x = don't care

As shown in the Receive Buffer Block Diagram (Figure 4-2), acceptance filters, RXF<sub>0</sub> and RXF<sub>1</sub> (and filter mask, RXM<sub>0</sub>), are associated with RXB<sub>0</sub>. The filters, RXF<sub>2</sub>, RXF<sub>3</sub>, RXF<sub>4</sub>, RXF<sub>5</sub> and mask RXM<sub>1</sub>, are associated with RXB<sub>1</sub>.

FIGURE 4-4: MASKS AND FILTERS APPLY TO CAN FRAMES

**Extended Frame**

ID10 ID0 EID17 EID0

Masks and Filters Apply to the Entire 29-Bit ID Field

**Standard Data Frame**

ID10 ID0 \* Data Byte 0 Data Byte 1

11-Bit ID Standard Frame 16-Bit Data Filtering\*

\*The two MSBs' (EID<sub>17</sub> and EID<sub>16</sub>) mask and filter bits are not used.

![](_page_32_Figure_14.jpeg)

### 4.5.3 FILHIT BITS

Filter matches on received messages can be determined by the FILHIT bits in the associated RXBnCTRL register; FILHIT0 (RXB0CTRL[0]) for Buffer 0 and FILHIT[2:0] (RXB1CTRL[2:0]) for Buffer 1.

The three FILHITn bits for Receive Buffer 1 (RXB1) are coded as follows:

- 101 = Acceptance Filter 5 (RXF5)
- 100 = Acceptance Filter 4 (RXF4)
- 011 = Acceptance Filter 3 (RXF3)
- 010 = Acceptance Filter 2 (RXF2)
- 001 = Acceptance Filter 1 (RXF1)
- 000 = Acceptance Filter 0 (RXF0)

**Note:** '000' and '001' can only occur if the BUKT bit in RXB0CTRL is set, allowing RXB0 messages to roll over into RXB1.

RXB0CTRL contains two copies of the BUKT bit and a copy of the FILHIT0 bit.

The coding of the BUKT bit enables these three bits to be used similarly to the FILHIT[2:0] (RXB1CTRL[2:0]) bits and to distinguish a hit on filters, RXF0 and RXF1, in either RXB0 or after a rollover into RXB1.

- 111 = Acceptance Filter 1 (RXB1)
- 110 = Acceptance Filter 0 (RXB1)
- 001 = Acceptance Filter 1 (RXB0)
- 000 = Acceptance Filter 0 (RXB0)

If the BUKT bit is clear, there are six codes corresponding to the six filters. If the BUKT bit is set, there are six codes corresponding to the six filters, plus two additional codes corresponding to the RXF0 and RXF1 filters that roll over into RXB1.

### 4.5.4 MULTIPLE FILTER MATCHES

If more than one acceptance filter matches, the FILHITn bits will encode the binary value of the lowest numbered filter that matched. For example, if filters, RXF2 and RXF4, match, the FILHITn bits will be loaded with the value for RXF2. This essentially prioritizes the acceptance filters with a lower numbered filter having higher priority. Messages are compared to filters in ascending order of filter number. This also ensures that the message will only be received into one buffer. This implies that RXB0 has a higher priority than RXB1.

### 4.5.5 CONFIGURING THE MASKS AND FILTERS

The Mask and Filter registers can only be modified when the MCP2515 is in Configuration mode (see [Section 10.0 "Modes of Operation"](#)).

**Note:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

**FIGURE 4-5:** MESSAGE ACCEPTANCE MASK AND FILTER OPERATION

![Logic diagram showing Message Acceptance Mask and Filter Operation. The diagram compares bits from the Message Assembly Buffer Identifier against Acceptance Filter Register bits (RXF<math>n_0</math>, RXF<math>n_1</math>, ... RXF<math>n_n</math>) and Acceptance Mask Register bits (RXM<math>n_0</math>, RXM<math>n_1</math>, ... RXM<math>n_n</math>). For each bit position, the filter bit and identifier bit are compared using an XNOR gate (XOR symbol with output bubble). The result of this comparison is ORed with the inverted mask bit (NOT RXM<math>n_i</math>). The results of all bit comparisons are combined (implicitly ANDed) to generate the RxRqst signal.]()![](_page_33_Figure_16.jpeg)

**REGISTER 4-10: RXFnSIDH: FILTER n STANDARD IDENTIFIER REGISTER HIGH**  
(ADDRESS: 00h, 04h, 08h, 10h, 14h, 18h)<sup>(1)</sup>

| R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x |
|-------|-------|-------|-------|-------|-------|-------|-------|
| SID10 | SID9  | SID8  | SID7  | SID6  | SID5  | SID4  | SID3  |
| bit 7 |       |       |       |       |       |       | bit 0 |

**Legend:**R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **SID[10:3]:** Standard Identifier Filter bits

These bits hold the filter bits to be applied to bits[10:3] of the Standard Identifier portion of a received message.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

**REGISTER 4-11: RXFnSIDL: FILTER n STANDARD IDENTIFIER REGISTER LOW**  
(ADDRESS: 01h, 05h, 09h, 11h, 15h, 19h)<sup>(1)</sup>

| R/W-x | R/W-x | R/W-x | U-0 | R/W-x | U-0 | R/W-x | R/W-x |
|-------|-------|-------|-----|-------|-----|-------|-------|
| SID2  | SID1  | SID0  | —   | EXIDE | —   | EID17 | EID16 |
| bit 7 |       |       |     |       |     |       | bit 0 |

**Legend:**R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-5 **SID[2:0]:** Standard Identifier Filter bits

These bits hold the filter bits to be applied to bits[2:0] of the Standard Identifier portion of a received message.

bit 4 **Unimplemented:** Read as '0'

bit 3 **EXIDE:** Extended Identifier Enable bit  
1 = Filter is applied only to extended frames  
0 = Filter is applied only to standard frames

bit 2 **Unimplemented:** Read as '0'

bit 1-0 **EID[17:16]:** Extended Identifier Filter bits  
These bits hold the filter bits to be applied to bits[17:16] of the Extended Identifier portion of a received message.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

# MCP2515

## REGISTER 4-12: RXFnEID8: FILTER n EXTENDED IDENTIFIER REGISTER HIGH (ADDRESS: 02h, 06h, 0Ah, 12h, 16h, 1Ah)<sup>(1)</sup>

| R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x |
|-------|-------|-------|-------|-------|-------|-------|-------|
| EID15 | EID14 | EID13 | EID12 | EID11 | EID10 | EID9  | EID8  |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 EID[15:8]: Extended Identifier bits

These bits hold the filter bits to be applied to bits[15:8] of the Extended Identifier portion of a received message or to Byte 0 in received data if the corresponding RXM[1:0] bits = 00 and EXIDE = 0.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

## REGISTER 4-13: RXFnEID0: FILTER n EXTENDED 1 REGISTER LOW (ADDRESS: 03h, 07h, 0Bh, 13h, 17h, 1Bh)<sup>(1)</sup>

| R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x | R/W-x |
|-------|-------|-------|-------|-------|-------|-------|-------|
| EID7  | EID6  | EID5  | EID4  | EID3  | EID2  | EID1  | EID0  |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 EID[7:0]: Extended Identifier bits

These bits hold the filter bits to be applied to bits[7:0] of the Extended Identifier portion of a received message or to Byte 1 in received data if the corresponding RXM[1:0] bits = 00 and EXIDE = 0.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

REGISTER 4-14: RXMnSIDH: MASK n STANDARD IDENTIFIER REGISTER HIGH  
(ADDRESS: 20h, 24h)<sup>(1)</sup>

| R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| SID10 | SID9  | SID8  | SID7  | SID6  | SID5  | SID4  | SID3  |
| bit 7 |       |       |       |       |       |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **SID[10:3]:** Standard Identifier Mask bits

These bits hold the mask bits to be applied to bits[10:3] of the Standard Identifier portion of a received message.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

REGISTER 4-15: RXMnSIDL: MASK n STANDARD IDENTIFIER REGISTER LOW  
(ADDRESS: 21h, 25h)<sup>(1)</sup>

| R/W-0 | R/W-0 | R/W-0 | U-0 | U-0 | U-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-----|-----|-----|-------|-------|
| SID2  | SID1  | SID0  | —   | —   | —   | EID17 | EID16 |
| bit 7 |       |       |     |     |     |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-5 **SID[2:0]:** Standard Identifier Mask bits

These bits hold the mask bits to be applied to bits[2:0] of the Standard Identifier portion of a received message.

bit 4-2 **Unimplemented:** Reads as '0'

bit 1-0 **EID[17:16]:** Extended Identifier Mask bits

These bits hold the mask bits to be applied to bits[17:16] of the Extended Identifier portion of a received message.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

# MCP2515

## REGISTER 4-16: RXMnEID8: MASK n EXTENDED IDENTIFIER REGISTER HIGH (ADDRESS: 22h, 26h)<sup>(1)</sup>

| R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| EID15 | EID14 | EID13 | EID12 | EID11 | EID10 | EID9  | EID8  |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **EID[15:8]:** Extended Identifier bits

These bits hold the filter bits to be applied to bits[15:8] of the Extended Identifier portion of a received message. If the corresponding RXM[1:0] bits = 00 and EXIDE = 0, these bits are applied to Byte 0 in received data.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

## REGISTER 4-17: RXMnEID0: MASK n EXTENDED IDENTIFIER REGISTER LOW (ADDRESS: 23h, 27h)<sup>(1)</sup>

| R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| EID7  | EID6  | EID5  | EID4  | EID3  | EID2  | EID1  | EID0  |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **EID[7:0]:** Extended Identifier Mask bits

These bits hold the filter bits to be applied to bits[7:0] of the Extended Identifier portion of a received message. If the corresponding RXM[1:0] bits = 00 and EXIDE = 0, these bits are applied to Byte 1 in received data.

**Note 1:** The Mask and Filter registers read all '0's when in any mode except Configuration mode.

## 5.0 BIT TIMING

All nodes on a given CAN bus must have the same Nominal Bit Rate (NBR). The CAN protocol uses Non-Return-to-Zero (NRZ) coding, which does not encode a clock within the data stream. Therefore, the receive clock must be recovered by the receiving nodes and synchronized to the transmitter's clock.

As oscillators and transmission times may vary from node to node, the receiver must have some type of Phase-Locked Loop (PLL) synchronized to data transmission edges to synchronize and maintain the receiver clock. Since the data are NRZ coded, it is necessary to include bit-stuffing to ensure that an edge occurs, at least every six bit times, to maintain the Digital Phase-Locked Loop (DPLL) synchronization.

The bit timing of the MCP2515 is implemented using a DPLL that is configured to synchronize to the incoming data, as well as provide the nominal timing for the transmitted data. The DPLL breaks each bit time into multiple segments made up of minimal periods of time, called the Time Quanta ( $T_Q$ ).

Bus timing functions executed within the bit time frame (such as synchronization to the local oscillator, network transmission delay compensation and sample point positioning) are defined by the programmable Bit Timing Logic (BTL) of the DPLL.

### 5.1 The CAN Bit Time

All devices on the CAN bus must use the same bit rate. However, all devices are not required to have the same master oscillator clock frequency. For the different clock frequencies of the individual devices, the bit rate has to be adjusted by appropriately setting the Baud Rate Prescaler and number of Time Quanta in each segment.

The CAN bit time is made up of non-overlapping segments. Each of these segments is made up of integer units, called Time Quanta ( $T_Q$ ), explained later in this data sheet. The Nominal Bit Rate (NBR) is defined in the CAN specification as the number of bits per second, transmitted by an ideal transmitter, with no resynchronization. It can be described with the equation:

**EQUATION 5-1:**

$$NBR = f_{bit} = rac{1}{t_{bit}}$$

### 5.2 Nominal Bit Time

The Nominal Bit Time (NBT) ( $t_{bit}$ ) is made up of non-overlapping segments (Figure 5-1). Therefore, the NBT is the summation of the following segments:

$$t_{bit} = t_{SyncSeg} + t_{PropSeg} + t_{PS1} + t_{PS2}$$

Associated with the NBT are the sample point, Synchronization Jump Width (SJW) and Information Processing Time (IPT), which are explained later.

#### 5.2.1 SYNCHRONIZATION SEGMENT

The Synchronization Segment (SyncSeg) is the first segment in the NBT and is used to synchronize the nodes on the bus. Bit edges are expected to occur within the SyncSeg. This segment is fixed at 1  $T_Q$ .

**FIGURE 5-1:** CAN BIT TIME SEGMENTS

![Diagram illustrating the CAN Bit Time Segments. The Nominal Bit Time (NBT), t_{bit}, is shown as a duration composed of four sequential, non-overlapping segments: SyncSeg, PropSeg, PhaseSeg1 (PS1), and PhaseSeg2 (PS2). A vertical arrow indicates the Sample Point located at the boundary between PhaseSeg1 (PS1) and PhaseSeg2 (PS2).]()![](_page_38_Figure_18.jpeg)

### 5.2.2 PROPAGATION SEGMENT

The Propagation Segment (PropSeg) exists to compensate for physical delays between nodes. The propagation delay is defined as twice the sum of the signal's propagation time on the bus line, including the delays associated with the bus driver. The PropSeg is programmable from 1-8  $T_{QS}$ .

### 5.2.3 PHASE SEGMENT 1 (PS1) AND PHASE SEGMENT 2 (PS2)

The two Phase Segments, PS1 and PS2, are used to compensate for edge phase errors on the bus. PS1 can be lengthened (or PS2 shortened) by resynchronization. PS1 is programmable from 1-8  $T_{QS}$  and PS2 is programmable from 2-8  $T_{QS}$ .

### 5.2.4 SAMPLE POINT

The sample point is the point in the bit time at which the logic level is read and interpreted. The sample point is located at the end of PS1. The exception to this rule is if the Sample mode is configured to sample three times per bit. In this case, while the bit is still sampled at the end of PS1, two additional samples are taken at one-half  $T_Q$  intervals prior to the end of PS1, with the value of the bit being determined by a majority decision.

### 5.2.5 INFORMATION PROCESSING TIME

The Information Processing Time (IPT) is the time required for the logic to determine the bit level of a sampled bit. The IPT begins at the sample point, is measured in  $T_Q$  and is fixed at 2  $T_{QS}$  for the Microchip CAN module. Since PS2 also begins at the sample point and is the last segment in the bit time, it is required that the PS2 minimum is not less than the IPT.

Therefore:

$$PS2_{min} = IPT = 2 T_{QS}$$

### 5.2.6 SYNCHRONIZATION JUMP WIDTH

The Synchronization Jump Width (SJW) adjusts the bit clock, as necessary, by 1-4  $T_{QS}$  (as configured) to maintain synchronization with the transmitted message. Synchronization is covered in more detail later in this data sheet.

## 5.3 Time Quantum

Each of the segments that make up a bit time are made up of integer units, called Time Quanta ( $T_Q$ ). The length of each Time Quantum is based on the oscillator period ( $T_{OSC}$ ). The base  $T_Q$  equals twice the oscillator period. Figure 5-2 shows how the bit period is derived from  $T_{OSC}$  and  $T_Q$ . The  $T_Q$  length equals one  $T_Q$  clock period ( $t_{BRPCLK}$ ), which is programmable using a programmable prescaler, called the Baud Rate Prescaler (BRP). This is illustrated in the following equation:

### EQUATION 5-2:

$$T_Q = 2 \cdot BRP \cdot T_{OSC} = \frac{2 \cdot BRP}{F_{OSC}}$$

Where: BRP equals the configuration as shown in Register 5-1.

FIGURE 5-2:  $T_Q$  AND THE BIT PERIOD

Figure 5-2 illustrates the relationship between the oscillator period ( $T_{OSC}$ ), the Baud Rate Prescaler clock period ( $T_{BRPCLK}$ ), the Time Quantum ( $T_Q$ ), and the CAN Bit Time ( $t_{bit}$ ).

The diagram shows three stacked waveforms:

- The top waveform represents  $T_{OSC}$ , the oscillator period.
- The middle waveform represents  $T_{BRPCLK}$ , the Baud Rate Prescaler clock period, which is derived from  $T_{OSC}$ .
- The bottom waveform represents the CAN Bit Time ( $t_{bit}$ ), which is composed of four segments: Sync (fixed), PropSeg (Programmable), PS1 (Programmable), and PS2 (Programmable).

The Time Quantum ( $T_Q$ ) is defined as the duration of one  $T_{BRPCLK}$  period, which is also the duration of one segment of the CAN Bit Time.

![](_page_39_Figure_19.jpeg)

## 5.4 Synchronization

To compensate for phase shifts between the oscillator frequencies of each of the nodes on the bus, each CAN controller must be able to synchronize to the relevant signal edge of the incoming signal. Synchronization is the process by which the DPLL function is implemented.

When an edge in the transmitted data is detected, the logic will compare the location of the edge to the expected time (SyncSeg). The circuit will then adjust the values of PS1 and PS2 as necessary.

There are two mechanisms used for synchronization:

1. Hard synchronization
2. Resynchronization

### 5.4.1 HARD SYNCHRONIZATION

Hard synchronization is only performed when there is a recessive-to-dominant edge during a Bus Idle condition, indicating the start of a message. After hard synchronization, the bit time counters are restarted with SyncSeg.

Hard synchronization forces the edge that has occurred to lie within the Synchronization Segment of the restarted bit time. Due to the rules of synchronization, if a hard synchronization occurs, there will not be a resynchronization within that bit time.

### 5.4.2 RESYNCHRONIZATION

As a result of resynchronization, PS1 may be lengthened or PS2 may be shortened. The amount of lengthening or shortening of the Phase Buffer Segments has an upper bound, given by the Synchronization Jump Width (SJW).

The value of the SJW will be added to PS1 or subtracted from PS2 (see Figure 5-3). The SJW represents the loop filtering of the DPLL. The SJW is programmable between 1  $T_Q$  and 4  $T_Q$ s.

#### 5.4.2.1 Phase Errors

The NRZ bit coding method does not encode a clock into the message. Clocking information will only be derived from recessive-to-dominant transitions. The property which states that only a fixed maximum number of successive bits have the same value (bit-stuffing) ensures resynchronization to the bit stream during a frame.

The phase error of an edge is given by the position of the edge relative to SyncSeg, measured in  $T_Q$ . The phase error is defined in a magnitude of  $T_Q$  as follows:

- $e = 0$  if the edge lies within SyncSeg
- $e > 0$  if the edge lies before the sample point ( $T_Q$  is added to PS1)
- $e < 0$  if the edge lies after the sample point of the previous bit ( $T_Q$  is subtracted from PS2)

#### 5.4.2.2 No Phase Error ( $e = 0$ )

If the magnitude of the phase error is less than or equal to the programmed value of the SJW, the effect of a resynchronization is the same as that of a hard synchronization.

#### 5.4.2.3 Positive Phase Error ( $e > 0$ )

If the magnitude of the phase error is larger than the SJW, and if the phase error is positive, PS1 is lengthened by an amount equal to the SJW.

#### 5.4.2.4 Negative Phase Error ( $e < 0$ )

If the magnitude of the phase error is larger than the resynchronization jump width, and the phase error is negative, PS2 is shortened by an amount equal to the SJW.

### 5.4.3 SYNCHRONIZATION RULES

1. Only recessive-to-dominant edges will be used for synchronization.
2. Only one synchronization within one bit time is allowed.
3. An edge will be used for synchronization only if the value detected at the previous sample point (previously read bus value) differs from the bus value immediately after the edge.
4. A transmitting node will not resynchronize on a positive phase error ( $e > 0$ ).
5. If the absolute magnitude of the phase error is greater than the SJW, the appropriate Phase Segment will adjust by an amount equal to the SJW.

FIGURE 5-3: SYNCHRONIZING THE BIT TIMEThe figure illustrates three scenarios for synchronizing the bit time in a CAN controller, showing the composition of the bit time (SyncSeg, PropSeg, PhaseSeg1 (PS1), and PhaseSeg2 (PS2)) and the effect of the Synchronization Jump Width (SJW):

1. **No Resynchronization ( $e = 0$ ):** The Nominal Bit Time (NBT) is equal to the Actual Bit Time. The sample point is located at the boundary between PhaseSeg1 (PS1) and PhaseSeg2 (PS2). The Input Signal is labeled  $e = 0$ .
2. **Resynchronization to a Slower Transmitter ( $e > 0$ ):** The Actual Bit Time is longer than the Nominal Bit Time (NBT). The sample point is adjusted earlier (towards the SyncSeg boundary) to maintain synchronization. The Input Signal is labeled  $e > 0$ .
3. **Resynchronization to a Faster Transmitter ( $e < 0$ ):** The Actual Bit Time is shorter than the Nominal Bit Time (NBT). The sample point is adjusted later (towards the PhaseSeg2 boundary) to maintain synchronization. The Input Signal is labeled  $e < 0$ .

![](_page_41_Figure_2.jpeg)

## 5.5 Programming Time Segments

Some requirements for programming of the Time Segments:

- $\text{PropSeg} + \text{PS1} \ge \text{PS2}$
- $\text{PropSeg} + \text{PS1} \ge T_{\text{DELAY}}$
- $\text{PS2} \ge \text{SJW}$

For example, assuming that a 125 kHz CAN baud rate with  $F_{\text{OSC}} = 20$  MHz is desired:

 $T_{\text{OSC}} = 50$  ns, choose BRP[5:0] = 04h, then  $T_Q = 500$  ns. To obtain 125 kHz, the bit time must be  $16 T_Q$ s.

Typically, the sampling of the bit should take place at about 60-70% of the bit time, depending on the system parameters. Also, typically, the  $T_{\text{DELAY}}$  is 1-2  $T_Q$ s.

SyncSeg = 1  $T_Q$  and PropSeg = 2  $T_Q$ s. So setting PS1 = 7  $T_Q$ s would place the sample at 10  $T_Q$ s after the transition. This would leave 6  $T_Q$ s for PS2.

Since PS2 is 6, according to the rules, SJW could be a maximum of 4  $T_Q$ s. However, a large SJW is typically only necessary when the clock generation of the different nodes is inaccurate or unstable, such as using ceramic resonators. So a SJW of 1 is usually enough.

## 5.6 Oscillator Tolerance

The bit timing requirements allow ceramic resonators to be used in applications with transmission rates of up to 125 kbit/sec as a rule of thumb. For the full bus speed range of the CAN protocol, a quartz oscillator is required. A maximum node-to-node oscillator variation of 1.7% is allowed.

## 5.7 Bit Timing Configuration Registers

The Configuration registers (CNF1, CNF2, CNF3) control the bit timing for the CAN bus interface. These registers can only be modified when the MCP2515 is in Configuration mode (see [Section 10.0 "Modes of Operation"](#)).

### 5.7.1 CNF1

The BRP[5:0] bits control the Baud Rate Prescaler. These bits set the length of  $T_Q$  relative to the OSC1 input frequency, with the minimum  $T_Q$  length being  $2 T_{\text{OSC}}$  (when BRP[5:0] = b000000). The SJW[1:0] bits select the SJW in terms of number of  $T_Q$ s.

### 5.7.2 CNF2

The PRSEG[2:0] bits set the length (in  $T_Q$ s) of the Propagation Segment. The PHSEG1[2:0] bits set the length (in  $T_Q$ s) of PS1.

The SAM bit controls how many times the RXCAN pin is sampled. Setting this bit to a '1' causes the bus to be sampled three times: twice at  $T_Q/2$  before the sample point and once at the normal sample point (which is at the end of PS1). The value of the bus is determined to be the majority sampled. If the SAM bit is set to a '0', the RXCAN pin is sampled only once at the sample point.

The BTLMODE bit controls how the length of PS2 is determined. If this bit is set to a '1', the length of PS2 is determined by the PHSEG2[2:0] bits of CNF3 (see [Section 5.7.3 "CNF3"](#)). If the BTLMODE bit is set to a '0', the length of PS2 is greater than that of PS1 and the Information Processing Time (which is fixed at  $2 T_Q$ s for the MCP2515).

### 5.7.3 CNF3

The PHSEG2[2:0] bits set the length (in  $T_Q$ s) of PS2 if the BTLMODE bit (CNF2[7]) is set to a '1'. If the BTLMODE bit is set to a '0', the PHSEG2[2:0] bits have no effect.

# MCP2515

## REGISTER 5-1: CNF1: CONFIGURATION REGISTER 1 (ADDRESS: 2Ah)

| R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| SJW1  | SJW0  | BRP5  | BRP4  | BRP3  | BRP2  | BRP1  | BRP0  |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-6 **SJW[1:0]**: Synchronization Jump Width Length bits

11 = Length =  $4 \times T_Q$   
10 = Length =  $3 \times T_Q$   
01 = Length =  $2 \times T_Q$   
00 = Length =  $1 \times T_Q$ 

bit 5-0 **BRP[5:0]**: Baud Rate Prescaler bits

 $T_Q = 2 \times (BRP[5:0] + 1)/F_{osc}$ .

## REGISTER 5-2: CNF2: CONFIGURATION REGISTER 2 (ADDRESS: 29h)

| R/W-0   | R/W-0 | R/W-0       | R/W-0 | R/W-0 | R/W-0  | R/W-0  | R/W-0  |
|---------|-------|-------------|-------|-------|--------|--------|--------|
| BTLMODE | SAM   | PHSEG1[2:0] |       |       | PRSEG2 | PRSEG1 | PRSEG0 |
| bit 7   |       |             |       |       |        |        | bit 0  |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **BTLMODE**: PS2 Bit Time Length bit

1 = Length of PS2 is determined by the PHSEG2[2:0] bits of CNF3  
0 = Length of PS2 is the greater of PS1 and IPT ( $2 T_Q$ s)

bit 6 **SAM**: Sample Point Configuration bit

1 = Bus line is sampled three times at the sample point  
0 = Bus line is sampled once at the sample point

bit 5-3 **PHSEG1[2:0]**: PS1 Length bits

(PHSEG1[2:0] + 1)  $\times T_Q$ .

bit 2-0 **PRSEG[2:0]**: Propagation Segment Length bits

(PRSEG[2:0] + 1)  $\times T_Q$ .

REGISTER 5-3: CNF3: CONFIGURATION REGISTER 3 (ADDRESS: 28h)

| R/W-0 | R/W-0  | U-0 | U-0 | U-0 | R/W-0       | R/W-0 | R/W-0 |
|-------|--------|-----|-----|-----|-------------|-------|-------|
| SOF   | WAKFIL | —   | —   | —   | PHSEG2[2:0] |       |       |
| bit 7 |        |     |     |     |             |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **SOF**: Start-of-Frame Signal bit  
If CLKEN (CANCTRL[2]) = 1:  
1 = CLKOUT pin is enabled for SOF signal  
0 = CLKOUT pin is enabled for clock out function  
If CLKEN (CANCTRL[2]) = 0:  
Bit is don't care.

bit 6 **WAKFIL**: Wake-up Filter bit  
1 = Wake-up filter is enabled  
0 = Wake-up filter is disabled

bit 5-3 **Unimplemented**: Reads as '0'

bit 2-0 **PHSEG2[2:0]**: PS2 Length bits  
(PHSEG2[2:0] + 1) x  $T_Q$ . Minimum valid setting for PS2 is 2  $T_Q$ s.

# MCP2515

NOTES:

## 6.0 ERROR DETECTION

The CAN protocol provides sophisticated error detection mechanisms. The following errors can be detected.

### 6.1 CRC Error

With the Cyclic Redundancy Check (CRC), the transmitter calculates special check bits for the bit sequence from the Start-of-Frame until the end of the data field. This CRC sequence is transmitted in the CRC field. The receiving node also calculates the CRC sequence using the same formula and performs a comparison to the received sequence. If a mismatch is detected, a CRC error has occurred and an error frame is generated. The message is repeated.

### 6.2 Acknowledge Error

In the Acknowledge field of a message, the transmitter checks if the Acknowledge Slot bit (which has been sent out as a recessive bit) contains a dominant bit. If not, no other node has received the frame correctly. An Acknowledge error has occurred, an error frame is generated and the message will have to be repeated.

### 6.3 Form Error

If a node detects a dominant bit in one of the four segments (including End-of-Frame, interframe space, Acknowledge delimiter or CRC delimiter), a form error has occurred and an error frame is generated. The message is repeated.

### 6.4 Bit Error

A bit error occurs if a transmitter detects the opposite bit level to what it transmitted (i.e., transmitted a dominant and detected a recessive, or transmitted a recessive and detected a dominant).

**Exception:** In the case where the transmitter sends a recessive bit, and a dominant bit is detected during the arbitration field and the Acknowledge Slot, no bit error is generated because normal arbitration is occurring.

### 6.5 Stuff Error

If, between the Start-of-Frame and the CRC delimiter, six consecutive bits with the same polarity are detected, the bit-stuffing rule has been violated. A stuff error occurs and an error frame is generated. The message is repeated.

### 6.6 Error States

Detected errors are made known to all other nodes via error frames. The transmission of the erroneous message is aborted and the frame is repeated as soon as possible. Furthermore, each CAN node is in one of the three error states according to the value of the internal error counters:

1. Error-active.
2. Error-passive.
3. Bus-off (transmitter only).

The error-active state is the usual state where the node can transmit messages and active error frames (made of dominant bits) without any restrictions.

In the error-passive state, messages and passive error frames (made of recessive bits) may be transmitted.

The bus-off state makes it temporarily impossible for the station to participate in the bus communication. During this state, messages can neither be received or transmitted. Only transmitters can go bus-off.

### 6.7 Error Modes and Error Counters

The MCP2515 contains two error counters: the Receive Error Counter (REC) (see [Register 6-2](#)) and the Transmit Error Counter (TEC) (see [Register 6-1](#)). The values of both counters can be read by the MCU. These counters are incremented/decremented in accordance with the CAN bus specification.

The MCP2515 is error-active if both error counters are below the error-passive limit of 128.

It is error-passive if at least one of the error counters equals or exceeds 128.

It goes to bus-off if the TEC exceeds the bus-off limit of 255. The device remains in this state until the bus-off recovery sequence is received. The bus-off recovery sequence consists of 128 occurrences of 11 consecutive recessive bits (see [Figure 6-1](#)).

**Note:** The MCP2515, after going bus-off, will recover back to error-active without any intervention by the MCU if the bus remains idle for  $128 \times 11$  bit times. If this is not desired, the error Interrupt Service Routine (ISR) should address this.

The current Error mode of the MCP2515 can be read by the MCU via the EFLG register (see [Register 6-3](#)).

Additionally, there is an error state warning flag bit, EWARN (EFLG[0]), which is set if at least one of the error counters equals or exceeds the error warning limit of 96. EWARN is reset if both error counters are less than the error warning limit.

FIGURE 6-1: ERROR MODES STATE DIAGRAM

This figure shows the Error Modes State Diagram for the MCP2515, governed by the Receive Error Counter (REC) and Transmit Error Counter (TEC).

- **States:** Error-Active, Error-Passive, Bus-Off.
- **Transitions:**
  - **Reset** leads to the Error-Active state.
  - **Error-Active to Error-Passive:** If  $REC > 127$  or  $TEC > 127$ .
  - **Error-Passive to Error-Active:** If  $REC < 127$  or  $TEC < 127$ .
  - **Error-Passive to Bus-Off:** If  $TEC > 255$ .
  - **Bus-Off to Error-Active (Recovery):** After 128 Occurrences of 11 Consecutive "Recessive" Bits.

![](_page_47_Figure_2.jpeg)

REGISTER 6-1: TEC: TRANSMIT ERROR COUNTER REGISTER (ADDRESS: 1Ch)

| R-0   | R-0  | R-0  | R-0  | R-0  | R-0  | R-0  | R-0   |
|-------|------|------|------|------|------|------|-------|
| TEC7  | TEC6 | TEC5 | TEC4 | TEC3 | TEC2 | TEC1 | TEC0  |
| bit 7 |      |      |      |      |      |      | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **TEC[7:0]**: Transmit Error Count bits

REGISTER 6-2: REC: RECEIVE ERROR COUNTER REGISTER (ADDRESS: 1Dh)

| R-0   | R-0  | R-0  | R-0  | R-0  | R-0  | R-0  | R-0   |
|-------|------|------|------|------|------|------|-------|
| REC7  | REC6 | REC5 | REC4 | REC3 | REC2 | REC1 | REC0  |
| bit 7 |      |      |      |      |      |      | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-0 **REC[7:0]**: Receive Error Count bits

# MCP2515

## REGISTER 6-3: EFLG: ERROR FLAG REGISTER (ADDRESS: 2Dh)

| R/W-0  | R/W-0  | R-0  | R-0  | R-0  | R-0   | R-0   | R-0   |
|--------|--------|------|------|------|-------|-------|-------|
| RX1OVR | RX0OVR | TXBO | TXEP | RXEP | TXWAR | RXWAR | EWARN |
| bit 7  |        |      |      |      |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **RX1OVR**: Receive Buffer 1 Overflow Flag bit  
Sets when a valid message is received for RXB1 and RX1IF (CANINTF[1]) = 1. Must be reset by MCU.

bit 6 **RX0OVR**: Receive Buffer 0 Overflow Flag bit  
Sets when a valid message is received for RXB0 and RX0IF (CANINTF[0]) = 1. Must be reset by MCU.

bit 5 **TXBO**: Bus-Off Error Flag bit  
Sets when TEC reaches 255. Resets after a successful bus recovery sequence.

bit 4 **TXEP**: Transmit Error-Passive Flag bit  
Sets when TEC is equal to or greater than 128. Resets when TEC is less than 128.

bit 3 **RXEP**: Receive Error-Passive Flag bit  
Sets when REC is equal to or greater than 128. Resets when REC is less than 128.

bit 2 **TXWAR**: Transmit Error Warning Flag bit  
Sets when TEC is equal to or greater than 96. Resets when TEC is less than 96.

bit 1 **RXWAR**: Receive Error Warning Flag bit  
Sets when REC is equal to or greater than 96. Resets when REC is less than 96.

bit 0 **EWARN**: Error Warning Flag bit  
Sets when TEC or REC is equal to or greater than 96 (TXWAR or RXWAR = 1). Resets when both REC and TEC are less than 96.

## 7.0 INTERRUPTS

The MCP2515 has eight sources of interrupts. The CANINTE register contains the individual interrupt enable bits for each interrupt source. The CANINTF register contains the corresponding interrupt flag bit for each interrupt source. When an interrupt occurs, the INT pin is driven low by the MCP2515 and will remain low until the interrupt is cleared by the MCU. An interrupt can not be cleared if the respective condition still prevails.

It is recommended that the **BIT MODIFY** command be used to reset flag bits in the CANINTF register rather than normal write operations. This is done to prevent unintentionally changing a flag that changes during the **WRITE** command, potentially causing an interrupt to be missed.

It should be noted that the CANINTF flags are read/write and an interrupt can be generated by the MCU setting any of these bits, provided the associated CANINTE bit is also set.

### 7.1 Interrupt Code Bits

The source of a pending interrupt is indicated in the Interrupt Code bits, ICOD[2:0] (CANSTAT[3:1]), as shown in [Register 10-2](#). In the event that multiple interrupts occur, the INT pin will remain low until all interrupts have been reset by the MCU. The ICOD[2:0] bits will reflect the code for the highest priority interrupt that is currently pending. Interrupts are internally prioritized, such that the lower the ICODn bits value, the higher the interrupt priority. Once the highest priority interrupt condition has been cleared, the code for the next highest priority interrupt that is pending (if any) will be reflected by the ICODn bits (see [Table 7-1](#)). Only those interrupt sources that have their associated CANINTE enable bit set will be reflected in the ICODn bits.

TABLE 7-1: ICOD[2:0] DECODE

| ICOD[2:0] | Boolean Expression                                                                                                                                                                              |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 000       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}} \cdot \overline{\text{TX0}} \cdot \overline{\text{TX1}} \cdot \overline{\text{TX2}} \cdot \overline{\text{RX0}} \cdot \overline{\text{RX1}}$ |
| 001       | $\overline{\text{ERR}}$                                                                                                                                                                         |
| 010       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}}$                                                                                                                                             |
| 011       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}} \cdot \overline{\text{TX0}}$                                                                                                                 |
| 100       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}} \cdot \overline{\text{TX0}} \cdot \overline{\text{TX1}}$                                                                                     |
| 101       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}} \cdot \overline{\text{TX0}} \cdot \overline{\text{TX1}} \cdot \overline{\text{TX2}}$                                                         |
| 110       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}} \cdot \overline{\text{TX0}} \cdot \overline{\text{TX1}} \cdot \overline{\text{TX2}} \cdot \overline{\text{RX0}}$                             |
| 111       | $\overline{\text{ERR}} \cdot \overline{\text{WAK}} \cdot \overline{\text{TX0}} \cdot \overline{\text{TX1}} \cdot \overline{\text{TX2}} \cdot \overline{\text{RX0}} \cdot \overline{\text{RX1}}$ |

**Note:** ERR is associated with the ERRIE bit (CANINTE[5]).

### 7.2 Transmit Interrupt

When the Transmit Interrupt is enabled, TXnIE (CANINTE) = 1, an interrupt will be generated on the INT pin once the associated transmit buffer becomes empty and is ready to be loaded with a new message. The TXnIF bit (CANINTF) will be set to indicate the source of the interrupt. The interrupt is cleared by clearing the TXnIF bit.

### 7.3 Receive Interrupt

When the Receive Interrupt is enabled, RXnIE (CANINTE) = 1, an interrupt will be generated on the INT pin once a message has been successfully received and loaded into the associated receive buffer. This interrupt is activated immediately after receiving the EOF field. The RXnIF bit (CANINTF) will be set to indicate the source of the interrupt. The interrupt is cleared by clearing the RXnIF bit.

### 7.4 Message Error Interrupt

When an error occurs during the transmission or reception of a message, the Message Error Flag, MERRF (CANINTF[7]), will be set, and if the MERRE bit (CANINTE[7]) is set, an interrupt will be generated on the INT pin. This is intended to be used to facilitate baud rate determination when used in conjunction with Listen-Only mode.

### 7.5 Bus Activity Wake-up Interrupt

When the MCP2515 is in Sleep mode and the bus activity wake-up interrupt is enabled (WAKIE (CANINTE[6]) = 1), an interrupt will be generated on the INT pin and the WAKIF bit (CANINTF[6]) will be set when activity is detected on the CAN bus. This interrupt causes the MCP2515 to exit Sleep mode. The interrupt is reset by clearing the WAKIF bit.

**Note:** The MCP2515 wakes up into Listen-Only mode.

### 7.6 Error Interrupt

When the error interrupt is enabled (ERRIE (CANINTE[5]) = 1), an interrupt is generated on the INT pin if an overflow condition occurs, or if the error state of the transmitter or receiver has changed. The Error Flag (EFLG) register will indicate one of the following conditions.

## 7.6.1 RECEIVER OVERFLOW

An overflow condition occurs when the MAB has assembled a valid receive message (the message meets the criteria of the acceptance filters) and the receive buffer associated with the filter is not available for loading of a new message. The associated RXnOVR bit (EFLG) will be set to indicate the overflow condition. This bit must be cleared by the MCU.

## 7.6.2 RECEIVER WARNING

The REC has reached the MCU warning limit of 96.

## 7.6.3 TRANSMITTER WARNING

The TEC has reached the MCU warning limit of 96.

## 7.6.4 RECEIVER ERROR-PASSIVE

The REC has exceeded the error-passive limit of 127 and the device has gone to the error-passive state.

## 7.6.5 TRANSMITTER ERROR-PASSIVE

The TEC has exceeded the error-passive limit of 127 and the device has gone to the error-passive state.

## 7.6.6 BUS-OFF

The TEC has exceeded 255 and the device has gone to the bus-off state.

## 7.7 Interrupt Acknowledge

Interrupts are directly associated with one or more status flags in the CANINTF register. Interrupts are pending as long as one of the flags is set. Once an interrupt flag is set by the device, the flag can not be reset by the MCU until the interrupt condition is removed.

REGISTER 7-1: CANINTE: CAN INTERRUPT ENABLE REGISTER (ADDRESS: 2Bh)

| R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| MERRE | WAKIE | ERRIE | TX2IE | TX1IE | TX0IE | RX1IE | RX0IE |
| bit 7 |       |       |       |       |       |       | bit 0 |

Legend:R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **MERRE**: Message Error Interrupt Enable bit  
1 = Interrupt on error during message reception or transmission  
0 = Disabled

bit 6 **WAKIE**: Wake-up Interrupt Enable bit  
1 = Interrupt on CAN bus activity  
0 = Disabled

bit 5 **ERRIE**: Error Interrupt Enable bit (multiple sources in EFLG register)  
1 = Interrupt on EFLG error condition change  
0 = Disabled

bit 4 **TX2IE**: Transmit Buffer 2 Empty Interrupt Enable bit  
1 = Interrupt on TXB2 becoming empty  
0 = Disabled

bit 3 **TX1IE**: Transmit Buffer 1 Empty Interrupt Enable bit  
1 = Interrupt on TXB1 becoming empty  
0 = Disabled

bit 2 **TX0IE**: Transmit Buffer 0 Empty Interrupt Enable bit  
1 = Interrupt on TXB0 becoming empty  
0 = Disabled

bit 1 **RX1IE**: Receive Buffer 1 Full Interrupt Enable bit  
1 = Interrupt when message was received in RXB1  
0 = Disabled

bit 0 **RX0IE**: Receive Buffer 0 Full Interrupt Enable bit  
1 = Interrupt when message was received in RXB0  
0 = Disabled

# MCP2515

## REGISTER 7-2: CANINTF: CAN INTERRUPT FLAG REGISTER (ADDRESS: 2Ch)

| R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 | R/W-0 |
|-------|-------|-------|-------|-------|-------|-------|-------|
| MERRF | WAKIF | ERRIF | TX2IF | TX1IF | TX0IF | RX1IF | RX0IF |
| bit 7 |       |       |       |       |       |       | bit 0 |

### Legend:

R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7 **MERRF**: Message Error Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 6 **WAKIF**: Wake-up Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 5 **ERRIF**: Error Interrupt Flag bit (multiple sources in EFLG register)  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 4 **TX2IF**: Transmit Buffer 2 Empty Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 3 **TX1IF**: Transmit Buffer 1 Empty Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 2 **TX0IF**: Transmit Buffer 0 Empty Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 1 **RX1IF**: Receive Buffer 1 Full Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

bit 0 **RX0IF**: Receive Buffer 0 Full Interrupt Flag bit  
1 = Interrupt is pending (must be cleared by MCU to reset the interrupt condition)  
0 = No interrupt is pending

## 8.0 OSCILLATOR

The MCP2515 is designed to operate with a crystal or ceramic resonator connected to the OSC1 and OSC2 pins. The MCP2515 oscillator design requires the use of a parallel cut crystal. Use of a series cut crystal may give a frequency out of the crystal manufacturer's specifications. A typical oscillator circuit is shown in Figure 8-1. The MCP2515 may also be driven by an external clock source connected to the OSC1 pin, as shown in Figure 8-2 and Figure 8-3.

### 8.1 Oscillator Start-up Timer

The MCP2515 utilizes an Oscillator Start-up Timer (OST) that holds the MCP2515 in Reset to ensure that the oscillator has stabilized before the internal state machine begins to operate. The OST keeps the device in a Reset state for 128 OSC1 clock cycles after the occurrence of a Power-on Reset, SPI Reset, after the assertion of the **RESET** pin and after a wake-up from Sleep mode. It should be noted that no SPI protocol operations should be attempted until after the OST has expired.

## 8.2 CLKOUT Pin

The CLKOUT pin is provided to the system designer for use as the main system clock or as a clock input for other devices in the system. The CLKOUT has an internal prescaler which can divide  $F_{OSC}$  by 1, 2, 4 and 8. The CLKOUT function is enabled and the prescaler is selected via the CANCTRL register (see Register 10-1).

**Note:** The maximum frequency on CLKOUT is specified as 25 MHz (See Table 13-5).

The CLKOUT pin will be active upon system Reset and default to the slowest speed (divide-by-8) so that it can be used as the MCU clock.

When Sleep mode is requested, the MCP2515 will drive sixteen additional clock cycles on the CLKOUT pin before entering Sleep mode. The Idle state of the CLKOUT pin in Sleep mode is low. When the CLKOUT function is disabled (CLKEN (CANCTRL[2]) = 0), the CLKOUT pin is in a high-impedance state.

The CLKOUT function is designed to ensure that  $t_{hCLKOUT}$  and  $t_{ICLKOUT}$  timings are preserved when the CLKOUT pin function is enabled, disabled or the prescaler value is changed.

**FIGURE 8-1:** CRYSTAL/CERAMIC RESONATOR OPERATION

![Figure 8-1: Crystal/Ceramic Resonator Operation circuit diagram. The circuit shows a crystal (XTAL) connected between OSC1 and OSC2 pins, with capacitors C1 and C2. A series resistor Rs(1) is connected between OSC2 and ground. The OSC1 pin connects to an internal oscillator block containing a feedback resistor Rf(2) and logic gates. The output of the oscillator block goes to Internal Logic and Sleep mode.]()**Note 1:** A Series Resistor ( $R_S$ ) may be required for AT strip cut crystals.

**2:** The Feedback Resistor ( $R_F$ ) is typically in the range of 2 to 10 M $\Omega$ .

![](_page_54_Figure_12.jpeg)

**FIGURE 8-2:** EXTERNAL CLOCK SOURCE<sup>(2)</sup>

![Figure 8-2: External Clock Source circuit diagram. An external clock source is connected to OSC1 via an inverter. OSC2 is shown with an open connection labeled Open(1).]()**Note 1:** A resistor to ground may be used to reduce system noise; this may increase system current.

**2:** Duty cycle restrictions must be observed (see Table 13-2).

![](_page_54_Figure_14.jpeg)

# MCP2515

FIGURE 8-3: EXTERNAL SERIES RESONANT CRYSTAL OSCILLATOR CIRCUIT<sup>(1)</sup>

Circuit diagram showing an external series resonant crystal oscillator circuit. The circuit uses three 74AS04 inverters. The first inverter has a 330 k $\Omega$  feedback resistor. The output of the first inverter is connected to the input of the second inverter, which also has a 330 k $\Omega$  feedback resistor. The series combination of the XTAL (crystal) and a 0.1 mF capacitor provides feedback from the output of the second inverter to the input of the first inverter. The output of the second inverter is connected to the input of the third inverter (74AS04). The output of the third inverter is connected to the OSC1 pin of the **MCP2515** device and a line labeled "To Other Devices".

![](_page_55_Figure_2.jpeg)

Note 1: Duty cycle restrictions must be observed (see Table 13-2).

TABLE 8-1: CAPACITOR SELECTION FOR CERAMIC RESONATORS

| Typical Capacitor Values Used: |          |       |       |
|--------------------------------|----------|-------|-------|
| Mode                           | Freq.    | OSC1  | OSC2  |
| HS                             | 8.0 MHz  | 27 pF | 27 pF |
|                                | 16.0 MHz | 22 pF | 22 pF |

**Capacitor values are for design guidance only:**  
These capacitors were tested with the resonators listed below for basic start-up and operation. **These values are not optimized.**  
Different capacitor values may be required to produce acceptable oscillator operation. The user should test the performance of the oscillator over the expected  $V_{DD}$  and temperature range for the application.  
See Table 8-2 footnotes for additional information.

| Resonators Used: |
|------------------|
| 4.0 MHz          |
| 8.0 MHz          |
| 16.0 MHz         |

TABLE 8-2: CAPACITOR SELECTION FOR CRYSTAL OSCILLATOR

| Osc Type <sup>(1,4)</sup> | Crystal Freq. <sup>(2)</sup> | Typical Capacitor Values Tested: |       |
|---------------------------|------------------------------|----------------------------------|-------|
|                           |                              | C1                               | C2    |
| HS                        | 4 MHz                        | 27 pF                            | 27 pF |
|                           | 8 MHz                        | 22 pF                            | 22 pF |
|                           | 20 MHz                       | 15 pF                            | 15 pF |

**Capacitor values are for design guidance only:**  
These capacitors were tested with the crystals listed below for basic start-up and operation. **These values are not optimized.**  
Different capacitor values may be required to produce acceptable oscillator operation. The user should test the performance of the oscillator over the expected  $V_{DD}$  and temperature range for the application.  
See the notes following this table for additional information.

| Crystals Used: <sup>(3)</sup> |
|-------------------------------|
| 4.0 MHz                       |
| 8.0 MHz                       |
| 20.0 MHz                      |

1. While higher capacitance increases the stability of the oscillator, it also increases the start-up time.
2. Since each resonator/crystal has its own characteristics, the user should consult the resonator/crystal manufacturer for appropriate values of external components.
3. $R_S$  may be required to avoid overdriving crystals with a low drive level specification.
4. Always verify oscillator performance over the  $V_{DD}$  and temperature range that is expected for the application.

## 9.0 RESET

The MCP2515 differentiates between two kinds of Resets:

1. Hardware Reset – Low on RESET pin.
2. SPI Reset – Reset via SPI command.

Both of these Resets are functionally equivalent. It is important to provide one of these two Resets after power-up to ensure that the logic and registers are in their default state. A hardware Reset can be achieved automatically by placing an RC on the RESET pin (see Figure 9-1). The values must be such that the device is held in Reset for a minimum of  $2 \mu\text{s}$  after  $V_{DD}$  reaches the operating voltage, as indicated in the electrical specification ( $t_{RL}$ ).

FIGURE 9-1: RESET PIN CONFIGURATION EXAMPLE

![Circuit diagram showing the RESET pin configuration example. The circuit includes a power source VDD, a diode D(1) connected between VDD and the node leading to the RESET pin, a resistor R connected between VDD and the node leading to the RESET pin, a capacitor C connected between the node leading to the RESET pin and ground, and a resistor R1(2) connected between the node leading to the RESET pin and the RESET pin itself. The RESET pin is connected to a block representing the device.]()![](_page_56_Figure_6.jpeg)

**Note 1:** The diode, D, helps discharge the capacitor quickly when  $V_{DD}$  powers down.

**2:**  $R1 = 1 \text{ k}\Omega$  to  $10 \text{ k}\Omega$  will limit any current flowing into RESET from the external capacitor, C, in the event of RESET pin breakdown due to Electrostatic Discharge (ESD) or Electrical Overstress (EOS).

# MCP2515

NOTES:

## 10.0 MODES OF OPERATION

The MCP2515 has five modes of operation. These modes are:

1. Configuration mode.
2. Normal mode.
3. Sleep mode.
4. Listen-Only mode.
5. Loopback mode.

The operational mode is selected via the REQOP[2:0] bits (CANCTRL[7:5]); see [Register 10-1](#).

When changing modes, the mode will not actually change until all pending message transmissions are complete. The requested mode must be verified by reading the OPMOD[2:0] bits (CANSTAT[7:5]); see [Register 10-2](#).

### 10.1 Configuration Mode

The MCP2515 must be initialized before activation. This is only possible if the device is in the Configuration mode. Configuration mode is automatically selected after power-up, a Reset or can be entered from any other mode by setting the REQOP[2:0] bits to '100'. When Configuration mode is entered, all error counters are cleared. Configuration mode is the only mode where the following registers are modifiable:

- CNF1, CNF2, CNF3 registers
- TXRTSCTRL register
- Filter registers
- Mask registers

### 10.2 Sleep Mode

The MCP2515 has an internal Sleep mode that is used to minimize the current consumption of the device. The SPI interface remains active for reading even when the MCP2515 is in Sleep mode, allowing access to all registers.

To enter Sleep mode, the Request Operation Mode bits are set in the CANCTRL register (REQOP[2:0]). The OPMOD[2:0] bits (CANSTAT[7:5]) indicate the operation mode. These bits should be read after sending the SLEEP command to the MCP2515. The MCP2515 is active and has not yet entered Sleep mode until these bits indicate that Sleep mode has been entered.

When in internal Sleep mode, the wake-up interrupt is still active (if enabled). This is done so that the MCU can also be placed into a Sleep mode and use the MCP2515 to wake it up upon detecting activity on the bus.

When in Sleep mode, the MCP2515 stops its internal oscillator. The MCP2515 will wake up when bus activity occurs or when the MCU sets, via the SPI interface, the WAKIF bit (CANINTF[6]). To 'generate' a wake-up attempt, the WAKIE bit (CANINTE[6]) must also be set in order for the wake-up interrupt to occur.

The TXCAN pin will remain in the recessive state while the MCP2515 is in Sleep mode.

#### 10.2.1 WAKE-UP FUNCTIONS

The device will monitor the RXCAN pin for activity while it is in Sleep mode. If the WAKIE bit is set, the device will wake-up and generate an interrupt. Since the internal oscillator is shut down while in Sleep mode, it will take some amount of time for the oscillator to start-up and the device to enable itself to receive messages. This Oscillator Start-up Timer (OST) is defined as 128  $T_{OSC}$ .

The device will ignore the message that caused the wake-up from Sleep mode, as well as any messages that occur while the device is 'waking up'. The device will wake up in Listen-Only mode. The MCU must set Normal mode before the MCP2515 will be able to communicate on the bus.

The device can be programmed to apply a low-pass filter function to the RXCAN input line while in internal Sleep mode. This feature can be used to prevent the device from waking up due to short glitches on the CAN bus lines. The WAKFIL bit (CNF3[6]) enables or disables the filter.

### 10.3 Listen-Only Mode

Listen-Only mode provides a means for the MCP2515 to receive all messages (including messages with errors) by configuring the RXM[1:0] bits (RXBnCTRL[6:5]). This mode can be used for bus monitor applications or for detecting the baud rate in 'hot plugging' situations.

For Auto-Baud Detection (ABD), it is necessary that at least two other nodes are communicating with each other. The baud rate can be detected empirically by testing different values until valid messages are received.

Listen-Only mode is a silent mode, meaning no messages will be transmitted while in this mode (including error flags or Acknowledge signals). In Listen-Only mode, both valid and invalid messages will be received, regardless of filters and masks or the Receive Buffer Operating Mode bits, RXMn. The error counters are reset and deactivated in this state. The Listen-Only mode is activated by setting the Request Operation Mode bits (REQOP[2:0]) in the CANCTRL register.

## 10.4 Loopback Mode

Loopback mode will allow internal transmission of messages from the transmit buffers to the receive buffers without actually transmitting messages on the CAN bus. This mode can be used in system development and testing.

In this mode, the ACK bit is ignored and the device will allow incoming messages from itself, just as if they were coming from another node. The Loopback mode is a silent mode, meaning no messages will be transmitted while in this state (including error flags or Acknowledge signals). The TXCAN pin will be in a recessive state.

The filters and masks can be used to allow only particular messages to be loaded into the Receive registers. The masks can be set to all zeros to provide a mode that accepts all messages. The Loopback mode is activated by setting the Request Operation Mode bits in the CANCTRL register.

## 10.5 Normal Mode

Normal mode is the standard operating mode of the MCP2515. In this mode, the device actively monitors all bus messages and generates Acknowledge bits, error frames, etc. This is also the only mode in which the MCP2515 will transmit messages over the CAN bus.

### REGISTER 10-1: CANCTRL: CAN CONTROL REGISTER (ADDRESS: XFh)

| R/W-1  | R/W-0  | R/W-0  | R/W-0 | R/W-0 | R/W-1 | R/W-1   | R/W-1   |
|--------|--------|--------|-------|-------|-------|---------|---------|
| REQOP2 | REQOP1 | REQOP0 | ABAT  | OSM   | CLKEN | CLKPRE1 | CLKPRE0 |
| bit 7  |        |        |       |       |       |         | bit 0   |

#### Legend:

R = Readable bit

W = Writable bit

U = Unimplemented bit, read as '0'

-n = Value at POR

'1' = Bit is set

'0' = Bit is cleared

x = Bit is unknown

bit 7-5 **REQOP[2:0]:** Request Operation Mode bits

000 = Sets Normal Operation mode

001 = Sets Sleep mode

010 = Sets Loopback mode

011 = Sets Listen-Only mode

100 = Sets Configuration mode

All other values for the REQOPn bits are invalid and should not be used. On power-up, REQOP[2:0] = b'100'.

bit 4 **ABAT:** Abort All Pending Transmissions bit

1 = Requests abort of all pending transmit buffers

0 = Terminates request to abort all transmissions

bit 3 **OSM:** One-Shot Mode bit

1 = Enabled; messages will only attempt to transmit one time

0 = Disabled; messages will reattempt transmission if required

bit 2 **CLKEN:** CLKOUT Pin Enable bit

1 = CLKOUT pin is enabled

0 = CLKOUT pin is disabled (pin is in high-impedance state)

bit 1-0 **CLKPRE[1:0]:** CLKOUT Pin Prescaler bits

00 =  $F_{CLKOUT}$  = System Clock/1

01 =  $F_{CLKOUT}$  = System Clock/2

10 =  $F_{CLKOUT}$  = System Clock/4

11 =  $F_{CLKOUT}$  = System Clock/8

REGISTER 10-2: CANSTAT: CAN STATUS REGISTER (ADDRESS: XEh)

| R-1    | R-0    | R-0    | U-0 | R-0   | R-0   | R-0   | U-0   |
|--------|--------|--------|-----|-------|-------|-------|-------|
| OPMOD2 | OPMOD1 | OPMOD0 | —   | ICOD2 | ICOD1 | ICOD0 | —     |
| bit 7  |        |        |     |       |       |       | bit 0 |

**Legend:**R = Readable bit W = Writable bit U = Unimplemented bit, read as '0'  
-n = Value at POR '1' = Bit is set '0' = Bit is cleared x = Bit is unknown

bit 7-5 **OPMOD[2:0]:** Operation Mode bits  
000 = Device is in Normal Operation mode  
001 = Device is in Sleep mode  
010 = Device is in Loopback mode  
011 = Device is in Listen-Only mode  
100 = Device is in Configuration mode

bit 4 **Unimplemented:** Read as '0'

bit 3-1 **ICOD[2:0]:** Interrupt Flag Code bits  
000 = No interrupt  
001 = Error interrupt  
010 = Wake-up interrupt  
011 = TXB0 interrupt  
100 = TXB1 interrupt  
101 = TXB2 interrupt  
110 = RXB0 interrupt  
111 = RXB1 interrupt

bit 0 **Unimplemented:** Read as '0'

# MCP2515

NOTES:

## 11.0 REGISTER MAP

The register map for the MCP2515 is shown in Table 11-1. Address locations for each register are determined by using the column (higher order four bits) and row (lower order four bits) values. The registers have been arranged to optimize the sequential

reading and writing of data. Some specific control and status registers allow individual bit modification using the SPI BIT MODIFY command. The registers that allow this command are shown as shaded locations in Table 11-1. A summary of the MCP2515 control registers is shown in Table 11-2.

TABLE 11-1: CAN CONTROLLER REGISTER MAP

| Lower Address Bits | Higher Order Address Bits |           |           |           |           |           |           |           |
|--------------------|---------------------------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|
|                    | 0000 xxxx                 | 0001 xxxx | 0010 xxxx | 0011 xxxx | 0100 xxxx | 0101 xxxx | 0110 xxxx | 0111 xxxx |
| 0000               | RXF0SIDH                  | RXF3SIDH  | RXM0SIDH  | TXB0CTRL  | TXB1CTRL  | TXB2CTRL  | RXB0CTRL  | RXB1CTRL  |
| 0001               | RXF0SIDL                  | RXF3SIDL  | RXM0SIDL  | TXB0SIDH  | TXB1SIDH  | TXB2SIDH  | RXB0SIDH  | RXB1SIDH  |
| 0010               | RXF0EID8                  | RXF3EID8  | RXM0EID8  | TXB0SIDL  | TXB1SIDL  | TXB2SIDL  | RXB0SIDL  | RXB1SIDL  |
| 0011               | RXF0EID0                  | RXF3EID0  | RXM0EID0  | TXB0EID8  | TXB1EID8  | TXB2EID8  | RXB0EID8  | RXB1EID8  |
| 0100               | RXF1SIDH                  | RXF4SIDH  | RXM1SIDH  | TXB0EID0  | TXB1EID0  | TXB2EID0  | RXB0EID0  | RXB1EID0  |
| 0101               | RXF1SIDL                  | RXF4SIDL  | RXM1SIDL  | TXB0DLC   | TXB1DLC   | TXB2DLC   | RXB0DLC   | RXB1DLC   |
| 0110               | RXF1EID8                  | RXF4EID8  | RXM1EID8  | TXB0D0    | TXB1D0    | TXB2D0    | RXB0D0    | RXB1D0    |
| 0111               | RXF1EID0                  | RXF4EID0  | RXM1EID0  | TXB0D1    | TXB1D1    | TXB2D1    | RXB0D1    | RXB1D1    |
| 1000               | RXF2SIDH                  | RXF5SIDH  | CNF3      | TXB0D2    | TXB1D2    | TXB2D2    | RXB0D2    | RXB1D2    |
| 1001               | RXF2SIDL                  | RXF5SIDL  | CNF2      | TXB0D3    | TXB1D3    | TXB2D3    | RXB0D3    | RXB1D3    |
| 1010               | RXF2EID8                  | RXF5EID8  | CNF1      | TXB0D4    | TXB1D4    | TXB2D4    | RXB0D4    | RXB1D4    |
| 1011               | RXF2EID0                  | RXF5EID0  | CANINTE   | TXB0D5    | TXB1D5    | TXB2D5    | RXB0D5    | RXB1D5    |
| 1100               | BFPCTRL                   | TEC       | CANINTF   | TXB0D6    | TXB1D6    | TXB2D6    | RXB0D6    | RXB1D6    |
| 1101               | TXRTSCTRL                 | REC       | EFLG      | TXB0D7    | TXB1D7    | TXB2D7    | RXB0D7    | RXB1D7    |
| 1110               | CANSTAT                   | CANSTAT   | CANSTAT   | CANSTAT   | CANSTAT   | CANSTAT   | CANSTAT   | CANSTAT   |
| 1111               | CANCTRL                   | CANCTRL   | CANCTRL   | CANCTRL   | CANCTRL   | CANCTRL   | CANCTRL   | CANCTRL   |

Note: Shaded register locations indicate that the user is allowed to manipulate individual bits using the BIT MODIFY command.

TABLE 11-2: CONTROL REGISTER SUMMARY

| Register Name | Address (Hex) | Bit 7                        | Bit 6  | Bit 5   | Bit 4   | Bit 3   | Bit 2   | Bit 1   | Bit 0   | POR/Reset Value |
|---------------|---------------|------------------------------|--------|---------|---------|---------|---------|---------|---------|-----------------|
| BFPCTRL       | 0C            | —                            | —      | B1BFS   | B0BFS   | B1BFE   | B0BFE   | B1BFM   | B0BFM   | --00 0000       |
| TXRTSCTRL     | 0D            | —                            | —      | B2RTS   | B1RTS   | B0RTS   | B2RTSM  | B1RTSM  | B0RTSM  | --xx x000       |
| CANSTAT       | XE            | OPMOD2                       | OPMOD1 | OPMOD0  | —       | ICOD2   | ICOD1   | ICOD0   | —       | 100- 000-       |
| CANCTRL       | XF            | REQOP2                       | REQOP1 | REQOP0  | ABAT    | OSM     | CLKEN   | CLKPRE1 | CLKPRE0 | 1000 0111       |
| TEC           | 1C            | Transmit Error Counter (TEC) |        |         |         |         |         |         |         | 0000 0000       |
| REC           | 1D            | Receive Error Counter (REC)  |        |         |         |         |         |         |         | 0000 0000       |
| CNF3          | 28            | SOF                          | WAKFIL | —       | —       | —       | PHSEG22 | PHSEG21 | PHSEG20 | 00-- -000       |
| CNF2          | 29            | BTLMODE                      | SAM    | PHSEG12 | PHSEG11 | PHSEG10 | PRSEG2  | PRSEG1  | PRSEG0  | 0000 0000       |
| CNF1          | 2A            | SJW1                         | SJW0   | BRP5    | BRP4    | BRP3    | BRP2    | BRP1    | BRP0    | 0000 0000       |
| CANINTE       | 2B            | MERRE                        | WAKIE  | ERRIE   | TX2IE   | TX1IE   | TX0IE   | RX1IE   | RX0IE   | 0000 0000       |
| CANINTF       | 2C            | MERRF                        | WAKIF  | ERRIF   | TX2IF   | TX1IF   | TX0IF   | RX1IF   | RX0IF   | 0000 0000       |
| EFLG          | 2D            | RX1OVR                       | RX0OVR | TXB0    | TXEP    | RXEP    | TXWAR   | RXWAR   | EWARN   | 0000 0000       |
| TXB0CTRL      | 30            | —                            | ABTF   | MLOA    | TXERR   | TXREQ   | —       | TXP1    | TXP0    | -000 0-00       |
| TXB1CTRL      | 40            | —                            | ABTF   | MLOA    | TXERR   | TXREQ   | —       | TXP1    | TXP0    | -000 0-00       |
| TXB2CTRL      | 50            | —                            | ABTF   | MLOA    | TXERR   | TXREQ   | —       | TXP1    | TXP0    | -000 0-00       |
| RXB0CTRL      | 60            | —                            | RXM1   | RXM0    | —       | RXRTR   | BUKT    | BUKT1   | FILHIT0 | -00- 0000       |
| RXB1CTRL      | 70            | —                            | RXM1   | RXM0    | —       | RXRTR   | FILHIT2 | FILHIT1 | FILHIT0 | -00- 0000       |

# MCP2515

NOTES:

## 12.0 SPI INTERFACE

### 12.1 Overview

The MCP2515 is designed to interface directly with the Serial Peripheral Interface (SPI) port available on many microcontrollers and supports Mode 0,0 and Mode 1,1. Commands and data are sent to the device via the SI pin, with data being clocked in on the rising edge of SCK. Data are driven out by the MCP2515 (on the SO line) on the falling edge of SCK. The  $\overline{CS}$  pin must be held low while any operation is performed. Table 12-1 shows the instruction bytes for all operations. Refer to Figure 12-10 and Figure 12-11 for detailed input and output timing diagrams for both Mode 0,0 and Mode 1,1 operation.

**Note:** The MCP2515 expects the first byte after lowering  $\overline{CS}$  to be the instruction/command byte. This implies that  $\overline{CS}$  must be raised and then lowered again to invoke another command.

### 12.2 RESET Instruction

The RESET instruction can be used to reinitialize the internal registers of the MCP2515 and set the Configuration mode. This command provides the same functionality, via the SPI interface, as the RESET pin.

The RESET instruction is a single byte instruction that requires selecting the device by pulling the  $\overline{CS}$  pin low, sending the instruction byte and then raising the  $\overline{CS}$  pin. It is highly recommended that the RESET command be sent (or the RESET pin be lowered) as part of the power-on initialization sequence.

### 12.3 READ Instruction

The READ instruction is started by lowering the  $\overline{CS}$  pin. The READ instruction is then sent to the MCP2515, followed by the 8-bit address (A7 through A0). Next, the data stored in the register at the selected address will be shifted out on the SO pin.

The internal Address Pointer is automatically incremented to the next address once each byte of data is shifted out. Therefore, it is possible to read the next consecutive register address by continuing to provide clock pulses. Any number of consecutive register locations can be read sequentially using this method. The READ operation is terminated by raising the  $\overline{CS}$  pin (Figure 12-2).

### 12.4 READ RX BUFFER Instruction

The READ RX BUFFER instruction (Figure 12-3) provides a means to quickly address a receive buffer for reading. This instruction reduces the SPI overhead by one byte, the address byte. The command byte actually has four possible values that determine the Address Pointer location. Once the command byte is sent, the controller clocks out the data at the address location, the same as the READ instruction (i.e., sequential reads are possible). This instruction further reduces the SPI overhead by automatically clearing the associated receive flag, RXnIF (CANINTF), when  $\overline{CS}$  is raised at the end of the command.

### 12.5 WRITE Instruction

The WRITE instruction is started by lowering the  $\overline{CS}$  pin. The WRITE instruction is then sent to the MCP2515, followed by the address and at least one byte of data.

It is possible to write to sequential registers by continuing to clock in data bytes as long as  $\overline{CS}$  is held low. Data will actually be written to the register on the rising edge of the SCK line for the D0 bit. If the  $\overline{CS}$  line is brought high before eight bits are loaded, the write will be aborted for that data byte and previous bytes in the command will have been written. Refer to the timing diagram in Figure 12-4 for a more detailed illustration of the byte write sequence.

### 12.6 LOAD TX BUFFER Instruction

The LOAD TX BUFFER instruction (Figure 12-5) eliminates the eight-bit address required by a normal WRITE command. The eight-bit instruction sets the Address Pointer to one of six addresses to quickly write to a transmit buffer that points to the “ID” or “data” address of any of the three transmit buffers.

### 12.7 Request-to-Send (RTS) Instruction

The RTS command can be used to initiate message transmission for one or more of the transmit buffers.

The MCP2515 is selected by lowering the  $\overline{CS}$  pin. The RTS command byte is then sent. As shown in Figure 12-6, the last three bits of this command indicate which transmit buffer(s) are enabled to send.

This command will set the TXREQ bit (TXBnCTRL[3]) for the respective buffer(s). Any or all of the last three bits can be set in a single command. If the RTS command is sent with nnn = 000, the command will be ignored.

## 12.8 READ STATUS Instruction

The READ STATUS instruction allows single instruction access to some of the often used status bits for message reception and transmission.

The MCP2515 is selected by lowering the  $\overline{CS}$  pin and the READ STATUS command byte, shown in Figure 12-8, is sent to the MCP2515. Once the command byte is sent, the MCP2515 will return eight bits of data that contain the status.

If additional clocks are sent after the first eight bits are transmitted, the MCP2515 will continue to output the status bits as long as the  $\overline{CS}$  pin is held low and clocks are provided on SCK.

Each status bit returned in this command may also be read by using the standard READ command with the appropriate register address.

## 12.9 RX STATUS Instruction

The RX STATUS instruction (Figure 12-9) is used to quickly determine which filter matched the message and message type (standard, extended, remote). After the command byte is sent, the controller will return 8 bits of data that contain the status data. If more clocks are sent after the eight bits are transmitted, the controller will continue to output the same status bits as long as the  $\overline{CS}$  pin stays low and clocks are provided.

## 12.10 BIT MODIFY Instruction

The BIT MODIFY instruction provides a means for setting or clearing individual bits in specific status and control registers. This command is not available for all registers. See Section 11.0 “Register Map” to determine which registers allow the use of this command.

**Note:** Executing the BIT MODIFY command on registers that are not bit-modifiable will force the mask to FFh. This will allow byte writes to the registers, not BIT MODIFY.

The part is selected by lowering the  $\overline{CS}$  pin and the BIT MODIFY command byte is then sent to the MCP2515. The command is followed by the address of the register, the mask byte and finally, the data byte.

The mask byte determines which bits in the register will be allowed to change. A '1' in the mask byte will allow a bit in the register to change, while a '0' will not.

The data byte determines what value the modified bits in the register will be changed to. A '1' in the data byte will set the bit and a '0' will clear the bit, provided that the mask for that bit is set to a '1' (see Figure 12-7).

FIGURE 12-1: BIT MODIFY

| Mask Byte                   | 0 0 1 1 0 1 0 1 |
|-----------------------------|-----------------|
| Data Byte                   | x x 1 0 x 0 x 1 |
| Previous Register Contents  | 0 1 0 1 0 0 0 1 |
| Resulting Register Contents | 0 1 1 0 0 0 0 1 |

![](_page_65_Figure_15.jpeg)

TABLE 12-1: SPI INSTRUCTION SET

| Instruction Name                    | Instruction Format | Description                                                                                                                                                                                                                                                                                                                                                |
|-------------------------------------|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RESET                               | 1100 0000          | Resets internal registers to the default state, sets Configuration mode.                                                                                                                                                                                                                                                                                   |
| READ                                | 0000 0011          | Reads data from the register beginning at selected address.                                                                                                                                                                                                                                                                                                |
| READ RX BUFFER                      | 1001 0nm0          | When reading a receive buffer, reduces the overhead of a normal READ command by placing the Address Pointer at one of four locations, as indicated by 'n,m'.<br><b>Note:</b> The associated RX flag bit, RXnIF (CANINTF), will be cleared after bringing CS high.                                                                                          |
| WRITE                               | 0000 0010          | Writes data to the register beginning at the selected address.                                                                                                                                                                                                                                                                                             |
| LOAD TX BUFFER                      | 0100 0abc          | When loading a transmit buffer, reduces the overhead of a normal WRITE command by placing the Address Pointer at one of six locations, as indicated by 'a,b,c'.                                                                                                                                                                                            |
| RTS<br>(Message<br>Request-to-Send) | 1000 0nnn          | Instructs controller to begin message transmission sequence for any of the transmit buffers.<br><pre>           1000 0nnn           ^ ^ ^                 Request-to-Send for TXB2 Request-to-Send for TXB0                       Request-to-Send for TXB1 </pre>                                                                                          |
| READ STATUS                         | 1010 0000          | Quick polling command that reads several status bits for transmit and receive functions.                                                                                                                                                                                                                                                                   |
| RX STATUS                           | 1011 0000          | Quick polling command that indicates filter match and message type (standard, extended and/or remote) of received message.                                                                                                                                                                                                                                 |
| BIT MODIFY                          | 0000 0101          | Allows the user to set or clear individual bits in a particular register.<br><b>Note:</b> Not all registers can be bit modified with this command. Executing this command on registers that are not bit modifiable will force the mask to FFh. See the register map in <a href="#">Section 11.0 "Register Map"</a> for a list of the registers that apply. |

# MCP2515

FIGURE 12-2: READ INSTRUCTION

Timing diagram illustrating the Read Instruction sequence for the MCP2515.

The diagram shows the following signals and timing:

- **CS** (Chip Select): Active low, asserted at the start of the instruction.
- **SCK** (Serial Clock): Clock signal running from bit 0 to bit 23.
- **SI** (Serial Input): Data input line. The instruction sequence (Bits 0-6) is 0, 0, 0, 0, 0, 1, 1. The address byte (Bits 7-14) is A7, A6, A5, A4, A3, A2, A1, A0. Bits 15-23 are labeled "Don't Care".
- **SO** (Serial Output): Data output line. High-Impedance during Instruction and Address Byte phases (Bits 0-14). Data Out (Bits 15-22) consists of bits 7, 6, 5, 4, 3, 2, 1, 0.

The Instruction phase spans bits 0 to 6, the Address Byte phase spans bits 7 to 14, and the Data Out phase spans bits 15 to 23.

![](_page_67_Figure_2.jpeg)

FIGURE 12-3: READ RX BUFFER INSTRUCTION

Timing diagram illustrating the Read RX Buffer Instruction sequence for the MCP2515.

The diagram shows the following signals and timing:

- **CS** (Chip Select): Active low, asserted at the start of the instruction.
- **SCK** (Serial Clock): Clock signal running from bit 0 to bit 15.
- **SI** (Serial Input): Data input line. The instruction sequence (Bits 0-7) is 1, 0, 0, 1, 0, n, m, 0. Bits 8-15 are labeled "Don't Care".
- **SO** (Serial Output): Data output line. High-Impedance during the instruction phase (Bits 0-7). Data Out (Bits 8-15) consists of bits 7, 6, 5, 4, 3, 2, 1, 0.

The Instruction phase spans bits 0 to 7, and the Data Out phase spans bits 8 to 15.

Address Mapping Table:

| n | m | Address Points to                      | Address |
|---|---|----------------------------------------|---------|
| 0 | 0 | Receive Buffer 0,<br>Start at RXB0SIDH | 0x61    |
| 0 | 1 | Receive Buffer 0,<br>Start at RXB0D0   | 0x66    |
| 1 | 0 | Receive Buffer 1,<br>Start at RXB1SIDH | 0x71    |
| 1 | 1 | Receive Buffer 1,<br>Start at RXB1D0   | 0x76    |

![](_page_67_Figure_4.jpeg)

FIGURE 12-4: BYTE WRITE INSTRUCTION

Timing diagram illustrating the Byte Write Instruction sequence for the MCP2515.

The diagram shows the following signals and timing:

- **CS** (Chip Select): Active low, asserted at the start of the instruction.
- **SCK** (Serial Clock): Clock signal running from bit 0 to bit 23.
- **SI** (Serial Input): Data input line. The instruction sequence (Bits 0-6) is 0, 0, 0, 0, 0, 1, 0. The address byte (Bits 7-14) is A7, A6, A5, A4, A3, A2, A1, A0. The data byte (Bits 15-22) is 7, 6, 5, 4, 3, 2, 1, 0.
- **SO** (Serial Output): Data output line. SO remains High-Impedance throughout the transaction (Bits 0-23).

The Instruction phase spans bits 0 to 6, the Address Byte phase spans bits 7 to 14, and the Data Byte phase spans bits 15 to 23.

![](_page_67_Figure_6.jpeg)

FIGURE 12-5: LOAD TX BUFFER INSTRUCTIONFigure 12-5 illustrates the LOAD TX BUFFER INSTRUCTION timing diagram and address mapping.

The timing diagram shows the chip select (CS), serial clock (SCK), serial input (SI), and serial output (SO) lines. The instruction sequence transmitted on SI is 01000abc followed by 8 bits of Data In (7 down to 0), where 'a', 'b', and 'c' are the address bits defining the destination buffer and starting address.

The address mapping table is:

| a | b | c | Address Points to              | Addr |
|---|---|---|--------------------------------|------|
| 0 | 0 | 0 | TX Buffer 0, Start at TXB0SIDH | 0x31 |
| 0 | 0 | 1 | TX Buffer 0, Start at TXB0D0   | 0x36 |
| 0 | 1 | 0 | TX Buffer 1, Start at TXB1SIDH | 0x41 |
| 0 | 1 | 1 | TX Buffer 1, Start at TXB1D0   | 0x46 |
| 1 | 0 | 0 | TX Buffer 2, Start at TXB2SIDH | 0x51 |
| 1 | 0 | 1 | TX Buffer 2, Start at TXB2D0   | 0x56 |

![](_page_68_Figure_2.jpeg)

FIGURE 12-6: REQUEST-TO-SEND (RTS) INSTRUCTIONFigure 12-6 illustrates the REQUEST-TO-SEND (RTS) INSTRUCTION timing diagram.

The timing diagram shows the chip select (CS), serial clock (SCK), serial input (SI), and serial output (SO) lines. The instruction sequence transmitted on SI is 10000T2T1T0, where T2, T1, and T0 are the transmit buffer selection bits.

![](_page_68_Figure_4.jpeg)

FIGURE 12-7: BIT MODIFY INSTRUCTIONFigure 12-7 illustrates the BIT MODIFY INSTRUCTION timing diagram.

The timing diagram shows the chip select (CS), serial clock (SCK), serial input (SI), and serial output (SO) lines. The instruction sequence is 32 bits long, divided into four 8-bit parts: Instruction (00000010), Address Byte (A7 down to A0), Mask Byte (bits 7 down to 0), and Data Byte (bits 7 down to 0).

Note: Not all registers can be accessed with this command. See the register map for a list of the registers that apply.

![](_page_68_Figure_6.jpeg)

# MCP2515

FIGURE 12-8: READ STATUS INSTRUCTION

Timing diagram illustrating the READ STATUS INSTRUCTION sequence.

The instruction (10100000 $_2$ ) is clocked in on SI during SCK cycles 0-7. Data Out (bits 7-0) is provided on SO during SCK cycles 8-15, followed by Repeat Data Out (bits 7-0) during SCK cycles 16-23.

Bit mapping for Data Out:

- Bit 7: RX0IF (CANINTF[0])
- Bit 6: RX1IF (CANINTF[1])
- Bit 5: TXREQ (TXB0CTRL[3])
- Bit 4: TX0IF (CANINTF[2])
- Bit 3: TXREQ (TXB1CTRL[3])
- Bit 2: TX1IF (CANINTF[3])
- Bit 1: TXREQ (TXB2CTRL[3])
- Bit 0: TX2IF (CANINTF[4])

![](_page_69_Figure_2.jpeg)

FIGURE 12-9: RX STATUS INSTRUCTION

Timing diagram illustrating the RX STATUS INSTRUCTION sequence.

The instruction (10110000 $_2$ ) is clocked in on SI during SCK cycles 0-7. Data Out (bits 7-0) is provided on SO during SCK cycles 8-15, followed by Repeat Data Out (bits 7-0) during SCK cycles 16-23.

| 7 | 6 | Received Message          | 4 | 3 | Msg Type Received     | 2 | 1 | 0 | Filter Match            |
|---|---|---------------------------|---|---|-----------------------|---|---|---|-------------------------|
| 0 | 0 | No RX message             | 0 | 0 | Standard data frame   | 0 | 0 | 0 | RXF0                    |
| 0 | 1 | Message in RXB0           | 0 | 1 | Standard remote frame | 0 | 0 | 1 | RXF1                    |
| 1 | 0 | Message in RXB1           | 1 | 0 | Extended data frame   | 0 | 1 | 0 | RXF2                    |
| 1 | 1 | Messages in both buffers* | 1 | 1 | Extended remote frame | 0 | 1 | 1 | RXF3                    |
|   |   |                           |   |   |                       | 1 | 0 | 0 | RXF4                    |
|   |   |                           |   |   |                       | 1 | 0 | 1 | RXF5                    |
|   |   |                           |   |   |                       | 1 | 1 | 0 | RXF0 (rollover to RXB1) |
|   |   |                           |   |   |                       | 1 | 1 | 1 | RXF1 (rollover to RXB1) |

RXnIF (CANINTF) bits are mapped to bits 7 and 6.

The extended ID bit is mapped to bit 4. The RTR bit is mapped to bit 3.

\*Buffer 0 has higher priority; therefore, RXB0 status is reflected in bits[4:0].

![](_page_69_Figure_4.jpeg)

FIGURE 12-10: SPI INPUT TIMINGTiming diagram illustrating SPI Input Timing for the MCP2515.

Signals shown are Chip Select ( $\overline{\text{CS}}$ ), Serial Clock (SCK), Serial Input (SI), and Serial Output (SO).

Data (MSB In to LSB In) is input via SI and sampled on the rising edge of SCK (indicated by timing parameters 4 and 5, representing setup and hold times).

The diagram illustrates timing for two SPI modes: Mode 1,1 (solid SCK line) and Mode 0,0 (dashed SCK line near the end).

Timing parameters 6 and 7 define SCK pulse widths. Parameters 1, 2, 3, 10, and 11 define timing relationships between  $\overline{\text{CS}}$  and SCK edges at the start and end of the transaction.

SO is held in a High-Impedance state during the input transaction.

![](_page_70_Figure_2.jpeg)

FIGURE 12-11: SPI OUTPUT TIMINGTiming diagram illustrating SPI Output Timing for the MCP2515.

Signals shown are Chip Select ( $\overline{\text{CS}}$ ), Serial Clock (SCK), Serial Output (SO), and Serial Input (SI).

Data (MSB Out to LSB Out) is output via SO.

Timing parameters 8 and 9 define the SO output delay and hold time relative to the SCK rising edge (Mode 0,0).

Timing parameters 12 and 13 define the SO output delay and hold time relative to the SCK falling edge (Mode 1,1).

Parameters 2 and 14 define the timing relationship between the last SCK edge and the  $\overline{\text{CS}}$  deactivation for Mode 1,1 and Mode 0,0, respectively.

SI is labeled as "Don't Care" during the output transaction.

The diagram also shows the relationship between the last SCK edge and the  $\overline{\text{CS}}$  rising edge for Mode 1,1 and Mode 0,0.

![](_page_70_Figure_4.jpeg)

# MCP2515

NOTES:

## 13.0 ELECTRICAL CHARACTERISTICS

### 13.1 Absolute Maximum Ratings†

| V <sub>DD</sub>                               | 7.0V                            |
|-----------------------------------------------|---------------------------------|
| All Inputs and Outputs w.r.t. V <sub>SS</sub> | -0.6V to V <sub>DD</sub> + 1.0V |
| Storage Temperature                           | -65°C to +150°C                 |
| Ambient Temperature with Power Applied        | -65°C to +125°C                 |
| Soldering Temperature of Leads (10 seconds)   | +300°C                          |

† **Notice:** Stresses above those listed under "Maximum Ratings" may cause permanent damage to the device. This is a stress rating only and functional operation of the device at those or any other conditions above those indicated in the operational listings of this specification is not implied. Exposure to maximum rating conditions for extended periods may affect device reliability.

# MCP2515

TABLE 13-1: DC CHARACTERISTICS

| DC Characteristics |           |                                                                                                                                                     | $V_{DD} = 2.7V$ to $5.5V$                           |                                                                                        | Industrial (I): $T_{AMB} = -40^{\circ}C$ to $+85^{\circ}C$<br>Extended (E): $T_{AMB} = -40^{\circ}C$ to $+125^{\circ}C$ |                                                                                                                                                                                                                                     |
|--------------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Param. No.         | Sym.      | Characteristic                                                                                                                                      | Min.                                                | Max.                                                                                   | Units                                                                                                                   | Conditions                                                                                                                                                                                                                          |
|                    | $V_{DD}$  | Supply Voltage                                                                                                                                      | 2.7                                                 | 5.5                                                                                    | V                                                                                                                       |                                                                                                                                                                                                                                     |
|                    | $V_{RET}$ | Register Retention Voltage                                                                                                                          | 2.4                                                 | —                                                                                      | V                                                                                                                       |                                                                                                                                                                                                                                     |
|                    | $V_{IH}$  | <strong>High-Level Input Voltage</strong><br>RXCAN Pin<br>SCK, $\overline{CS}$ , SI, $\overline{TXnRTS}$ Pins<br>OSC1 Pin<br>$\overline{RESET}$ Pin | 2<br>$0.7 V_{DD}$<br>$0.85 V_{DD}$<br>$0.85 V_{DD}$ | $V_{DD} + 1$<br>$V_{DD} + 1$<br>$V_{DD}$<br>$V_{DD}$                                   | V<br>V<br>V<br>V                                                                                                        |                                                                                                                                                                                                                                     |
|                    | $V_{IL}$  | <strong>Low-Level Input Voltage</strong><br>RXCAN, $\overline{TXnRTS}$ Pins<br>SCK, $\overline{CS}$ , SI Pins<br>OSC1 Pin<br>$\overline{RESET}$ Pin | -0.3<br>-0.3<br>$V_{SS}$<br>$V_{SS}$                | $0.15 \cdot V_{DD}$<br>$0.4 \cdot V_{DD}$<br>$0.3 \cdot V_{DD}$<br>$0.15 \cdot V_{DD}$ | V<br>V<br>V<br>V                                                                                                        |                                                                                                                                                                                                                                     |
|                    | $V_{OL}$  | <strong>Low-Level Output Voltage</strong><br>TXCAN Pin<br>$\overline{RXnBF}$ Pin<br>SO, CLKOUT Pins<br>$\overline{INT}$ Pin                         | —<br>—<br>—<br>—                                    | 0.6<br>0.6<br>0.6<br>0.6                                                               | V<br>V<br>V<br>V                                                                                                        | $I_{OL} = +6.0 mA$ , $V_{DD} = 4.5V$<br>$I_{OL} = +8.5 mA$ , $V_{DD} = 4.5V$<br>$I_{OL} = +2.1 mA$ , $V_{DD} = 4.5V$<br>$I_{OL} = +1.6 mA$ , $V_{DD} = 4.5V$                                                                        |
|                    | $V_{OH}$  | <strong>High-Level Output Voltage</strong><br>TXCAN, $\overline{RXnBF}$ Pins<br>SO, CLKOUT Pins<br>$\overline{INT}$ Pin                             | $V_{DD} - 0.7$<br>$V_{DD} - 0.5$<br>$V_{DD} - 0.7$  | —<br>—<br>—                                                                            | V<br>V<br>V                                                                                                             | $I_{OH} = -3.0 mA$ , $V_{DD} = 4.5V$<br>$I_{OH} = -400 \mu A$ , $V_{DD} = 4.5V$<br>$I_{OH} = -1.0 mA$ , $V_{DD} = 4.5V$                                                                                                             |
|                    | $I_{LI}$  | <strong>Input Leakage Current</strong><br>All I/Os except OSC1 and $\overline{TXnRTS}$ Pins<br>OSC1 Pin                                             | -1<br>-5                                            | +1<br>+5                                                                               | $\mu A$<br>$\mu A$                                                                                                      | $\overline{CS} = \overline{RESET} = V_{DD}$ ,<br>$V_{IN} = V_{SS}$ to $V_{DD}$                                                                                                                                                      |
|                    | $C_{INT}$ | Internal Capacitance (all inputs and outputs)                                                                                                       | —                                                   | 7                                                                                      | pF                                                                                                                      | $T_{AMB} = +25^{\circ}C$ , $f_C = 1.0 MHz$ ,<br>$V_{DD} = 0V$ (Note 1)                                                                                                                                                              |
|                    | $I_{DD}$  | Operating Current                                                                                                                                   | —                                                   | 10                                                                                     | mA                                                                                                                      | $V_{DD} = 5.5V$ , $F_{OSC} = 25 MHz$ ,<br>$F_{CLK} = 1 MHz$ , SO = Open                                                                                                                                                             |
|                    | $I_{DDS}$ | Standby Current (Sleep mode)                                                                                                                        | —                                                   | 5<br>8                                                                                 | $\mu A$<br>$\mu A$                                                                                                      | $CS$ , $TXnRTS = V_{DD}$ , inputs tied<br>to $V_{DD}$ or $V_{SS}$ , $-40^{\circ}C$ to $+85^{\circ}C$<br>$\overline{CS}$ , $\overline{TXnRTS} = V_{DD}$ , inputs tied<br>to $V_{DD}$ or $V_{SS}$ , $-40^{\circ}C$ to $+125^{\circ}C$ |

Note 1: This parameter is periodically sampled and not 100% tested.

TABLE 13-2: OSCILLATOR TIMING CHARACTERISTICS

| Oscillator Timing Characteristics <sup>(1)</sup> |                   |                                      | V <sub>DD</sub> = 2.7V to 5.5V |              | Industrial (I): T <sub>AMB</sub> = -40°C to +85°C<br>Extended (E): T <sub>AMB</sub> = -40°C to +125°C |                                                                  |
|--------------------------------------------------|-------------------|--------------------------------------|--------------------------------|--------------|-------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| Param. No.                                       | Sym.              | Characteristic                       | Min.                           | Max.         | Units                                                                                                 | Conditions                                                       |
|                                                  | F <sub>OSC</sub>  | Clock In Frequency                   | 1<br>1                         | 40<br>25     | MHz<br>MHz                                                                                            | V <sub>DD</sub> = 4.5V to 5.5V<br>V <sub>DD</sub> = 2.7V to 5.5V |
|                                                  | T <sub>OSC</sub>  | Clock In Period                      | 25<br>40                       | 1000<br>1000 | ns<br>ns                                                                                              | V <sub>DD</sub> = 4.5V to 5.5V<br>V <sub>DD</sub> = 2.7V to 5.5V |
|                                                  | T <sub>DUTY</sub> | Duty Cycle<br>(external clock input) | 0.45                           | 0.55         | —                                                                                                     | T <sub>OSH</sub> /(T <sub>OSH</sub> + T <sub>OSL</sub> )         |

Note 1: This parameter is periodically sampled and not 100% tested.

TABLE 13-3: CAN INTERFACE AC CHARACTERISTICS

| CAN Interface AC Characteristics |                 |                      | V <sub>DD</sub> = 2.7V to 5.5V |      | Industrial (I): T <sub>AMB</sub> = -40°C to +85°C<br>Extended (E): T <sub>AMB</sub> = -40°C to +125°C |            |
|----------------------------------|-----------------|----------------------|--------------------------------|------|-------------------------------------------------------------------------------------------------------|------------|
| Param. No.                       | Sym.            | Characteristic       | Min.                           | Max. | Units                                                                                                 | Conditions |
|                                  | T <sub>WF</sub> | Wake-up Noise Filter | 100                            | —    | ns                                                                                                    |            |

TABLE 13-4: RESET AC CHARACTERISTICS

| Reset AC Characteristics |                 |                                                                    | V <sub>DD</sub> = 2.7V to 5.5V |      | Industrial (I): T <sub>AMB</sub> = -40°C to +85°C<br>Extended (E): T <sub>AMB</sub> = -40°C to +125°C |            |
|--------------------------|-----------------|--------------------------------------------------------------------|--------------------------------|------|-------------------------------------------------------------------------------------------------------|------------|
| Param. No.               | Sym.            | Characteristic                                                     | Min.                           | Max. | Units                                                                                                 | Conditions |
|                          | t <sub>RL</sub> | <span style="text-decoration: overline;">RESET</span> Pin Low Time | 2                              | —    | µs                                                                                                    |            |

# MCP2515

TABLE 13-5: CLKOUT PIN AC CHARACTERISTICS

| CLKOUT Pin AC/DC Characteristics |               |                                  | $V_{DD} = 2.7V$ to $5.5V$ |                       | Industrial (I): $T_{AMB} = -40^{\circ}C$ to $+85^{\circ}C$<br>Extended (E): $T_{AMB} = -40^{\circ}C$ to $+125^{\circ}C$ |                                                                                             |
|----------------------------------|---------------|----------------------------------|---------------------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| Param. No.                       | Sym.          | Characteristic                   | Min.                      | Max.                  | Units                                                                                                                   | Conditions                                                                                  |
|                                  | $t_{hCLKOUT}$ | CLKOUT Pin High Time             | 15                        | —                     | ns                                                                                                                      | $T_{OSC} = 40$ ns (Note 1)                                                                  |
|                                  | $t_{lCLKOUT}$ | CLKOUT Pin Low Time              | 15                        | —                     | ns                                                                                                                      | $T_{OSC} = 40$ ns (Note 1)                                                                  |
|                                  | $t_{rCLKOUT}$ | CLKOUT Pin Rise Time             | —                         | 5                     | ns                                                                                                                      | Measured from $0.3 V_{DD}$ to $0.7 V_{DD}$ (Note 1)                                         |
|                                  | $t_{fCLKOUT}$ | CLKOUT Pin Fall Time             | —                         | 5                     | ns                                                                                                                      | Measured from $0.7 V_{DD}$ to $0.3 V_{DD}$ (Note 1)                                         |
|                                  | $t_{dCLKOUT}$ | CLKOUT Propagation Delay         | —                         | 100                   | ns                                                                                                                      | Note 1                                                                                      |
| 15                               | $t_{hSOF}$    | Start-of-Frame High Time         | —                         | $2 T_{OSC}$           | ns                                                                                                                      | Note 1                                                                                      |
| 16                               | $t_{dSOF}$    | Start-of-Frame Propagation Delay | —                         | $2 T_{OSC} + 0.5 T_Q$ | ns                                                                                                                      | Measured from CAN bit sample point; device is a receiver, BRP[5:0] (CNF1[5:0]) = 0 (Note 2) |

Note 1: All CLKOUT mode functionality and output frequency are tested at device frequency limits; however, the CLKOUT prescaler is set to divide by one. This parameter is periodically sampled and not 100% tested.

2: Design guidance only, not tested.

FIGURE 13-1: START-OF-FRAME PIN AC CHARACTERISTICS

Timing diagram illustrating the Start-of-Frame (SOF) pin AC characteristics. The top trace shows the RXCAN signal transitioning from high to low (Start-of-Frame bit). A 'Sample Point' is indicated on the falling edge of RXCAN. The bottom trace shows the SOF output signal, which transitions from low to high, then back to low. The time interval labeled '16' represents the Start-of-Frame Propagation Delay ( $t_{dSOF}$ ), measured from the Sample Point to the rising edge of the SOF signal. The time interval labeled '15' represents the Start-of-Frame High Time ( $t_{hSOF}$ ), which is the pulse width of the SOF signal.

![](_page_75_Figure_6.jpeg)

TABLE 13-6: SPI INTERFACE AC CHARACTERISTICS

| SPI Interface AC Characteristics |                  |                              | V <sub>DD</sub> = 2.7V to 5.5V |      | Industrial (I): T <sub>AMB</sub> = -40°C to +85°C<br>Extended (E): T <sub>AMB</sub> = -40°C to +125°C |            |
|----------------------------------|------------------|------------------------------|--------------------------------|------|-------------------------------------------------------------------------------------------------------|------------|
| Param. No.                       | Sym.             | Characteristic               | Min.                           | Max. | Units                                                                                                 | Conditions |
|                                  | F <sub>CLK</sub> | Clock Frequency              | —                              | 10   | MHz                                                                                                   |            |
| 1                                | T <sub>CSS</sub> | $\overline{CS}$ Setup Time   | 50                             | —    | ns                                                                                                    |            |
| 2                                | T <sub>CSH</sub> | $\overline{CS}$ Hold Time    | 50                             | —    | ns                                                                                                    |            |
| 3                                | T <sub>CSD</sub> | $\overline{CS}$ Disable Time | 50                             | —    | ns                                                                                                    |            |
| 4                                | T <sub>SU</sub>  | Data Setup Time              | 10                             | —    | ns                                                                                                    |            |
| 5                                | T <sub>HD</sub>  | Data Hold Time               | 10                             | —    | ns                                                                                                    |            |
| 6                                | T <sub>R</sub>   | Clock Rise Time              | —                              | 2    | $\mu s$                                                                                               | Note 1     |
| 7                                | T <sub>F</sub>   | Clock Fall Time              | —                              | 2    | $\mu s$                                                                                               | Note 1     |
| 8                                | T <sub>HI</sub>  | Clock High Time              | 45                             | —    | ns                                                                                                    |            |
| 9                                | T <sub>LO</sub>  | Clock Low Time               | 45                             | —    | ns                                                                                                    |            |
| 10                               | T <sub>CLD</sub> | Clock Delay Time             | 50                             | —    | ns                                                                                                    |            |
| 11                               | T <sub>CLE</sub> | Clock Enable Time            | 50                             | —    | ns                                                                                                    |            |
| 12                               | T <sub>V</sub>   | Output Valid from Clock Low  | —                              | 45   | ns                                                                                                    |            |
| 13                               | T <sub>HO</sub>  | Output Hold Time             | 0                              | —    | ns                                                                                                    |            |
| 14                               | T <sub>DIS</sub> | Output Disable Time          | —                              | 100  | ns                                                                                                    |            |

Note 1: This parameter is not 100% tested.

# MCP2515

NOTES:

## 14.0 PACKAGING INFORMATION

### 14.1 Package Marking Information

18-Lead PDIP (300 mil)

![Diagram of an 18-Lead PDIP package showing marking area placeholders: two lines of X's for customer-specific information, and YYWWNNN for date and traceability code.]()![](_page_78_Picture_4.jpeg)

Example:

![Diagram of an 18-Lead PDIP package showing example marking: MCP2515-I/P(e3) on the top line, and 1850256 on the bottom line.]()![](_page_78_Picture_6.jpeg)

18-Lead SOIC (7.50 mm)

![Diagram of an 18-Lead SOIC package showing marking area placeholders: three lines of X's for customer-specific information, and YYWWNNN for date and traceability code.]()![](_page_78_Picture_8.jpeg)

Example:

![Diagram of an 18-Lead SOIC package showing example marking: MCP2515 E/SO(e3) on the top line, and 1850256 on the bottom line.]()![](_page_78_Picture_10.jpeg)

20-Lead TSSOP (4.4 mm)

![Diagram of a 20-Lead TSSOP package showing marking area placeholders: XXXXXXXX, XXXXXNNN, and YYWW for date code.]()![](_page_78_Picture_12.jpeg)

Example:

![Diagram of a 20-Lead TSSOP package showing example marking across three lines: MCP2515-, I/ST(e3) 256, and 1850 (date code).]()![](_page_78_Picture_14.jpeg)

20-Lead QFN (4x4x0.9 mm)

![Diagram of a 20-Lead QFN package showing marking area placeholders: two lines of X's for customer-specific information, and YYWWNNN for date and traceability code.]()![](_page_78_Picture_16.jpeg)

Example:

![Diagram of a 20-Lead QFN package showing example marking across three lines: 2515, E/ML(e3), and 850256.]()![](_page_78_Picture_18.jpeg)

| <b>Legend:</b> | XX...X | Customer-specific information                                                                                    |
|----------------|--------|------------------------------------------------------------------------------------------------------------------|
|                | Y      | Year code (last digit of calendar year)                                                                          |
|                | YY     | Year code (last 2 digits of calendar year)                                                                       |
|                | WW     | Week code (week of January 1 is week '01')                                                                       |
|                | NNN    | Alphanumeric traceability code                                                                                   |
|                | (e3)   | Pb-free JEDEC designator for Matte Tin (Sn)                                                                      |
|                | *      | This package is Pb-free. The Pb-free JEDEC designator (e3) can be found on the outer packaging for this package. |

![](_page_78_Figure_19.jpeg)

**Note:** In the event the full Microchip part number cannot be marked on one line, it will be carried over to the next line, thus limiting the number of available characters for customer-specific information.

# MCP2515

## 18-Lead Plastic Dual In-Line (P) – 300 mil Body [PDIP]

**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

![Package drawing of the 18-Lead Plastic Dual In-Line (P) – 300 mil Body [PDIP]. The drawing includes a top view showing dimensions D, E1, and the location of Pin 1 (hatched area), a side view showing dimensions A, A1, A2, b, b1, e, L, and E, and an isometric view of the package.]()![](_page_79_Picture_3.jpeg)

|                            | Units            | INCHES   |      |      |
|----------------------------|------------------|----------|------|------|
|                            | Dimension Limits | MIN      | NOM  | MAX  |
| Number of Pins             | N                | 18       |      |      |
| Pitch                      | e                | .100 BSC |      |      |
| Top to Seating Plane       | A                | –        | –    | .210 |
| Molded Package Thickness   | A2               | .115     | .130 | .195 |
| Base to Seating Plane      | A1               | .015     | –    | –    |
| Shoulder to Shoulder Width | E                | .300     | .310 | .325 |
| Molded Package Width       | E1               | .240     | .250 | .280 |
| Overall Length             | D                | .880     | .900 | .920 |
| Tip to Seating Plane       | L                | .115     | .130 | .150 |
| Lead Thickness             | c                | .008     | .010 | .014 |
| Upper Lead Width           | b1               | .045     | .060 | .070 |
| Lower Lead Width           | b                | .014     | .018 | .022 |
| Overall Row Spacing §      | eB               | –        | –    | .430 |

### Notes:

1. Pin 1 visual index feature may vary, but must be located within the hatched area.
2. § Significant Characteristic.
3. Dimensions D and E1 do not include mold flash or protrusions. Mold flash or protrusions shall not exceed .010" per side.
4. Dimensioning and tolerancing per ASME Y14.5M.

BSC: Basic Dimension. Theoretically exact value shown without tolerances.

Microchip Technology Drawing C04-007B

18-Lead Plastic Small Outline (SO) - Wide, 7.50 mm (.300 In.) Body [SOIC]**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

Technical drawing of the MCP2515 18-Lead Plastic Small Outline (SO) - Wide, 7.50 mm (.300 In.) Body [SOIC] package, showing Top View, End View, and Side View.

**Top View:** Dimensions include D, N, E1, E, and pitch e. Datums A and B are defined. Geometric tolerances shown are: 2X  $\parallel 0.20 | C | A$ ; 2X  $\parallel 0.10 | C | B$  (associated with DATUM B); 2X 18 TIPS  $\text{radius} 0.33 | C | A | B$ ; and 18X b  $\Phi 0.25 | M | C | A | B$ . NOTE 1 points to the shaded area indicating the pin 1 identifier area.

**End View:** Shows the profile of the package (DETAIL A).

**Side View:** Shows the package profile relative to the SEATING PLANE (Datum C). Dimensions include A, A1, A2. Geometric tolerances shown are:  $\parallel 0.10 | C$  and 18X  $\text{radius} 0.08 | C$ .

![](_page_80_Figure_3.jpeg)

Microchip Technology Drawing C04-051D Sheet 1 of 2

# MCP2515

## 18-Lead Plastic Small Outline (SO) - Wide, 7.50 mm (.300 In.) Body [SOIC]

**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

Diagram showing the 18-Lead Plastic Small Outline (SO) - Wide package (SOIC) and a detailed cross-section (DETAIL A) illustrating dimensions and angles. The detailed cross-section shows dimensions  $\alpha$ ,  $\Theta$ ,  $\beta$ ,  $\phi$ , L, (L1), and A.

![](_page_81_Picture_3.jpeg)

| Dimension Limits         | Units    | MILLIMETERS |     |      |
|--------------------------|----------|-------------|-----|------|
|                          |          | MIN         | NOM | MAX  |
| Number of Pins           | N        | 18          |     |      |
| Pitch                    | e        | 1.27 BSC    |     |      |
| Overall Height           | A        | -           | -   | 2.65 |
| Molded Package Thickness | A2       | 2.05        | -   | -    |
| Standoff §               | A1       | 0.10        | -   | 0.30 |
| Overall Width            | E        | 10.30 BSC   |     |      |
| Molded Package Width     | E1       | 7.50 BSC    |     |      |
| Overall Length           | D        | 11.55 BSC   |     |      |
| Chamfer (Optional)       | h        | 0.25        | -   | 0.75 |
| Foot Length              | L        | 0.40        | -   | 1.27 |
| Footprint                | L1       | 1.40 REF    |     |      |
| Lead Angle               | $\Theta$ | 0°          | -   | -    |
| Foot Angle               | $\phi$   | 0°          | -   | 8°   |
| Lead Thickness           | c        | 0.20        | -   | 0.33 |
| Lead Width               | b        | 0.31        | -   | 0.51 |
| Mold Draft Angle Top     | $\alpha$ | 5°          | -   | 15°  |
| Mold Draft Angle Bottom  | $\beta$  | 5°          | -   | 15°  |

### Notes:

1. Pin 1 visual index feature may vary, but must be located within the hatched area.

2. § Significant Characteristic

3. Dimension D does not include mold flash, protrusions or gate burrs, which shall not exceed 0.15 mm per end. Dimension E1 does not include interlead flash or protrusion, which shall not exceed 0.25 mm per side.

4. Dimensioning and tolerancing per ASME Y14.5M

BSC: Basic Dimension. Theoretically exact value shown without tolerances.

REF: Reference Dimension, usually without tolerance, for information purposes only.

5. Datums A & B to be determined at Datum H.

Microchip Technology Drawing No. C04-051D Sheet 2 of 2

18-Lead Plastic Small Outline (SO) - Wide, 7.50 mm (.300 In.) Body [SOIC]**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

![Diagram showing the Recommended Land Pattern for the 18-Lead Plastic Small Outline (SO) package. It illustrates 18 rectangular contact pads (9 on each side). Key dimensions are labeled: E (Contact Pitch), C (Contact Pad Spacing, distance between rows), X (Contact Pad Width), and Y (Contact Pad Length). Pads 1 and 2 are marked. A SILK SCREEN outline is also indicated.]()![](_page_82_Picture_3.jpeg)

RECOMMENDED LAND PATTERN

| Units                    |   | MILLIMETERS |          |      |
|--------------------------|---|-------------|----------|------|
| Dimension Limits         |   | MIN         | NOM      | MAX  |
| Contact Pitch            | E |             | 1.27 BSC |      |
| Contact Pad Spacing      | C |             | 9.40     |      |
| Contact Pad Spacing      |   |             |          |      |
| Contact Pad Width (X18)  | X |             |          | 0.60 |
| Contact Pad Length (X18) | Y |             |          | 1.90 |

Notes:

1. Dimensioning and tolerancing per ASME Y14.5M

BSC: Basic Dimension. Theoretically exact value shown without tolerances.

Microchip Technology Drawing C04-2051A

# MCP2515

## 20-Lead Plastic Thin Shrink Small Outline (ST) - 4.4 mm Body [TSSOP]

**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

TOP VIEW

Dimensions shown include D, E,  $E/2$ , E1, N (number of leads), e, and  $e/2$ . (DATUM B) and (DATUM A) are indicated. The lead position tolerance for 20 leads is specified as  $20X$   $\text{Profile } 0.20 | C | B | A$ .

![](_page_83_Figure_3.jpeg)

SIDE VIEW

Dimensions shown include A, A1, A2, and NX b (lead width). The SEATING PLANE is defined by Datum C. Tolerances shown include  $\text{Flatness } 0.05$ ,  $\text{Profile } 0.10 | C$ , and positional tolerance for the lead width  $\emptyset 0.10 | \mathit{M} | C | B | A$ .

![](_page_83_Picture_4.jpeg)

VIEW A—A

DETAIL B SHEET 2 shows a cross-section of the lead termination.

![](_page_83_Picture_5.jpeg)

Microchip Technology Drawing C04-088C Sheet 1 of 2

20-Lead Plastic Thin Shrink Small Outline (ST) - 4.4 mm Body [TSSOP]**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

![Diagram showing the TSSOP package outline and a detailed cross-section (DETAIL B) of the lead profile. The cross-section shows dimensions H, R1, R2, c, L, and (L1), and the angle theta.]()![](_page_84_Picture_3.jpeg)

DETAIL B

| Units                    | Dimension Limits | MILLIMETERS |      |      |
|--------------------------|------------------|-------------|------|------|
|                          |                  | MIN         | NOM  | MAX  |
| Number of Pins           | N                | 20          |      |      |
| Pitch                    | e                | 0.65 BSC    |      |      |
| Overall Height           | A                | -           | -    | 1.20 |
| Molded Package Thickness | A2               | 0.80        | 1.00 | 1.05 |
| Standoff                 | A1               | 0.05        | -    | 0.15 |
| Overall Width            | E                | 6.40 BSC    |      |      |
| Molded Package Width     | E1               | 4.30        | 4.40 | 4.50 |
| Molded Package Length    | D                | 6.40        | 6.50 | 6.60 |
| Foot Length              | L                | 0.45        | 0.60 | 0.75 |
| Footprint                | L1               | 1.00 REF    |      |      |
| Foot Angle               | $\Theta$         | 0°          | -    | 8°   |
| Lead Width               | b                | 0.19        | -    | 0.30 |
| Lead Thickness           | c                | 0.09        | -    | 0.20 |
| Bend Radius              | R1               | 0.09        | -    | -    |
| Bend Radius              | R2               | 0.09        | -    | -    |

Notes:

1. Pin 1 visual index feature may vary, but must be located within the hatched area.
2. Dimensions D and E1 do not include mold flash or protrusions. Mold flash or protrusions shall not exceed 0.15mm per side.
3. Dimensioning and tolerancing per ASME Y14.5M

BSC: Basic Dimension. Theoretically exact value shown without tolerances.

REF: Reference Dimension, usually without tolerance, for information purposes only.

Microchip Technology Drawing C04-088C Sheet 2 of 2

# MCP2515

## 20-Lead Plastic Thin Shrink Small Outline (ST) - 4.4 mm Body [TSSOP]

**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

Diagram illustrating the RECOMMENDED LAND PATTERN for the 20-Lead Plastic Thin Shrink Small Outline (ST) - 4.4 mm Body [TSSOP] package. The diagram shows the rectangular body outline with a SILK SCREEN area. The leads are arranged in two rows of ten. Key dimensions are labeled: C (Contact Pad Spacing), Y1 (Contact Pad Length), X1 (Contact Pad Width), E (Contact Pitch), and G (Distance Between Pads). A reference point is marked with a black dot.

![](_page_85_Picture_3.jpeg)

| Dimension Limits         | Units | MILLIMETERS |          |      |
|--------------------------|-------|-------------|----------|------|
|                          |       | MIN         | NOM      | MAX  |
| Contact Pitch            | E     |             | 0.65 BSC |      |
| Contact Pad Spacing      | C     |             | 5.90     |      |
| Contact Pad Width (X20)  | X1    |             |          | 0.45 |
| Contact Pad Length (X20) | Y1    |             |          | 1.45 |
| Distance Between Pads    | G     | 0.20        |          |      |

Notes:

1. Dimensioning and tolerancing per ASME Y14.5M

BSC: Basic Dimension. Theoretically exact value shown without tolerances.

Microchip Technology Drawing No. C04-2088A

20-Lead Plastic Quad Flat, No Lead Package (ML) - 4x4 mm Body [QFN]  
Also called VQFN

Note: For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

NOTE 1

N

D

A

B

E

(DATUM B)

(DATUM A)

2X  $\oplus 0.15 \text{ C}$ 

2X  $\oplus 0.15 \text{ C}$ 

TOP VIEW

C

A

SEATING PLANE

(A3)

 $\parallel 0.10 \text{ C}$ 

A1

20X  $\oplus 0.08 \text{ C}$ 

SIDE VIEW

D2

 $\oplus 0.10 \text{ M C A B}$ 

E2

2

1

NOTE 1

N

L

K

e

20X b

 $\oplus 0.10 \text{ M C A B}$ 

 $\oplus 0.05 \text{ M C}$ 

BOTTOM VIEW

Microchip Technology Drawing C04-126 Rev C Sheet 1 of 2

![](_page_86_Figure_3.jpeg)

# MCP2515

## 20-Lead Plastic Quad Flat, No Lead Package (ML) - 4x4 mm Body [QFN]

Also called VQFN

**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

![3D perspective view of the 20-Lead Plastic Quad Flat, No Lead Package (ML) - 4x4 mm Body [QFN]. The drawing illustrates the top surface, the side terminals, and the exposed pad on the bottom surface.]()![](_page_87_Picture_4.jpeg)

| Dimension Limits        |       | MILLIMETERS |      |      |
|-------------------------|-------|-------------|------|------|
|                         | Units | MIN         | NOM  | MAX  |
| Number of Terminals     | N     | 20          |      |      |
| Pitch                   | e     | 0.50 BSC    |      |      |
| Overall Height          | A     | 0.80        | 0.90 | 1.00 |
| Standoff                | A1    | 0.00        | 0.02 | 0.05 |
| Terminal Thickness      | A3    | 0.20 REF    |      |      |
| Overall Length          | D     | 4.00 BSC    |      |      |
| Exposed Pad Length      | D2    | 2.60        | 2.70 | 2.80 |
| Overall Width           | E     | 4.00 BSC    |      |      |
| Exposed Pad Width       | E2    | 2.60        | 2.70 | 2.80 |
| Terminal Width          | b     | 0.18        | 0.25 | 0.30 |
| Terminal Length         | L     | 0.30        | 0.40 | 0.50 |
| Terminal-to-Exposed-Pad | K     | 0.20        | -    | -    |

Notes:

1. Pin 1 visual index feature may vary, but must be located within the hatched area.

2. Package is saw singulated

3. Dimensioning and tolerancing per ASME Y14.5M

BSC: Basic Dimension. Theoretically exact value shown without tolerances.

REF: Reference Dimension, usually without tolerance, for information purposes only.

Microchip Technology Drawing C04-126 Rev C Sheet 2 of 2

**20-Lead Plastic Quad Flat, No Lead Package (ML) - 4x4 mm Body [QFN]**  
Also called VQFN**Note:** For the most current package drawings, please see the Microchip Packaging Specification located at <http://www.microchip.com/packaging>

Diagram showing the recommended land pattern for the MCP2515 20-Lead Plastic Quad Flat, No Lead Package (ML) - 4x4 mm Body [QFN]. The diagram illustrates the layout of the 20 peripheral contact pads surrounding a central thermal pad. Dimensions shown include Contact Pitch (E), Optional Center Pad Width (X2), Optional Center Pad Length (Y2), Contact Pad Spacing (C1, C2), Contact Pad Width (X1), Contact Pad Length (Y1), Contact Pad to Center Pad (G1), Thermal Via Diameter ( $\text{\O}V$ ), and Thermal Via Pitch (EV). A SILK SCREEN outline is also indicated.

![Recommended Land Pattern Diagram for 20-Lead QFN Package]()![](_page_88_Picture_3.jpeg)

RECOMMENDED LAND PATTERN

| Dimension Limits                | Units | MILLIMETERS |          |      |
|---------------------------------|-------|-------------|----------|------|
|                                 |       | MIN         | NOM      | MAX  |
| Contact Pitch                   | E     |             | 0.50 BSC |      |
| Optional Center Pad Width       | X2    |             |          | 2.80 |
| Optional Center Pad Length      | Y2    |             |          | 2.80 |
| Contact Pad Spacing             | C1    |             | 4.00     |      |
| Contact Pad Spacing             | C2    |             | 4.00     |      |
| Contact Pad Width (X20)         | X1    |             |          | 0.30 |
| Contact Pad Length (X20)        | Y1    |             |          | 0.80 |
| Contact Pad to Center Pad (X16) | G1    | 0.20        |          |      |
| Thermal Via Diameter            | V     |             | 0.30     |      |
| Thermal Via Pitch               | EV    |             | 1.00     |      |

Notes:

1. Dimensioning and tolerancing per ASME Y14.5M  
   BSC: Basic Dimension. Theoretically exact value shown without tolerances.
2. For best soldering results, thermal vias, if used, should be filled or tented to avoid solder loss during reflow process

Microchip Technology Drawing C04-2126 Rev B

# MCP2515

NOTES:

## APPENDIX A: REVISION HISTORY

### Revision K (April 2021)

The following is the list of modifications:

1. Added AEC-Q100 Qualified in [Features](#).
2. Changed requirements from PS2 > SJW to PS2  $\ge$  SJW in [Section 5.5 "Programming Time Segments"](#).
3. Updated [Figure 12-8: TXREQ \(TXB0CNTRL\[3\]\)](#) to TXREQ (TXB0CTRL[3]).
4. Added the AEC-Q100 Automotive Qualification identification to the "[Product Identification System](#)".
5. Several package drawings have been updated in [Section 14.0 "Packaging Information"](#).

### Revision J (January 2019)

The following is the list of modifications:

1. Added Exposed Thermal Pad description to [Table 1-1](#).
2. Updated [Section 8.1 "Oscillator Start-up Timer"](#).
3. Updated [Register 10-1](#).
4. Updated [Table 11-2](#).
5. Updated [Table 13-1](#) in [Section 13.0 "Electrical Characteristics"](#).
6. Updated the Product Identification System section.

### Revision H (November 2016)

The following is the list of modifications:

1. Updated the voltage range, which was widened to 2.7V to 5.5V for the E temperature device. There are two parameters that differ between the I and E temperature devices:  $I_{DDS}$  and  $F_{OSC}$  ( $T_{OSC}$ ).
2. Specified that the usage of the RXM[1:0] bit settings, '01' and '10' in the RXBnCTRL registers is not recommended.

### Revision G (August 2012)

The following is the list of modifications:

1. Updated content in [Register 4-1](#), [Register 4-12](#), [Register 4-13](#), [Register 4-16](#), [Register 4-17](#).

### Revision F (October 2010)

The following is the list of modifications:

1. Added 20-lead QFN package (4x4) and related information.
2. Updated [Table 1-1](#).
3. Updated the Product Identification System section.

### Revision E (November 2007)

- Removed preliminary watermark.
- Updated templates.
- Updated register information.
- Updated package outline drawings.

### Revision D (April 2005)

- Added [Table 8-1](#) and [Table 8-2](#) in [Section 8.0 "Oscillator"](#). Added note box following tables.
- Changed address bits in column heading in [Table 11-1](#), [Section 11.0 "Register Map"](#).
- Modified [Section 14.0 "Packaging Information"](#) to reflect pb free device markings.
- Appendix A Revision History: Rearranged order of importance.

### Revision C (November 2004)

- [Section 9.0 "Reset"](#) added.
- [Section 12.1 "Overview"](#): added notebox.
- [Section 12.6 "LOAD TX BUFFER Instruction"](#): Changed verbiage within paragraph.
- Added Appendix A: Revision History.

### Revision B (September 2003)

- Front page bullet: Standby current (typical) (Sleep mode) changed from 10  $\mu$ A to 1  $\mu$ A.
- Added notebox for maximum frequency on CLKOUT in [Section 8.2 "CLKOUT Pin"](#).
- [Section 12.0 "SPI Interface"](#), [Table 12-1](#):
  - Changed supply voltage minimum to 2.7V.
  - Internal Capacitance: Changed  $V_{DD}$  condition to 0V.
  - Standby Current (Sleep mode): Split specification into -40°C to +85°C and -40°C to +125°C.

### Revision A (May 2003)

- Original Release of this Document.

# MCP2515

NOTES:

PRODUCT IDENTIFICATION SYSTEMTo order or obtain information, e.g., on pricing or delivery, refer to the factory or the listed sales office.

| PART NO.                                                                                                                                                                                                   | [X] <sup>(1)</sup>   | -X                | /XX     | XXX           | Examples:                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|-------------------|---------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Device                                                                                                                                                                                                     | Tape and Reel Option | Temperature Range | Package | Qualification |                                                                                                                                                                                                                                                                                     |
| <p><b>Device:</b> MCP2515: CAN Controller with SPI Interface<br/>MCP2515T: CAN Controller with SPI Interface (Tape and Reel)</p>                                                                           |                      |                   |         |               | a) MCP2515-E/P: Extended Temperature, 18-Lead PDIP package.                                                                                                                                                                                                                         |
| <p><b>Tape and Reel Option:</b> T = Tape and Reel<sup>(1)</sup></p>                                                                                                                                        |                      |                   |         |               | b) MCP2515-I/P: Industrial Temperature, 18-Lead PDIP package.                                                                                                                                                                                                                       |
| <p><b>Temperature Range:</b> I = -40°C to +85°C (Industrial)<br/>E = -40°C to +125°C (Extended)</p>                                                                                                        |                      |                   |         |               | c) MCP2515-E/SO: Extended Temperature, 18-Lead SOIC package.                                                                                                                                                                                                                        |
| <p><b>Package:</b> P = Plastic DIP (300 mil Body), 18-Lead<br/>SO = Plastic SOIC (7.50 mm Body), 18-Lead<br/>ST = Plastic TSSOP (4.4 mm Body), 20-Lead<br/>ML = Plastic QFN (4x4x0.9 mm Body), 20-Lead</p> |                      |                   |         |               | d) MCP2515-I/SO: Industrial Temperature, 18-Lead SOIC package.                                                                                                                                                                                                                      |
| <p><b>Qualification:</b> Blank = Standard Qualification<br/>VAO = AEC-Q100 Automotive Qualification</p>                                                                                                    |                      |                   |         |               | e) MCP2515T-I/SO: Tape and Reel, Industrial Temperature, 18-Lead SOIC package.                                                                                                                                                                                                      |
|                                                                                                                                                                                                            |                      |                   |         |               | f) MCP2515-I/ST: Industrial Temperature, 20-Lead TSSOP package.                                                                                                                                                                                                                     |
|                                                                                                                                                                                                            |                      |                   |         |               | g) MCP2515T-I/ST: Tape and Reel, Industrial Temperature, 20-Lead TSSOP package.                                                                                                                                                                                                     |
|                                                                                                                                                                                                            |                      |                   |         |               | h) MCP2515-E/ML: Extended Temperature, 20-Lead QFN package.                                                                                                                                                                                                                         |
|                                                                                                                                                                                                            |                      |                   |         |               | i) MCP2515T-E/ML: Tape and Reel, Extended Temperature, 20-Lead QFN package.                                                                                                                                                                                                         |
|                                                                                                                                                                                                            |                      |                   |         |               | j) MCP2515-I/ML: Industrial Temperature, 20-Lead QFN package.                                                                                                                                                                                                                       |
|                                                                                                                                                                                                            |                      |                   |         |               | k) MCP2515T-I/ML: Tape and Reel, Industrial Temperature, 20-Lead QFN package.                                                                                                                                                                                                       |
|                                                                                                                                                                                                            |                      |                   |         |               | l) MCP2515-E/SOVAO: Extended Temperature, 18-Lead SOIC package, Automotive Qualified.                                                                                                                                                                                               |
|                                                                                                                                                                                                            |                      |                   |         |               | m) MCP2515-E/MLVAO: Extended Temperature, 20-Lead QFN package, Automotive Qualified.                                                                                                                                                                                                |
|                                                                                                                                                                                                            |                      |                   |         |               | n) MCP2515-I/SOVAO: Industrial Temperature, 18-Lead SOIC package, Automotive Qualified.                                                                                                                                                                                             |
|                                                                                                                                                                                                            |                      |                   |         |               | o) MCP2515-I/STVAO: Industrial Temperature, 20-Lead TSSOP package, Automotive Qualified.                                                                                                                                                                                            |
|                                                                                                                                                                                                            |                      |                   |         |               | p) MCP2515-I/MLVAO: Industrial Temperature, 20-Lead QFN package, Automotive Qualified.                                                                                                                                                                                              |
|                                                                                                                                                                                                            |                      |                   |         |               | q) MCP2515T-I/SOVAO: Tape and Reel, Industrial Temperature, 18-Lead SOIC package, Automotive Qualified.                                                                                                                                                                             |
|                                                                                                                                                                                                            |                      |                   |         |               | r) MCP2515T-I/STVAO: Tape and Reel, Industrial Temperature, 20-Lead TSSOP package, Automotive Qualified.                                                                                                                                                                            |
|                                                                                                                                                                                                            |                      |                   |         |               | s) MCP2515T-E/MLVAO: Tape and Reel, Extended Temperature, 20-Lead QFN package, Automotive Qualified.                                                                                                                                                                                |
|                                                                                                                                                                                                            |                      |                   |         |               | <b>Note 1:</b> Tape and Reel identifier only appears in the catalog part number description. This identifier is used for ordering purposes and is not printed on the device package. Check with your Microchip Sales Office for package availability with the Tape and Reel option. |

# MCP2515

NOTES:

#### Note the following details of the code protection feature on Microchip devices:

- Microchip products meet the specifications contained in their particular Microchip Data Sheet.
- Microchip believes that its family of products is secure when used in the intended manner and under normal conditions.
- There are dishonest and possibly illegal methods being used in attempts to breach the code protection features of the Microchip devices. We believe that these methods require using the Microchip products in a manner outside the operating specifications contained in Microchip's Data Sheets. Attempts to breach these code protection features, most likely, cannot be accomplished without violating Microchip's intellectual property rights.
- Microchip is willing to work with any customer who is concerned about the integrity of its code.
- Neither Microchip nor any other semiconductor manufacturer can guarantee the security of its code. Code protection does not mean that we are guaranteeing the product is "unbreakable." Code protection is constantly evolving. We at Microchip are committed to continuously improving the code protection features of our products. Attempts to break Microchip's code protection feature may be a violation of the Digital Millennium Copyright Act. If such acts allow unauthorized access to your software or other copyrighted work, you may have a right to sue for relief under that Act.

Information contained in this publication is provided for the sole purpose of designing with and using Microchip products. Information regarding device applications and the like is provided only for your convenience and may be superseded by updates. It is your responsibility to ensure that your application meets with your specifications.

THIS INFORMATION IS PROVIDED BY MICROCHIP "AS IS". MICROCHIP MAKES NO REPRESENTATIONS OR WARRANTIES OF ANY KIND WHETHER EXPRESS OR IMPLIED, WRITTEN OR ORAL, STATUTORY OR OTHERWISE, RELATED TO THE INFORMATION INCLUDING BUT NOT LIMITED TO ANY IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE OR WARRANTIES RELATED TO ITS CONDITION, QUALITY, OR PERFORMANCE.

IN NO EVENT WILL MICROCHIP BE LIABLE FOR ANY INDIRECT, SPECIAL, PUNITIVE, INCIDENTAL OR CONSEQUENTIAL LOSS, DAMAGE, COST OR EXPENSE OF ANY KIND WHATSOEVER RELATED TO THE INFORMATION OR ITS USE, HOWEVER CAUSED, EVEN IF MICROCHIP HAS BEEN ADVISED OF THE POSSIBILITY OR THE DAMAGES ARE FORESEEABLE. TO THE FULLEST EXTENT ALLOWED BY LAW, MICROCHIP'S TOTAL LIABILITY ON ALL CLAIMS IN ANY WAY RELATED TO THE INFORMATION OR ITS USE WILL NOT EXCEED THE AMOUNT OF FEES, IF ANY, THAT YOU HAVE PAID DIRECTLY TO MICROCHIP FOR THE INFORMATION. Use of Microchip devices in life support and/or safety applications is entirely at the buyer's risk, and the buyer agrees to defend, indemnify and hold harmless Microchip from any and all damages, claims, suits, or expenses resulting from such use. No licenses are conveyed, implicitly or otherwise, under any Microchip intellectual property rights unless otherwise stated.

For information regarding Microchip's Quality Management Systems, please visit [www.microchip.com/quality](http://www.microchip.com/quality).

#### Trademarks

The Microchip name and logo, the Microchip logo, Adaptec, AnyRate, AVR, AVR logo, AVR Freaks, BesTime, BitCloud, chipKIT, chipKIT logo, CryptoMemory, CryptoRF, dsPIC, FlashFlex, flexPWR, HELDO, IGLOO, JukeBlox, KeeLoq, Kleer, LANCheck, LinkMD, maxStylus, maxTouch, MediaLB, megaAVR, Microsemi, Microsemi logo, MOST, MOST logo, MPLAB, OptoLyzer, PackeTime, PIC, picoPower, PICSTART, PIC32 logo, PolarFire, Prochip Designer, QTouch, SAM-BA, SenGenuity, SpyNIC, SST, SST Logo, SuperFlash, Symmetricom, SyncServer, Tachyon, TimeSource, tinyAVR, UNI/O, Vectron, and XMEGA are registered trademarks of Microchip Technology Incorporated in the U.S.A. and other countries.

AgileSwitch, APT, ClockWorks, The Embedded Control Solutions Company, EtherSynch, FlashTec, Hyper Speed Control, HyperLight Load, IntelliMOS, Libero, motorBench, mTouch, Powermite 3, Precision Edge, ProASIC, ProASIC Plus, ProASIC Plus logo, Quiet-Wire, SmartFusion, SyncWorld, Temux, TimeCesium, TimeHub, TimePictra, TimeProvider, WinPath, and ZL are registered trademarks of Microchip Technology Incorporated in the U.S.A.

Adjacent Key Suppression, AKS, Analog-for-the-Digital Age, Any Capacitor, AnyIn, AnyOut, Augmented Switching, BlueSky, BodyCom, CodeGuard, CryptoAuthentication, CryptoAutomotive, CryptoCompanion, CryptoController, dsPICDEM, dsPICDEM.net, Dynamic Average Matching, DAM, ECAN, Espresso T1S, EtherGREEN, IdealBridge, In-Circuit Serial Programming, ICSP, INICnet, Intelligent Paralleling, Inter-Chip Connectivity, JitterBlocker, maxCrypto, maxView, memBrain, Mindi, MiWi, MPASM, MPF, MPLAB Certified logo, MPLIB, MPLINK, MultiTRAK, NetDetach, Omniscient Code Generation, PICDEM, PICDEM.net, PICKit, PICtail, PowerSmart, PureSilicon, QMatrix, REAL ICE, Ripple Blocker, RTAX, RTG4, SAM-ICE, Serial Quad I/O, simpleMAP, SimpliPHY, SmartBuffer, SMART-I.S., storClad, SQI, SuperSwitcher, SuperSwitcher II, Switchtec, SynchroPHY, Total Endurance, TSHARC, USBCheck, VariSense, VectorBlox, VeriPHY, ViewSpan, WiperLock, XpressConnect, and ZENA are trademarks of Microchip Technology Incorporated in the U.S.A. and other countries.

SQTP is a service mark of Microchip Technology Incorporated in the U.S.A.

The Adaptec logo, Frequency on Demand, Silicon Storage Technology, and Symmcom are registered trademarks of Microchip Technology Inc. in other countries.

GestIC is a registered trademark of Microchip Technology Germany II GmbH & Co. KG, a subsidiary of Microchip Technology Inc., in other countries.

All other trademarks mentioned herein are property of their respective companies.

© 2003-2021, Microchip Technology Incorporated, All Rights Reserved.

ISBN: 978-1-5224-8130-0

## Worldwide Sales and Service

### AMERICAS

**Corporate Office**  
2365 West Chandler Blvd.  
Chandler, AZ 85224-6199  
Tel: 480-792-7200  
Fax: 480-792-7277  
Technical Support:  
<http://www.microchip.com/support>  
Web Address:  
[www.microchip.com](http://www.microchip.com)

**Atlanta**  
Duluth, GA  
Tel: 678-957-9614  
Fax: 678-957-1455

**Austin, TX**  
Tel: 512-257-3370

**Boston**  
Westborough, MA  
Tel: 774-760-0087  
Fax: 774-760-0088

**Chicago**  
Itasca, IL  
Tel: 630-285-0071  
Fax: 630-285-0075

**Dallas**  
Addison, TX  
Tel: 972-818-7423  
Fax: 972-818-2924

**Detroit**  
Novi, MI  
Tel: 248-848-4000

**Houston, TX**  
Tel: 281-894-5983

**Indianapolis**  
Noblesville, IN  
Tel: 317-773-8323  
Fax: 317-773-5453  
Tel: 317-536-2380

**Los Angeles**  
Mission Viejo, CA  
Tel: 949-462-9523  
Fax: 949-462-9608  
Tel: 951-273-7800

**Raleigh, NC**  
Tel: 919-844-7510

**New York, NY**  
Tel: 631-436-6000

**San Jose, CA**  
Tel: 408-736-9110  
Tel: 408-436-4270

**Canada - Toronto**  
Tel: 905-695-1980  
Fax: 905-695-2078

### ASIA/PACIFIC

**Australia - Sydney**  
Tel: 61-2-9868-6733

**China - Beijing**  
Tel: 86-10-8569-7000

**China - Chengdu**  
Tel: 86-28-8665-5511

**China - Chongqing**  
Tel: 86-23-8980-9588

**China - Dongguan**  
Tel: 86-769-8702-9880

**China - Guangzhou**  
Tel: 86-20-8755-8029

**China - Hangzhou**  
Tel: 86-571-8792-8115

**China - Hong Kong SAR**  
Tel: 852-2943-5100

**China - Nanjing**  
Tel: 86-25-8473-2460

**China - Qingdao**  
Tel: 86-532-8502-7365

**China - Shanghai**  
Tel: 86-21-3326-8000

**China - Shenyang**  
Tel: 86-24-2334-2829

**China - Shenzhen**  
Tel: 86-755-8864-2200

**China - Suzhou**  
Tel: 86-186-6233-1526

**China - Wuhan**  
Tel: 86-27-5980-5300

**China - Xian**  
Tel: 86-29-8833-7252

**China - Xiamen**  
Tel: 86-592-2388138

**China - Zhuhai**  
Tel: 86-756-3210040

### ASIA/PACIFIC

**India - Bangalore**  
Tel: 91-80-3090-4444

**India - New Delhi**  
Tel: 91-11-4160-8631

**India - Pune**  
Tel: 91-20-4121-0141

**Japan - Osaka**  
Tel: 81-6-6152-7160

**Japan - Tokyo**  
Tel: 81-3-6880-3770

**Korea - Daegu**  
Tel: 82-53-744-4301

**Korea - Seoul**  
Tel: 82-2-554-7200

**Malaysia - Kuala Lumpur**  
Tel: 60-3-7651-7906

**Malaysia - Penang**  
Tel: 60-4-227-8870

**Philippines - Manila**  
Tel: 63-2-634-9065

**Singapore**  
Tel: 65-6334-8870

**Taiwan - Hsin Chu**  
Tel: 886-3-577-8366

**Taiwan - Kaohsiung**  
Tel: 886-7-213-7830

**Taiwan - Taipei**  
Tel: 886-2-2508-8600

**Thailand - Bangkok**  
Tel: 66-2-694-1361

**Vietnam - Ho Chi Minh**  
Tel: 84-28-5448-2100

### EUROPE

**Austria - Wels**  
Tel: 43-7242-2244-39  
Fax: 43-7242-2244-393

**Denmark - Copenhagen**  
Tel: 45-4485-5910  
Fax: 45-4485-2829

**Finland - Espoo**  
Tel: 368-9-4520-820

**France - Paris**  
Tel: 33-1-69-53-63-20  
Fax: 33-1-69-30-90-79

**Germany - Garching**  
Tel: 49-8931-9700

**Germany - Haan**  
Tel: 49-2129-3766400

**Germany - Heilbronn**  
Tel: 49-7131-72400

**Germany - Karlsruhe**  
Tel: 49-721-625370

**Germany - Munich**  
Tel: 49-89-627-144-0  
Fax: 49-89-627-144-44

**Germany - Rosenheim**  
Tel: 49-8031-364-560

**Israel - Ra'anana**  
Tel: 972-9-744-7705

**Italy - Milan**  
Tel: 39-0331-742611  
Fax: 39-0331-466781

**Italy - Padova**  
Tel: 39-049-7625286

**Netherlands - Drunen**  
Tel: 31-416-690399  
Fax: 31-416-690340

**Norway - Trondheim**  
Tel: 47-7288-4388

**Poland - Warsaw**  
Tel: 48-22-3325737

**Romania - Bucharest**  
Tel: 40-21-407-87-50

**Spain - Madrid**  
Tel: 34-91-708-08-90  
Fax: 34-91-708-08-91

**Sweden - Gothenberg**  
Tel: 46-31-704-60-40

**Sweden - Stockholm**  
Tel: 46-8-5090-4654

**UK - Wokingham**  
Tel: 44-118-921-5800  
Fax: 44-118-921-5820